C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 1   


C51 COMPILER V9.03, COMPILATION OF MODULE CYPM
OBJECT MODULE PLACED IN .\DP8051_Keil_903\Debug\cyPm.obj
COMPILER INVOKED BY: C:\Program Files (x86)\Cypress\PSoC Creator\2.1\PSoC Creator\import\keil\pk51\9.03\C51\BIN\c51.exe 
                    -.\Generated_Source\PSoC3\cyPm.c NOIV LARGE MODDP2 OMF2 VB(1) PR(.\DP8051_Keil_903\Debug\cyPm.lst) CD DB NOIP OT(0,SIZE) 
                    -INCDIR(Generated_Source\PSoC3) OJ(.\DP8051_Keil_903\Debug\cyPm.obj)

line level    source

   1          /*******************************************************************************
   2          * File Name: cyPm.c
   3          * Version 3.0
   4          *
   5          * Description:
   6          *  Provides an API for the power management.
   7          *
   8          * Note:
   9          *  Documentation of the API's in this file is located in the
  10          *  System Reference Guide provided with PSoC Creator.
  11          *
  12          ********************************************************************************
  13          * Copyright 2008-2012, Cypress Semiconductor Corporation.  All rights reserved.
  14          * You may use this file only in accordance with the license, terms, conditions,
  15          * disclaimers, and limitations in the end user license agreement accompanying
  16          * the software package with which this file was provided.
  17          *******************************************************************************/
  18          
  19          #include "cyPm.h"
  20          
  21          static CY_PM_BACKUP_STRUCT          cyPmBackup;
  22          static CY_PM_CLOCK_BACKUP_STRUCT    cyPmClockBackup;
  23          
  24          /* Convertion table between register's values and frequency in MHz  */
  25          static const uint8 CYCODE cyPmImoFreqReg2Mhz[7u] = {12u, 6u, 24u, 3u, 48u, 62u, 74u};
  26          
  27          /* Function Prototypes */
  28          static void CyPmHibSaveSet(void);
  29          static void CyPmHibRestore(void) ;
  30          
  31          static void CyPmSlpSaveSet(void) ;
  32          static void CyPmSlpRestore(void) ;
  33          
  34          static void CyPmHibSlpSaveSet(void) ;
  35          static void CyPmHibSlpRestore(void) ;
  36          
  37          #if(CY_PSOC5A)
              
                  /***************************************************************************
                  * The PICU interupt event is not allowed to act as wakeup source for PSoC 5.
                  * To prevent accidental wakeup all the PICU interrupts are disabled before
                  * Sleep and Hibernate low power modes entry. In case of Sleep mode registers
                  * values must be restored on wakeup, but in case of Hibernate low power mode
                  * there is no sense in saving/restoring registers values as the only wakeup
                  * source for this mode is external reset (XRES). For more information refer
                  * to the PSoC 5 device TRM.
                  ***************************************************************************/
              
                  static void CyPmSavePicuInterrupts(void);
                  static void CyPmDisablePicuInterrupts(void) ;
                  static void CyPmRestorePicuInterrupts(void) ;
              
              #endif  /* (CY_PSOC5A) */
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 2   

  54          
  55          
  56          /*******************************************************************************
  57          * Function Name: CyPmSaveClocks
  58          ********************************************************************************
  59          *
  60          * Summary:
  61          *  This function is called in preparation for entering sleep or hibernate low
  62          *  power modes. Saves all state of the clocking system that does not persist
  63          *  during sleep/hibernate or that needs to be altered in preparation for
  64          *  sleep/hibernate. Shutdowns all the digital and analog clock dividers.
  65          *
  66          *  Switches the master clock over to the IMO and shuts down the PLL and MHz
  67          *  Crystal. The IMO frequency is set to either 12 MHz or 48 MHz to match the
  68          *  Design-Wide Resources System Editor "Enable Fast IMO During Startup" setting.
  69          *  The ILO and 32 KHz oscillators are not impacted. The current Flash wait state
  70          *  setting is saved and the Flash wait state setting is set for the current IMO
  71          *  speed.
  72          *
  73          *  Note If the Master Clock source is routed through the DSI inputs, then it
  74          *  must be set manually to another source before using the
  75          *  CyPmSaveClocks()/CyPmRestoreClocks() functions.
  76          *
  77          * Parameters:
  78          *  None
  79          *
  80          * Return:
  81          *  None
  82          *
  83          * Side Effects:
  84          *  All peripheral clocks are going to be off after this API method call.
  85          *
  86          *******************************************************************************/
  87          void CyPmSaveClocks(void) 
  88          {
  89   1          /* Digital and analog clocks - save enable state and disable them all */
  90   1          cyPmClockBackup.enClkA = CY_PM_ACT_CFG1_REG & CY_PM_ACT_EN_CLK_A_MASK;
  91   1          cyPmClockBackup.enClkD = CY_PM_ACT_CFG2_REG;
  92   1          CY_PM_ACT_CFG1_REG &= ~CY_PM_ACT_EN_CLK_A_MASK;
  93   1          CY_PM_ACT_CFG2_REG &= ~CY_PM_ACT_EN_CLK_D_MASK;
  94   1      
  95   1          /* Save current flash wait cycles and set the maximum value */
  96   1          cyPmClockBackup.flashWaitCycles = CY_PM_CACHE_CR_CYCLES_MASK & CY_PM_CACHE_CR_REG;
  97   1          CyFlash_SetWaitCycles(CY_PM_MAX_FLASH_WAIT_CYCLES);
  98   1      
  99   1          /* IMO - save current IMO MHz OSC frequency and USB mode is on bit */
 100   1          cyPmClockBackup.imoFreq = CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_FREQ_MASK;
 101   1          cyPmClockBackup.imoUsbClk = CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_USB;
 102   1      
 103   1          /* IMO doubler - save enable state */
 104   1          if(0u != (CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_F2XON))
 105   1          {
 106   2              /* IMO doubler enabled - save and disable */
 107   2              cyPmClockBackup.imo2x = CY_PM_ENABLED;
 108   2          }
 109   1          else
 110   1          {
 111   2              /* IMO doubler disabled */
 112   2              cyPmClockBackup.imo2x = CY_PM_DISABLED;
 113   2          }
 114   1      
 115   1          /* IMO - set appropriate frequency for LPM */
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 3   

 116   1          CyIMO_SetFreq(CY_PM_IMO_FREQ_LPM);
 117   1      
 118   1          /* IMO - save enable state and enable without wait to settle */
 119   1          if(0u != (CY_PM_ACT_CFG0_IMO & CY_PM_ACT_CFG0_REG))
 120   1          {
 121   2              /* IMO - save enabled state */
 122   2              cyPmClockBackup.imoEnable = CY_PM_ENABLED;
 123   2          }
 124   1          else
 125   1          {
 126   2              /* IMO - save disabled state */
 127   2              cyPmClockBackup.imoEnable = CY_PM_DISABLED;
 128   2      
 129   2              /* IMO - enable */
 130   2              CyIMO_Start(CY_PM_IMO_NO_WAIT_TO_SETTLE);
 131   2          }
 132   1      
 133   1          /* IMO - save the current IMOCLK source and set to IMO if not yet */
 134   1          if(0u != (CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_XCLKEN))
 135   1          {
 136   2              /* DSI or XTAL CLK */
 137   2              cyPmClockBackup.imoClkSrc =
 138   2                  (0u == (CY_PM_CLKDIST_CR_REG & CY_PM_CLKDIST_IMO2X_SRC)) ? CY_IMO_SOURCE_DSI : CY_IMO_SOURCE_X
             -TAL;
 139   2      
 140   2              /* IMO -  set IMOCLK source to MHz OSC */
 141   2              CyIMO_SetSource(CY_IMO_SOURCE_IMO);
 142   2          }
 143   1          else
 144   1          {
 145   2              /* IMO */
 146   2              cyPmClockBackup.imoClkSrc = CY_IMO_SOURCE_IMO;
 147   2          }
 148   1      
 149   1          /* Save clk_imo source */
 150   1          cyPmClockBackup.clkImoSrc = CY_PM_CLKDIST_CR_REG & CY_PM_CLKDIST_IMO_OUT_MASK;
 151   1      
 152   1          /* If IMOCLK2X or SPC OSC is source for clk_imo, set it to IMOCLK */
 153   1          if(CY_PM_CLKDIST_IMO_OUT_IMO != cyPmClockBackup.clkImoSrc)
 154   1          {
 155   2              /* Set IMOCLK to source for clk_imo */
 156   2              CY_PM_CLKDIST_CR_REG = (CY_PM_CLKDIST_CR_REG & ~CY_PM_CLKDIST_IMO_OUT_MASK) |
 157   2                                      CY_PM_CLKDIST_IMO_OUT_IMO;
 158   2          }    /* Need to change nothing if IMOCLK is source clk_imo */
 159   1      
 160   1          /* IMO doubler - disable it (saved above) */
 161   1          if(0u != (CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_F2XON))
 162   1          {
 163   2              CyIMO_DisableDoubler();
 164   2          }
 165   1      
 166   1          /* Master clock - save divider and set it to divide-by-one (if no yet) */
 167   1          cyPmClockBackup.clkSyncDiv = CY_PM_CLKDIST_MSTR0_REG;
 168   1          if(CY_PM_DIV_BY_ONE != cyPmClockBackup.clkSyncDiv)
 169   1          {
 170   2              CyMasterClk_SetDivider(CY_PM_DIV_BY_ONE);
 171   2          }    /* Need to change nothing if master clock divider is 1 */
 172   1      
 173   1          /* Master clock - save current source */
 174   1          cyPmClockBackup.masterClkSrc = CY_PM_CLKDIST_MSTR1_REG & CY_PM_MASTER_CLK_SRC_MASK;
 175   1      
 176   1          /* Master clock source - set it to IMO if not yet. */
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 4   

 177   1          if(CY_MASTER_SOURCE_IMO != cyPmClockBackup.masterClkSrc)
 178   1          {
 179   2              CyMasterClk_SetSource(CY_MASTER_SOURCE_IMO);
 180   2          }    /* Need to change nothing if master clock source is IMO */
 181   1      
 182   1          /* Bus clock - save divider and set it, if needed, to divide-by-one */
 183   1          cyPmClockBackup.clkBusDiv = ((uint16) CY_PM_CLK_BUS_MSB_DIV_REG << 8u) | CY_PM_CLK_BUS_LSB_DIV_REG;
 184   1          if(CY_PM_BUS_CLK_DIV_BY_ONE != cyPmClockBackup.clkBusDiv)
 185   1          {
 186   2              CyBusClk_SetDivider(CY_PM_BUS_CLK_DIV_BY_ONE);
 187   2          }    /* Do nothing if saved and actual values are equal */
 188   1      
 189   1          /* Set number of wait cycles for the flash according CPU frequency in MHz */
 190   1          CyFlash_SetWaitCycles(CY_PM_GET_CPU_FREQ_MHZ);
 191   1      
 192   1          /* PLL - check enable state, disable if needed */
 193   1          if(0u != (CY_PM_FASTCLK_PLL_CFG0_REG & CY_PM_PLL_CFG0_ENABLE))
 194   1          {
 195   2              /* PLL is enabled - save state and disable */
 196   2              cyPmClockBackup.pllEnableState = CY_PM_ENABLED;
 197   2              CyPLL_OUT_Stop();
 198   2          }
 199   1          else
 200   1          {
 201   2              /* PLL is disabled - save state */
 202   2              cyPmClockBackup.pllEnableState = CY_PM_DISABLED;
 203   2          }
 204   1      
 205   1          /* MHz ECO - check enable state and disable if needed */
 206   1          if(0u != (CY_PM_FASTCLK_XMHZ_CSR_REG & CY_PM_XMHZ_CSR_ENABLE))
 207   1          {
 208   2              /* MHz ECO is enabled - save state and disable */
 209   2              cyPmClockBackup.xmhzEnableState = CY_PM_ENABLED;
 210   2              CyXTAL_Stop();
 211   2          }
 212   1          else
 213   1          {
 214   2              /* MHz ECO is disabled - save state */
 215   2              cyPmClockBackup.xmhzEnableState = CY_PM_DISABLED;
 216   2          }
 217   1      }
 218          
 219          
 220          /*******************************************************************************
 221          * Function Name: CyPmRestoreClocks
 222          ********************************************************************************
 223          *
 224          * Summary:
 225          *  Restores any state that was preserved by the last call to CyPmSaveClocks().
 226          *  The Flash wait state setting is also restored.
 227          *
 228          *  Note If the Master Clock source is routed through the DSI inputs, then it
 229          *  must be set manually to another source before using the
 230          *  CyPmSaveClocks()/CyPmRestoreClocks() functions.
 231          *
 232          *  PSoC3 ES3: The merge region could be used to process state when the megahertz
 233          *  crystal is not ready after the hold-off timeout.
 234          *
 235          *  PSoC5: The 130 ms is given for the megahertz crystal to stabilize. It's
 236          *  readiness is not verified after the hold-off timeout.
 237          *
 238          * Parameters:
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 5   

 239          *  None
 240          *
 241          * Return:
 242          *  None
 243          *
 244          *******************************************************************************/
 245          void CyPmRestoreClocks(void) 
 246          {
 247   1          #if !(CY_PSOC5A)
 248   1      
 249   1              cystatus status = CYRET_TIMEOUT;
 250   1              uint16 i;
 251   1      
 252   1          #endif  /* !(CY_PSOC5A) */
 253   1      
 254   1          /* Convertion table between CyIMO_SetFreq() parameters and register's value */
 255   1          const uint8 CYCODE cyPmImoFreqMhz2Reg[7u] = {
 256   1              CY_IMO_FREQ_12MHZ, CY_IMO_FREQ_6MHZ,  CY_IMO_FREQ_24MHZ, CY_IMO_FREQ_3MHZ,
 257   1              CY_IMO_FREQ_48MHZ, 5, 6};
 258   1      
 259   1          /* MHz ECO restore state */
 260   1          if(CY_PM_ENABLED == cyPmClockBackup.xmhzEnableState)
 261   1          {
 262   2              /***********************************************************************
 263   2              * Enabling XMHZ XTAL. The actual CyXTAL_Start() with non zero wait
 264   2              * period uses FTW for period measurement. This could cause a problem
 265   2              * if CTW/FTW is used as a wake up time in the low power modes APIs.
 266   2              * So, the XTAL wait procedure is implemented with a software delay.
 267   2              ***********************************************************************/
 268   2      
 269   2              /* Enable XMHZ XTAL with no wait */
 270   2              (void) CyXTAL_Start(CY_PM_XTAL_MHZ_NO_WAIT);
 271   2      
 272   2              #if(CY_PSOC5A)
              
                          /* Make a 130 milliseconds delay */
                          CyDelayCycles(CY_PM_WAIT_200_US * CY_PM_MHZ_XTAL_WAIT_NUM_OF_200_US * CY_PM_GET_CPU_FREQ_MHZ);
              
                      #else
 278   2      
 279   2                  /* Read XERR bit to clear it */
 280   2                  (void) CY_PM_FASTCLK_XMHZ_CSR_REG;
 281   2      
 282   2                  /* Wait */
 283   2                  for(i = CY_PM_MHZ_XTAL_WAIT_NUM_OF_200_US; i > 0u; i--)
 284   2                  {
 285   3                      /* Make a 200 microseconds delay */
 286   3                      CyDelayCycles(CY_PM_WAIT_200_US * CY_PM_GET_CPU_FREQ_MHZ);
 287   3      
 288   3                      /* High output indicates oscillator failure */
 289   3                      if(0u == (CY_PM_FASTCLK_XMHZ_CSR_REG & CY_PM_XMHZ_CSR_XERR))
 290   3                      {
 291   4                          status = CYRET_SUCCESS;
 292   4                          break;
 293   4                      }
 294   3                  }
 295   2      
 296   2                  if(CYRET_TIMEOUT == status)
 297   2                  {
 298   3                      /*******************************************************************
 299   3                      * Process the situation when megahertz crystal is not ready.
 300   3                      * Time to stabialize value is crystal specific.
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 6   

 301   3                      *******************************************************************/
 302   3      
 303   3                      /* `#START_MHZ_ECO_TIMEOUT` */
 304   3      
 305   3                      /* `#END` */
 306   3                  }
 307   2      
 308   2              #endif  /* (CY_PSOC5A) */
 309   2      
 310   2          }   /* (CY_PM_ENABLED == cyPmClockBackup.xmhzEnableState) */
 311   1      
 312   1      
 313   1          /* Temprorary set the maximum flash wait cycles */
 314   1          CyFlash_SetWaitCycles(CY_PM_MAX_FLASH_WAIT_CYCLES);
 315   1      
 316   1          /* The XTAL and DSI clocks are ready to be source for Master clock. */
 317   1          if((CY_PM_MASTER_CLK_SRC_XTAL == cyPmClockBackup.masterClkSrc) ||
 318   1             (CY_PM_MASTER_CLK_SRC_DSI  == cyPmClockBackup.masterClkSrc))
 319   1          {
 320   2              /* Restore Master clock's divider */
 321   2              if(CY_PM_CLKDIST_MSTR0_REG != cyPmClockBackup.clkSyncDiv)
 322   2              {
 323   3                  /* Restore Master clock divider */
 324   3                  CyMasterClk_SetDivider(cyPmClockBackup.clkSyncDiv);
 325   3              }
 326   2      
 327   2              /* Restore Master clock source */
 328   2              CyMasterClk_SetSource(cyPmClockBackup.masterClkSrc);
 329   2          }
 330   1      
 331   1          /* IMO - restore IMO frequency */
 332   1          if((0u != (cyPmClockBackup.imoUsbClk & CY_PM_FASTCLK_IMO_CR_USB)) &&
 333   1              (CY_IMO_FREQ_24MHZ == cyPmImoFreqMhz2Reg[cyPmClockBackup.imoFreq]))
 334   1          {
 335   2              /* Restore IMO frequency (24 MHz) and trim it for USB */
 336   2              CyIMO_SetFreq(CY_IMO_FREQ_USB);
 337   2          }
 338   1          else
 339   1          {
 340   2              /* Restore IMO frequency */
 341   2              CyIMO_SetFreq(cyPmImoFreqMhz2Reg[cyPmClockBackup.imoFreq]);
 342   2      
 343   2              if(0u != (cyPmClockBackup.imoUsbClk & CY_PM_FASTCLK_IMO_CR_USB))
 344   2              {
 345   3                  CY_PM_FASTCLK_IMO_CR_REG |= CY_PM_FASTCLK_IMO_CR_USB;
 346   3              }
 347   2              else
 348   2              {
 349   3                  CY_PM_FASTCLK_IMO_CR_REG &= ~CY_PM_FASTCLK_IMO_CR_USB;
 350   3              }
 351   2          }
 352   1      
 353   1          /* IMO - restore enable state if needed */
 354   1          if((CY_PM_ENABLED == cyPmClockBackup.imoEnable) &&
 355   1             (0u == (CY_PM_ACT_CFG0_IMO & CY_PM_ACT_CFG0_REG)))
 356   1          {
 357   2              /* IMO - restore enabled state */
 358   2              CyIMO_Start(CY_PM_IMO_NO_WAIT_TO_SETTLE);
 359   2          }
 360   1      
 361   1          /* IMO - restore disable state if needed */
 362   1          if((CY_PM_DISABLED == cyPmClockBackup.imoEnable) &&
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 7   

 363   1             (0u != (CY_PM_ACT_CFG0_IMO & CY_PM_ACT_CFG0_REG)))
 364   1          {
 365   2              CyIMO_Stop();
 366   2          }
 367   1      
 368   1          /* IMO - restore IMOCLK source */
 369   1          CyIMO_SetSource(cyPmClockBackup.imoClkSrc);
 370   1      
 371   1          /* Restore IMO doubler enable state (turned off by CyPmSaveClocks()) */
 372   1          if(CY_PM_ENABLED == cyPmClockBackup.imo2x)
 373   1          {
 374   2              CyIMO_EnableDoubler();
 375   2          }
 376   1      
 377   1          /* IMO - restore clk_imo source, if needed */
 378   1          if(cyPmClockBackup.clkImoSrc != (CY_PM_CLKDIST_CR_REG & CY_PM_CLKDIST_IMO_OUT_MASK))
 379   1          {
 380   2              CY_PM_CLKDIST_CR_REG = (CY_PM_CLKDIST_CR_REG & ~CY_PM_CLKDIST_IMO_OUT_MASK) |
 381   2                                      cyPmClockBackup.clkImoSrc;
 382   2          }
 383   1      
 384   1          /* PLL restore state */
 385   1          if(CY_PM_ENABLED == cyPmClockBackup.pllEnableState)
 386   1          {
 387   2              /***********************************************************************
 388   2              * Enable PLL. The actual CyPLL_OUT_Start() without wait period uses FTW
 389   2              * for period measurement. This could cause a problem if CTW/FTW is used
 390   2              * as a wakeup time in the low power modes APIs. To omit this issue PLL
 391   2              * wait procedure is implemented with a software delay.
 392   2              ***********************************************************************/
 393   2      
 394   2              /* Enable PLL */
 395   2              (void) CyPLL_OUT_Start(CY_PM_PLL_OUT_NO_WAIT);
 396   2      
 397   2              /* Make a 250 us delay */
 398   2              CyDelayCycles(CY_PM_WAIT_250_US * CY_PM_GET_CPU_FREQ_MHZ);
 399   2          }   /* (CY_PM_ENABLED == cyPmClockBackup.pllEnableState) */
 400   1      
 401   1      
 402   1          /* PLL and IMO is ready to be source for Master clock */
 403   1          if((CY_PM_MASTER_CLK_SRC_IMO == cyPmClockBackup.masterClkSrc) ||
 404   1             (CY_PM_MASTER_CLK_SRC_PLL == cyPmClockBackup.masterClkSrc))
 405   1          {
 406   2              /* Restore Master clock divider */
 407   2              if(CY_PM_CLKDIST_MSTR0_REG != cyPmClockBackup.clkSyncDiv)
 408   2              {
 409   3                  CyMasterClk_SetDivider(cyPmClockBackup.clkSyncDiv);
 410   3              }
 411   2      
 412   2              /* Restore Master clock source */
 413   2              CyMasterClk_SetSource(cyPmClockBackup.masterClkSrc);
 414   2          }
 415   1      
 416   1          /* Bus clock - restore divider, if needed */
 417   1          if(cyPmClockBackup.clkBusDiv != (((uint16) CY_PM_CLK_BUS_MSB_DIV_REG << 8u) | CY_PM_CLK_BUS_LSB_DIV_RE
             -G))
 418   1          {
 419   2              CyBusClk_SetDivider(cyPmClockBackup.clkBusDiv);
 420   2          }
 421   1      
 422   1          /* Restore flash wait cycles */
 423   1          CY_PM_CACHE_CR_REG = ((CY_PM_CACHE_CR_REG & ~CY_PM_CACHE_CR_CYCLES_MASK) |
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 8   

 424   1                                 cyPmClockBackup.flashWaitCycles);
 425   1      
 426   1          /* Digital and analog clocks - restore state */
 427   1          CY_PM_ACT_CFG1_REG = cyPmClockBackup.enClkA;
 428   1          CY_PM_ACT_CFG2_REG = cyPmClockBackup.enClkD;
 429   1      }
 430          
 431          
 432          /*******************************************************************************
 433          * Function Name: CyPmAltAct
 434          ********************************************************************************
 435          *
 436          * Summary:
 437          *  Puts the part into the Alternate Active (Standby) state. The Alternate Active
 438          *  state can allow for any of the capabilities of the device to be active, but
 439          *  the operation of this function is dependent on the CPU being disabled during
 440          *  the Alternate Active state. The configuration code and the component APIs
 441          *  will configure the template for the Alternate Active state to be the same as
 442          *  the Active state with the exception that the CPU will be disabled during
 443          *  Alternate Active.
 444          *
 445          *  Note Before calling this function, you must manually configure the power mode
 446          *  of the source clocks for the timer that is used as the wakeup timer.
 447          *
 448          *  PSoC3:
 449          *  Before switching to Alternate Active, if a wakeupTime other than NONE is
 450          *  specified, then the appropriate timer state is configured as specified with
 451          *  the interrupt for that timer disabled.  The wakeup source will be the
 452          *  combination of the values specified in the wakeupSource and any timer
 453          *  specified in the wakeupTime argument.  Once the wakeup condition is
 454          *  satisfied, then all saved state is restored and the function returns in the
 455          *  Active state.
 456          *
 457          *  Note that if the wakeupTime is made with a different value, the period before
 458          *  the wakeup occurs can be significantly shorter than the specified time.  If
 459          *  the next call is made with the same wakeupTime value, then the wakeup will
 460          *  occur the specified period after the previous wakeup occurred.
 461          *
 462          *  If a wakeupTime other than NONE is specified, then upon exit the state of the
 463          *  specified timer will be left as specified by wakeupTime with the timer
 464          *  enabled and the interrupt disabled.  If the CTW, FTW or One PPS is already
 465          *  configured for wakeup, for example with the SleepTimer or RTC components,
 466          *  then specify NONE for the wakeupTime and include the appropriate source for
 467          *  wakeupSource.
 468          *
 469          *  PSoC 5:
 470          *  Neither of the parameters to this function are used for PSoC 5. The device
 471          *  will go into Alternate Active mode until an enabled interrupt occurs.
 472          *
 473          * Parameters:
 474          *  wakeupTime: Specifies a timer wakeup source and the frequency of that
 475          *              source. For PSoC 5 this parameter is ignored.
 476          *
 477          *           Define                      Time
 478          *  PM_ALT_ACT_TIME_NONE             None
 479          *  PM_ALT_ACT_TIME_ONE_PPS          One PPS: 1 second
 480          *  PM_ALT_ACT_TIME_CTW_2MS          CTW: 2 ms
 481          *  PM_ALT_ACT_TIME_CTW_4MS          CTW: 4 ms
 482          *  PM_ALT_ACT_TIME_CTW_8MS          CTW: 8 ms
 483          *  PM_ALT_ACT_TIME_CTW_16MS         CTW: 16 ms
 484          *  PM_ALT_ACT_TIME_CTW_32MS         CTW: 32 ms
 485          *  PM_ALT_ACT_TIME_CTW_64MS         CTW: 64 ms
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 9   

 486          *  PM_ALT_ACT_TIME_CTW_128MS        CTW: 128 ms
 487          *  PM_ALT_ACT_TIME_CTW_256MS        CTW: 256 ms
 488          *  PM_ALT_ACT_TIME_CTW_512MS        CTW: 512 ms
 489          *  PM_ALT_ACT_TIME_CTW_1024MS       CTW: 1024 ms
 490          *  PM_ALT_ACT_TIME_CTW_2048MS       CTW: 2048 ms
 491          *  PM_ALT_ACT_TIME_CTW_4096MS       CTW: 4096 ms
 492          *  PM_ALT_ACT_TIME_FTW(1-256)*       FTW: 10us to 2.56 ms
 493          *
 494          *  *Note:   PM_ALT_ACT_TIME_FTW() is a macro that takes an argument that
 495          *           specifies how many increments of 10 us to delay.
 496                      For PSoC3 ES3 silicon the valid range of  values is 1 to 256.
 497          *
 498          *  wakeUpSource:    Specifies a bitwise mask of wakeup sources. In addition, if
 499          *                   a wakeupTime has been specified the associated timer will be
 500          *                   included as a wakeup source. For PSoC 5 this parameter is
 501          *                   ignored.
 502          *
 503          *           Define                      Source
 504          *  PM_ALT_ACT_SRC_NONE              None
 505          *  PM_ALT_ACT_SRC_COMPARATOR0       Comparator 0
 506          *  PM_ALT_ACT_SRC_COMPARATOR1       Comparator 1
 507          *  PM_ALT_ACT_SRC_COMPARATOR2       Comparator 2
 508          *  PM_ALT_ACT_SRC_COMPARATOR3       Comparator 3
 509          *  PM_ALT_ACT_SRC_INTERRUPT         Interrupt
 510          *  PM_ALT_ACT_SRC_PICU              PICU
 511          *  PM_ALT_ACT_SRC_I2C               I2C
 512          *  PM_ALT_ACT_SRC_BOOSTCONVERTER    Boost Converter
 513          *  PM_ALT_ACT_SRC_FTW               Fast Timewheel*
 514          *  PM_ALT_ACT_SRC_VD                High and Low Voltage Detection (HVI, LVI)*
 515          *  PM_ALT_ACT_SRC_CTW               Central Timewheel**
 516          *  PM_ALT_ACT_SRC_ONE_PPS           One PPS**
 517          *  PM_ALT_ACT_SRC_LCD               LCD
 518          *
 519          *  *Note : FTW and HVI/LVI wakeup signals are in the same mask bit.
 520          *  **Note: CTW and One PPS wakeup signals are in the same mask bit.
 521          *
 522          *  When specifying a Comparator as the wakeupSource an instance specific define
 523          *  should be used that will track with the specific comparator that the instance
 524          *  is placed into. As an example, for a Comparator instance named MyComp the
 525          *  value to OR into the mask is: MyComp_ctComp__CMP_MASK.
 526          *
 527          *  When CTW, FTW or One PPS is used as a wakeup source, the CyPmReadStatus()
 528          *  function must be called upon wakeup with corresponding parameter. Please
 529          *  refer to the CyPmReadStatus() API in the System Reference Guide for more
 530          *  information.
 531          *
 532          * Return:
 533          *  None
 534          *
 535          * Reentrant:
 536          *  No
 537          *
 538          * Side Effects:
 539          *  For PSoC5 silicon, the wakeup source is not selectable. In this case the
 540          *  wakeupSource argument is ignored and any of the available wakeup sources will
 541          *  wake the device.
 542          *
 543          *  If a wakeupTime other than NONE is specified, then upon exit the state of the
 544          *  specified timer will be left as specified by wakeupTime with the timer
 545          *  enabled and the interrupt disabled.  Also, the ILO 1 KHz (if CTW timer is
 546          *  used as wakeup time) or ILO 100 KHz (if FTW timer is used as wakeup time)
 547          *  will be left started.
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 10  

 548          *
 549          *******************************************************************************/
 550          void CyPmAltAct(uint16 wakeupTime, uint16 wakeupSource) 
 551          {
 552   1          #if(CY_PSOC5A)
              
                      /* Arguments expected to be 0 */
                      CYASSERT((PM_ALT_ACT_TIME_NONE == wakeupTime) &&
                               (PM_ALT_ACT_SRC_NONE  == wakeupSource));
              
                      /* To remove unreferenced local variable warning */
                      wakeupTime = wakeupTime;
                      wakeupSource = wakeupSource;
              
                  #endif /* (CY_PSOC5A) */
 563   1      
 564   1      
 565   1          #if(CY_PSOC3)
 566   1      
 567   1              /* FTW - save current and set new configuration */
 568   1              if((wakeupTime >= PM_ALT_ACT_TIME_FTW(1u)) && (wakeupTime <= PM_ALT_ACT_TIME_FTW(256u)))
 569   1              {
 570   2                  CyPmFtwSetInterval(PM_ALT_ACT_FTW_INTERVAL(wakeupTime));
 571   2      
 572   2                  /* Include associated timer to the wakeupSource */
 573   2                  wakeupSource |= PM_ALT_ACT_SRC_FTW;
 574   2              }
 575   1      
 576   1              /* CTW - save current and set new configuration */
 577   1              if((wakeupTime >= PM_ALT_ACT_TIME_CTW_2MS) && (wakeupTime <= PM_ALT_ACT_TIME_CTW_4096MS))
 578   1              {
 579   2                  /* Save current CTW configuration and set new one */
 580   2                  CyPmCtwSetInterval((wakeupTime - 1u) & CY_PM_CTW_INTERVAL_MASK);
 581   2      
 582   2                  /* Include associated timer to the wakeupSource */
 583   2                  wakeupSource |= PM_ALT_ACT_SRC_CTW;
 584   2              }
 585   1      
 586   1              /* 1PPS - save current and set new configuration */
 587   1              if(PM_ALT_ACT_TIME_ONE_PPS == wakeupTime)
 588   1              {
 589   2                  /* Save current 1PPS configuration and set new one */
 590   2                  CyPmOppsSet();
 591   2      
 592   2                  /* Include associated timer to the wakeupSource */
 593   2                  wakeupSource |= PM_ALT_ACT_SRC_ONE_PPS;
 594   2              }
 595   1      
 596   1          #endif /* (CY_PSOC3) */
 597   1      
 598   1          #if(CY_PSOC3 || CY_PSOC5LP)
 599   1      
 600   1              /* Save and set new wake up configuration */
 601   1      
 602   1              /* Interrupt, PICU, I2C, Boost converter, CTW/1PPS */
 603   1              cyPmBackup.wakeupCfg0 = CY_PM_WAKEUP_CFG0_REG;
 604   1              CY_PM_WAKEUP_CFG0_REG = (uint8) (wakeupSource >> 4u);
 605   1      
 606   1              /* Comparators */
 607   1              cyPmBackup.wakeupCfg1 = CY_PM_WAKEUP_CFG1_REG;
 608   1              CY_PM_WAKEUP_CFG1_REG = (((uint8) wakeupSource) & CY_PM_WAKEUP_SRC_CMPS_MASK);
 609   1      
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 11  

 610   1              /* LCD */
 611   1              cyPmBackup.wakeupCfg2 = CY_PM_WAKEUP_CFG2_REG;
 612   1              CY_PM_WAKEUP_CFG2_REG = ((uint8) ((wakeupSource >> 12u) & 0x01u));
 613   1      
 614   1          #endif  /* (CY_PSOC3 || CY_PSOC5LP) */
 615   1      
 616   1          /* Switch to the Alternate Active mode */
 617   1          CY_PM_MODE_CSR_REG = ((CY_PM_MODE_CSR_REG & ~CY_PM_MODE_CSR_MASK) | CY_PM_MODE_CSR_ALT_ACT);
 618   1      
 619   1          /* Recommended readback. */
 620   1          (void) CY_PM_MODE_CSR_REG;
 621   1      
 622   1          /* Two recommended NOPs to get into the mode. */
 623   1          CY_NOP;
 624   1          CY_NOP;
 625   1      
 626   1          /* Execute WFI instruction (for PSoC5 devices only) */
 627   1          CY_PM_WFI;
 628   1      
 629   1          /* Point of return from Alternate Active Mode */
 630   1      
 631   1          /* Device is PSoC 3 and the revision is ES3 or later. */
 632   1          #if(CY_PSOC3 || CY_PSOC5LP)
 633   1      
 634   1              /* Restore wake up configuration */
 635   1              CY_PM_WAKEUP_CFG0_REG = cyPmBackup.wakeupCfg0;
 636   1              CY_PM_WAKEUP_CFG1_REG = cyPmBackup.wakeupCfg1;
 637   1              CY_PM_WAKEUP_CFG2_REG = cyPmBackup.wakeupCfg2;
 638   1      
 639   1          #endif  /* (CY_PSOC3 || CY_PSOC5LP) */
 640   1      }
 641          
 642          
 643          /*******************************************************************************
 644          * Function Name: CyPmSleep
 645          ********************************************************************************
 646          *
 647          * Summary:
 648          *  Puts the part into the Sleep state.
 649          *
 650          *  Note Before calling this function, you must manually configure the power
 651          *  mode of the source clocks for the timer that is used as wakeup timer.
 652          *
 653          *  PSoC3:
 654          *  Before switching to Sleep, if a wakeupTime other than NONE is specified,
 655          *  then the appropriate timer state is configured as specified with the
 656          *  interrupt for that timer disabled.  The wakeup source will be the combination
 657          *  of the values specified in the wakeupSource and any timer specified in the
 658          *  wakeupTime argument.  Once the wakeup condition is satisfied, then all saved
 659          *  state is restored and the function returns in the Active state.
 660          *
 661          *  Note that if the wakeupTime is made with a different value, the period before
 662          *  the wakeup occurs can be significantly shorter than the specified time.  If
 663          *  the next call is made with the same wakeupTime value, then the wakeup will
 664          *  occur the specified period after the previous wakeup occurred.
 665          *
 666          *  If a wakeupTime other than NONE is specified, then upon exit the state of the
 667          *  specified timer will be left as specified by wakeupTime with the timer
 668          *  enabled and the interrupt disabled.  If the CTW or One PPS is already
 669          *  configured for wakeup, for example with the SleepTimer or RTC components,
 670          *  then specify NONE for the wakeupTime and include the appropriate source for
 671          *  wakeupSource.
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 12  

 672          *
 673          *  PSoC 5:
 674          *  Neither parameter to this function is used for PSoC 5. The device will go
 675          *  into Sleep mode until it is woken by an interrupt from the Central Time Wheel
 676          *  (CTW). The CTW must already be configured to generate an interrupt. It is
 677          *  configured using the SleepTimer component.  Only the CTW can be used to wake
 678          *  the device from sleep mode.  The other wakeup sources, Once per second or
 679          *  Port Interrupt Controller (PICU), cannot be used reliably with PSoC 5. This
 680          *  function automatically disables these interrupt sources and then restores
 681          *  them after the devices is woken by the CTW.
 682          *
 683          *  The duration of sleep needs to be controlled so that the device doesn't wake
 684          *  up too soon after going to sleep or remain asleep for too long.  Reliable
 685          *  sleep times of between 1ms and 8ms can be supported.  This requirement is
 686          *  satisfied with CTW settings of 4, 8 or 16 ms.  To control the sleep time the
 687          *  CTW is reset automatically just before putting the device to sleep.  The
 688          *  resulting wakeup time is half the duration programmed into the CTW with an
 689          *  uncertainty of 1 ms due to the arrival time of the first ILO clock edge.
 690          *  For example, the setting of 4 ms will result in a sleep time between 1 ms and
 691          *  2 ms.
 692          *
 693          * Parameters:
 694          *  wakeupTime:      Specifies a timer wakeup source and the frequency of that
 695          *                   source. For PSoC 5, this parameter is ignored.
 696          *
 697          *           Define                      Time
 698          *  PM_SLEEP_TIME_NONE               None
 699          *  PM_SLEEP_TIME_ONE_PPS            One PPS: 1 second
 700          *  PM_SLEEP_TIME_CTW_2MS            CTW: 2 ms
 701          *  PM_SLEEP_TIME_CTW_4MS            CTW: 4 ms
 702          *  PM_SLEEP_TIME_CTW_8MS            CTW: 8 ms
 703          *  PM_SLEEP_TIME_CTW_16MS           CTW: 16 ms
 704          *  PM_SLEEP_TIME_CTW_32MS           CTW: 32 ms
 705          *  PM_SLEEP_TIME_CTW_64MS           CTW: 64 ms
 706          *  PM_SLEEP_TIME_CTW_128MS          CTW: 128 ms
 707          *  PM_SLEEP_TIME_CTW_256MS          CTW: 256 ms
 708          *  PM_SLEEP_TIME_CTW_512MS          CTW: 512 ms
 709          *  PM_SLEEP_TIME_CTW_1024MS         CTW: 1024 ms
 710          *  PM_SLEEP_TIME_CTW_2048MS         CTW: 2048 ms
 711          *  PM_SLEEP_TIME_CTW_4096MS         CTW: 4096 ms
 712          *
 713          *  wakeUpSource:    Specifies a bitwise mask of wakeup sources. In addition, if
 714          *                   a wakeupTime has been specified the associated timer will be
 715          *                   included as a wakeup source. For PSoC 5 this parameter is
 716          *                   ignored.
 717          *
 718          *           Define                      Source
 719          *  PM_SLEEP_SRC_NONE                None
 720          *  PM_SLEEP_SRC_COMPARATOR0         Comparator 0
 721          *  PM_SLEEP_SRC_COMPARATOR1         Comparator 1
 722          *  PM_SLEEP_SRC_COMPARATOR2         Comparator 2
 723          *  PM_SLEEP_SRC_COMPARATOR3         Comparator 3
 724          *  PM_SLEEP_SRC_PICU                PICU
 725          *  PM_SLEEP_SRC_I2C                 I2C
 726          *  PM_SLEEP_SRC_BOOSTCONVERTER      Boost Converter
 727          *  PM_SLEEP_SRC_VD                  High and Low Voltage Detection (HVI, LVI)
 728          *  PM_SLEEP_SRC_CTW                 Central Timewheel*
 729          *  PM_SLEEP_SRC_ONE_PPS             One PPS*
 730          *  PM_SLEEP_SRC_LCD                 LCD
 731          *
 732          *  *Note:   CTW and One PPS wakeup signals are in the same mask bit.
 733          *           For PSoC 5, these are in a different bit (value 1024).
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 13  

 734          *
 735          *  When specifying a Comparator as the wakeupSource an instance specific define
 736          *  should be used that will track with the specific comparator that the instance
 737          *  is placed into. As an example for a Comparator instance named MyComp the
 738          *  value to OR into the mask is: MyComp_ctComp__CMP_MASK.
 739          *
 740          *  When CTW or One PPS is used as a wakeup source, the CyPmReadStatus()
 741          *  function must be called upon wakeup with corresponding parameter. Please
 742          *  refer to the CyPmReadStatus() API in the System Reference Guide for more
 743          *  information.
 744          *
 745          * Return:
 746          *  None
 747          *
 748          * Reentrant:
 749          *  No
 750          *
 751          * Side Effects:
 752          *  For PSoC 5 silicon the wakeup source is not selectable. In this case the
 753          *  wakeupSource argument is ignored and any of the available wakeup sources will
 754          *  wake the device.
 755          *
 756          *  If a wakeupTime other than NONE is specified, then upon exit the state of the
 757          *  specified timer will be left as specified by wakeupTime with the timer
 758          *  enabled and the interrupt disabled. Also, the ILO 1 KHz (if CTW timer is
 759          *  used as wake up time) will be left started.
 760          *
 761          *  The 1 kHz ILO clock is expected to be enabled for PSoC3 silicon to
 762          *  measure Hibernate/Sleep regulator settling time after a reset. The holdoff
 763          *  delay is measured using rising edges of the 1 kHz ILO.
 764          *
 765          *******************************************************************************/
 766          void CyPmSleep(uint8 wakeupTime, uint16 wakeupSource) 
 767          {
 768   1          uint8 interruptState;
 769   1      
 770   1          /* Save current global interrupt enable and disable it */
 771   1          interruptState = CyEnterCriticalSection();
 772   1      
 773   1          /* Device is PSoC 3 and the revision is ES3 or later */
 774   1          #if(CY_PSOC3)
 775   1      
 776   1              /* Hardware buzz expected to be disabled */
 777   1              CYASSERT(0u == (CY_PM_PWRSYS_WAKE_TR2_REG & CY_PM_PWRSYS_WAKE_TR2_EN_BUZZ));
 778   1      
 779   1              /***********************************************************************
 780   1              * The Hibernate/Sleep regulator has a settling time after a reset.
 781   1              * During this time, the system ignores requests to enter Sleep and
 782   1              * Hibernate modes. The holdoff delay is measured using rising edges of
 783   1              * the 1 kHz ILO.
 784   1              ***********************************************************************/
 785   1              if(0u == (CY_PM_MODE_CSR_REG & CY_PM_MODE_CSR_PWRUP_PULSE_Q))
 786   1              {
 787   2                  /* Disable hold off - no action on restore */
 788   2                  CY_PM_PWRSYS_SLP_TR_REG &= CY_PM_PWRSYS_SLP_TR_HIBSLP_HOLDOFF_MASK;
 789   2              }
 790   1              else
 791   1              {
 792   2                  /* Abort, device is not ready for low power mode entry */
 793   2                  return;
 794   2              }
 795   1      
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 14  

 796   1          #endif /* (CY_PSOC3) */
 797   1      
 798   1      
 799   1          /* Verify correctness of the parameters */
 800   1          #if(CY_PSOC5A)
              
                      /* Arguments expected to be 0 */
                      CYASSERT((PM_SLEEP_TIME_NONE == wakeupTime) &&
                               (PM_SLEEP_SRC_NONE  == wakeupSource));
              
                      /* To remove unreferenced local variable warning */
                      wakeupTime = wakeupTime;
                      wakeupSource = wakeupSource;
              
                  #endif /* (CY_PSOC5A) */
 811   1      
 812   1      
 813   1          /* Prepare hardware for Sleep mode */
 814   1          CyPmSlpSaveSet();
 815   1      
 816   1      
 817   1          #if(CY_PSOC3)
 818   1      
 819   1              /* CTW - save current and set new configuration */
 820   1              if((wakeupTime >= PM_SLEEP_TIME_CTW_2MS) && (wakeupTime <= PM_SLEEP_TIME_CTW_4096MS))
 821   1              {
 822   2                  /* Save current and set new configuration of the CTW */
 823   2                  CyPmCtwSetInterval((wakeupTime - 1u) & CY_PM_CTW_INTERVAL_MASK);
 824   2      
 825   2                  /* Include associated timer to the wakeupSource */
 826   2                  wakeupSource |= PM_SLEEP_SRC_CTW;
 827   2              }
 828   1      
 829   1              /* 1PPS - save current and set new configuration */
 830   1              if(PM_SLEEP_TIME_ONE_PPS == wakeupTime)
 831   1              {
 832   2                  /* Save current and set new configuration of the 1PPS */
 833   2                  CyPmOppsSet();
 834   2      
 835   2                  /* Include associated timer to the wakeupSource */
 836   2                  wakeupSource |= PM_SLEEP_SRC_ONE_PPS;
 837   2              }
 838   1      
 839   1          #endif /* (CY_PSOC3) */
 840   1      
 841   1      
 842   1          #if(CY_PSOC3 || CY_PSOC5LP)
 843   1      
 844   1              /* Save and set new wake up configuration */
 845   1      
 846   1              /* Interrupt, PICU, I2C, Boost converter, CTW/1PPS */
 847   1              cyPmBackup.wakeupCfg0 = CY_PM_WAKEUP_CFG0_REG;
 848   1              CY_PM_WAKEUP_CFG0_REG = (uint8) (wakeupSource >> 4u);
 849   1      
 850   1              /* Comparators */
 851   1              cyPmBackup.wakeupCfg1 = CY_PM_WAKEUP_CFG1_REG;
 852   1              CY_PM_WAKEUP_CFG1_REG = (((uint8) wakeupSource) & CY_PM_WAKEUP_SRC_CMPS_MASK);
 853   1      
 854   1              /* LCD */
 855   1              cyPmBackup.wakeupCfg2 = CY_PM_WAKEUP_CFG2_REG;
 856   1              CY_PM_WAKEUP_CFG2_REG = ((uint8) ((wakeupSource >> 12u) & 0x01u));
 857   1      
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 15  

 858   1          #endif /* (CY_PSOC3 || CY_PSOC5LP) */
 859   1      
 860   1      
 861   1          /* Last moment IMO frequency change */
 862   1          if(0u == (CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_FREQ_MASK))
 863   1          {
 864   2              /* IMO frequency is 12 MHz */
 865   2              cyPmBackup.imoActFreq12Mhz = CY_PM_ENABLED;
 866   2          }
 867   1          else
 868   1          {
 869   2              /* IMO frequency is not 12 MHz */
 870   2              cyPmBackup.imoActFreq12Mhz = CY_PM_DISABLED;
 871   2      
 872   2              /* Save IMO frequency */
 873   2              cyPmBackup.imoActFreq = CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_FREQ_MASK;
 874   2      
 875   2              /* Set IMO frequency to 12 MHz */
 876   2              CY_PM_FASTCLK_IMO_CR_REG &= ~CY_PM_FASTCLK_IMO_CR_FREQ_MASK;
 877   2          }
 878   1      
 879   1          /* Switch to the Sleep mode */
 880   1          CY_PM_MODE_CSR_REG = ((CY_PM_MODE_CSR_REG & ~CY_PM_MODE_CSR_MASK) | CY_PM_MODE_CSR_SLEEP);
 881   1      
 882   1          /* Recommended readback. */
 883   1          (void) CY_PM_MODE_CSR_REG;
 884   1      
 885   1          /* Two recommended NOPs to get into the mode. */
 886   1          CY_NOP;
 887   1          CY_NOP;
 888   1      
 889   1          /* Execute WFI instruction (for PSoC5 devices only) */
 890   1          CY_PM_WFI;
 891   1      
 892   1          /* Point of return from Sleep Mode */
 893   1      
 894   1          /* Restore last moment IMO frequency change */
 895   1          if(CY_PM_ENABLED != cyPmBackup.imoActFreq12Mhz)
 896   1          {
 897   2              CY_PM_FASTCLK_IMO_CR_REG  = (CY_PM_FASTCLK_IMO_CR_REG & ~CY_PM_FASTCLK_IMO_CR_FREQ_MASK) |
 898   2                                          cyPmBackup.imoActFreq;
 899   2          }
 900   1      
 901   1      
 902   1          /* Restore hardware configuration */
 903   1          CyPmSlpRestore();
 904   1      
 905   1      
 906   1          /* Device is PSoC 3 and the revision is ES3 or later. */
 907   1          #if(CY_PSOC3 || CY_PSOC5LP)
 908   1      
 909   1              /* Restore current wake up configuration */
 910   1              CY_PM_WAKEUP_CFG0_REG = cyPmBackup.wakeupCfg0;
 911   1              CY_PM_WAKEUP_CFG1_REG = cyPmBackup.wakeupCfg1;
 912   1              CY_PM_WAKEUP_CFG2_REG = cyPmBackup.wakeupCfg2;
 913   1      
 914   1          #endif /* (CY_PSOC3 || CY_PSOC5LP) */
 915   1      
 916   1          /* Restore global interrupt enable state */
 917   1          CyExitCriticalSection(interruptState);
 918   1      }
 919          
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 16  

 920          
 921          /*******************************************************************************
 922          * Function Name: CyPmHibernate
 923          ********************************************************************************
 924          *
 925          * Summary:
 926          *  Puts the part into the Hibernate state.
 927          *
 928          *  PSoC3:
 929          *  Before switching to Hibernate, the current status of the PICU wakeup source
 930          *  bit is saved and then set. This configures the device to wake up from the
 931          *  PICU. Make sure you have at least one pin configured to generate a PICU
 932          *  interrupt. For pin Px.y, the register "PICU_INTTYPE_PICUx_INTTYPEy" controls
 933          *  the PICU behavior. In the TRM, this register is "PICU[0..15]_INTTYPE[0..7]."
 934          *  In the Pins component datasheet, this register is referred to as the IRQ
 935          *  option. Once the wakeup occurs, the PICU wakeup source bit is restored and
 936          *  the PSoC returns to the Active state.
 937          *
 938          *  PSoC 5:
 939          *  The only method supported for waking up from the Hibernate state is a
 940          *  hardware reset of the device.  The PICU wakeup source cannot be used
 941          *  reliably, so the PICU interrupt sources are automatically disabled by this
 942          *  function before putting the device into the Hibernate state.
 943          *
 944          * Parameters:
 945          *  None
 946          *
 947          * Return:
 948          *  None
 949          *
 950          * Reentrant:
 951          *  No
 952          *
 953          * Side Effects:
 954          *  Applications must wait 20 us before re-entering hibernate or sleep after
 955          *  waking up from hibernate. The 20 us allows the sleep regulator time to
 956          *  stabilize before the next hibernate / sleep event occurs. The 20 us
 957          *  requirement begins when the device wakes up. There is no hardware check that
 958          *  this requirement is met. The specified delay should be done on ISR entry.
 959          *
 960          *  After wakeup PICU interrupt occurs, the Pin_ClearInterrupt() (where Pin is
 961          *  instance name of the Pins component) function must be called to clear the
 962          *  latched pin events to allow proper Hibernate mode entry andd to enable
 963          *  detection of future events.
 964          *
 965          *  The 1 kHz ILO clock is expected to be enabled for PSoC3 ES3 silicon to
 966          *  measure Hibernate/Sleep regulator settling time after a reset. The holdoff
 967          *  delay is measured using rising edges of the 1 kHz ILO.
 968          *
 969          *******************************************************************************/
 970          void CyPmHibernate(void) 
 971          {
 972   1          uint8 interruptState;
 973   1      
 974   1          /* Save current global interrupt enable and disable it */
 975   1          interruptState = CyEnterCriticalSection();
 976   1      
 977   1          /* Device is PSoC 3 and the revision is ES3 or later */
 978   1          #if(CY_PSOC3)
 979   1      
 980   1              /***********************************************************************
 981   1              * The Hibernate/Sleep regulator has a settling time after a reset.
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 17  

 982   1              * During this time, the system ignores requests to enter Sleep and
 983   1              * Hibernate modes. The holdoff delay is measured using rising edges of
 984   1              * the 1 kHz ILO.
 985   1              ***********************************************************************/
 986   1              if(0u == (CY_PM_MODE_CSR_REG & CY_PM_MODE_CSR_PWRUP_PULSE_Q))
 987   1              {
 988   2                  /* Disable hold off - no action on restore */
 989   2                  CY_PM_PWRSYS_SLP_TR_REG &= CY_PM_PWRSYS_SLP_TR_HIBSLP_HOLDOFF_MASK;
 990   2              }
 991   1              else
 992   1              {
 993   2                  /* Abort, device is not ready for low power mode entry */
 994   2                  return;
 995   2              }
 996   1      
 997   1          #endif /* (CY_PSOC3) */
 998   1      
 999   1          /* Prepare device for proper Hibernate mode entry */
1000   1          CyPmHibSaveSet();
1001   1      
1002   1          /* Device is PSoC 3 and the revision is ES3 or later. */
1003   1          #if(CY_PSOC3 || CY_PSOC5LP)
1004   1      
1005   1              /* Save and enable only wakeup on PICU */
1006   1              cyPmBackup.wakeupCfg0 = CY_PM_WAKEUP_CFG0_REG;
1007   1              CY_PM_WAKEUP_CFG0_REG = CY_PM_WAKEUP_PICU;
1008   1      
1009   1              cyPmBackup.wakeupCfg1 = CY_PM_WAKEUP_CFG1_REG;
1010   1              CY_PM_WAKEUP_CFG1_REG = 0x00u;
1011   1      
1012   1              cyPmBackup.wakeupCfg2 = CY_PM_WAKEUP_CFG2_REG;
1013   1              CY_PM_WAKEUP_CFG2_REG = 0x00u;
1014   1      
1015   1          #endif  /* (CY_PSOC3 || CY_PSOC5LP) */
1016   1      
1017   1      
1018   1          /* Last moment IMO frequency change */
1019   1          if(0u == (CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_FREQ_MASK))
1020   1          {
1021   2              /* IMO frequency is 12 MHz */
1022   2              cyPmBackup.imoActFreq12Mhz = CY_PM_ENABLED;
1023   2          }
1024   1          else
1025   1          {
1026   2              /* IMO frequency is not 12 MHz */
1027   2              cyPmBackup.imoActFreq12Mhz = CY_PM_DISABLED;
1028   2      
1029   2              /* Save IMO frequency */
1030   2              cyPmBackup.imoActFreq = CY_PM_FASTCLK_IMO_CR_REG & CY_PM_FASTCLK_IMO_CR_FREQ_MASK;
1031   2      
1032   2              /* Set IMO frequency to 12 MHz */
1033   2              CY_PM_FASTCLK_IMO_CR_REG &= ~CY_PM_FASTCLK_IMO_CR_FREQ_MASK;
1034   2          }
1035   1      
1036   1      
1037   1          /* Switch to Hibernate Mode */
1038   1          CY_PM_MODE_CSR_REG = ((CY_PM_MODE_CSR_REG & ~CY_PM_MODE_CSR_MASK) | CY_PM_MODE_CSR_HIBERNATE);
1039   1      
1040   1          /* Recommended readback. */
1041   1          (void) CY_PM_MODE_CSR_REG;
1042   1      
1043   1          /* Two recommended NOPs to get into the mode. */
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 18  

1044   1          CY_NOP;
1045   1          CY_NOP;
1046   1      
1047   1          /* Execute WFI instruction (for PSoC5 devices only) */
1048   1          CY_PM_WFI;
1049   1      
1050   1          /* Point of return from Hibernate mode */
1051   1      
1052   1      
1053   1          /* Restore last moment IMO frequency change */
1054   1          if(CY_PM_ENABLED != cyPmBackup.imoActFreq12Mhz)
1055   1          {
1056   2              CY_PM_FASTCLK_IMO_CR_REG  = (CY_PM_FASTCLK_IMO_CR_REG & ~CY_PM_FASTCLK_IMO_CR_FREQ_MASK) |
1057   2                                          cyPmBackup.imoActFreq;
1058   2          }
1059   1      
1060   1      
1061   1          /* Restore device for proper Hibernate mode exit*/
1062   1          CyPmHibRestore();
1063   1      
1064   1          /* Device is PSoC 3 and the revision is ES3 or later. */
1065   1          #if(CY_PSOC3 || CY_PSOC5LP)
1066   1      
1067   1              /* Restore current wake up configuration */
1068   1              CY_PM_WAKEUP_CFG0_REG = cyPmBackup.wakeupCfg0;
1069   1              CY_PM_WAKEUP_CFG1_REG = cyPmBackup.wakeupCfg1;
1070   1              CY_PM_WAKEUP_CFG2_REG = cyPmBackup.wakeupCfg2;
1071   1      
1072   1          #endif /* (CY_PSOC3 || CY_PSOC5LP) */
1073   1      
1074   1          /* Restore global interrupt enable state */
1075   1          CyExitCriticalSection(interruptState);
1076   1      }
1077          
1078          
1079          /*******************************************************************************
1080          * Function Name: CyPmReadStatus
1081          ********************************************************************************
1082          *
1083          * Summary:
1084          *  Manages the Power Manager Interrupt Status Register.  This register has the
1085          *  interrupt status for the one pulse per second, central timewheel and fast
1086          *  timewheel timers.  This hardware register clears on read.  To allow for only
1087          *  clearing the bits of interest and preserving the other bits, this function
1088          *  uses a shadow register that retains the state.  This function reads the
1089          *  status register and ORs that value with the shadow register.  That is the
1090          *  value that is returned.  Then the bits in the mask that are set are cleared
1091          *  from this value and written back to the shadow register.
1092          *
1093          *  Note You must call this function within 1 ms (1 clock cycle of the ILO)
1094          *  after a CTW event has occurred.
1095          *
1096          * Parameters:
1097          *  mask: Bits in the shadow register to clear.
1098          *
1099          *       Define                      Source
1100          *  CY_PM_FTW_INT                Fast Timewheel
1101          *  CY_PM_CTW_INT                Central Timewheel
1102          *  CY_PM_ONEPPS_INT             One Pulse Per Second
1103          *
1104          * Return:
1105          *  Status.  Same bits values as the mask parameter.
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 19  

1106          *
1107          *******************************************************************************/
1108          uint8 CyPmReadStatus(uint8 mask) 
1109          {
1110   1          static uint8 interruptStatus;
1111   1          uint8 interruptState;
1112   1          uint8 tmpStatus;
1113   1      
1114   1          /* Enter critical section */
1115   1          interruptState = CyEnterCriticalSection();
1116   1      
1117   1          /* Save value of the register, copy it and clear desired bit */
1118   1          interruptStatus |= CY_PM_INT_SR_REG;
1119   1          tmpStatus = interruptStatus;
1120   1          interruptStatus &= ~mask;
1121   1      
1122   1          /* Exit critical section */
1123   1          CyExitCriticalSection(interruptState);
1124   1      
1125   1          return(tmpStatus);
1126   1      }
1127          
1128          
1129          /*******************************************************************************
1130          * Function Name: CyPmHibSaveSet
1131          ********************************************************************************
1132          *
1133          * Summary:
1134          *  Prepare device for proper Hibernate low power mode entry:
1135          *  - Disables I2C backup regulator
1136          *  - Saves ILO power down mode state and enable it (PSoC3 ES3)
1137          *  - Saves enable state of 1 kHz and 100 kHz ILO and disable them (PSoC3 ES3)
1138          *  - Disables sleep regulator and shorts vccd to vpwrsleep (PSoC3 ES3)
1139          *  - CyPmHibSlpSaveSet() function is called
1140          *
1141          * Parameters:
1142          *  None
1143          *
1144          * Return:
1145          *  None
1146          *
1147          * Reentrant:
1148          *  No
1149          *
1150          *******************************************************************************/
1151          static void CyPmHibSaveSet(void) 
1152          {
1153   1          /* I2C backup reg must be off when the sleep regulator is unavailable */
1154   1          if(0u != (CY_PM_PWRSYS_CR1_REG & CY_PM_PWRSYS_CR1_I2CREG_BACKUP))
1155   1          {
1156   2              /***********************************************************************
1157   2              * If I2C backup regulator is enabled, all the fixed-function registers
1158   2              * store their values while device is in low power mode, otherwise their
1159   2              * configuration is lost. The I2C API makes a decision to restore or not
1160   2              * to restore I2C registers based on this. If this regulator will be
1161   2              * disabled and then enabled, I2C API will suppose that I2C block
1162   2              * registers preserved their values, while this is not true. So, the
1163   2              * backup regulator is disabled. And its value is restored only for
1164   2              * and PSoC5 devices. The I2C sleep APIs is responsible for restoration.
1165   2              ***********************************************************************/
1166   2      
1167   2              #if(CY_PSOC5A)
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 20  

              
                          cyPmBackup.i2cRegBackup = CY_PM_ENABLED;
              
                      #endif /* (CY_PSOC5A) */
1172   2      
1173   2              /* Disable I2C backup register */
1174   2              CY_PM_PWRSYS_CR1_REG &= ~CY_PM_PWRSYS_CR1_I2CREG_BACKUP;
1175   2          }
1176   1          else
1177   1          {
1178   2              #if(CY_PSOC5A)
              
                          /* Save disabled state of the I2C backup regulator */
                          cyPmBackup.i2cRegBackup = CY_PM_DISABLED;
              
                      #endif /* (CY_PSOC5A) */
1184   2          }
1185   1      
1186   1          /* Device is PSoC 3 and the revision is ES3 or later */
1187   1          #if(CY_PSOC3)
1188   1      
1189   1              /* Save current ILO power mode and ensure low power mode */
1190   1              cyPmBackup.iloPowerMode = CyILO_SetPowerMode(CY_PM_POWERDOWN_MODE);
1191   1      
1192   1              /* Save current 1kHz ILO enable state. Disabled automatically. */
1193   1              cyPmBackup.ilo1kEnable = (0u == (CY_PM_SLOWCLK_ILO_CR0_REG & CY_PM_ILO_CR0_EN_1K)) ?
1194   1                                          CY_PM_DISABLED : CY_PM_ENABLED;
1195   1      
1196   1              /* Save current 100kHz ILO enable state. Disabled automatically. */
1197   1              cyPmBackup.ilo100kEnable = (0u == (CY_PM_SLOWCLK_ILO_CR0_REG & CY_PM_ILO_CR0_EN_100K)) ?
1198   1                                          CY_PM_DISABLED : CY_PM_ENABLED;
1199   1      
1200   1      
1201   1              if(0u == (CY_PM_PWRSYS_SLP_TR_REG & CY_PM_PWRSYS_SLP_TR_BYPASS))
1202   1              {
1203   2                  /* Save current bypass state */
1204   2                  cyPmBackup.slpTrBypass = CY_PM_DISABLED;
1205   2      
1206   2                  /* Disables the sleep regulator and shorts vccd to vpwrsleep */
1207   2                  CY_PM_PWRSYS_SLP_TR_REG |= CY_PM_PWRSYS_SLP_TR_BYPASS;
1208   2              }
1209   1              else
1210   1              {
1211   2                  /* Save current bypass state */
1212   2                  cyPmBackup.slpTrBypass = CY_PM_ENABLED;
1213   2              }
1214   1      
1215   1              /* LPCOMPs are always enabled (even when BOTH ext_vccd=1 and ext_vcca=1)*/
1216   1      
1217   1          #endif /* (CY_PSOC3) */
1218   1      
1219   1      
1220   1          /* Device is PSoC 5 and the revision is ES1 or earlier. */
1221   1          #if(CY_PSOC5A)
              
                      /* Disable all the PICU interrupts */
                      CyPmDisablePicuInterrupts();
              
                  #endif  /* (CY_PSOC5A) */
1227   1      
1228   1      
1229   1          /***************************************************************************
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 21  

1230   1          * LVI/HVI must be disabled in Hibernate
1231   1          ***************************************************************************/
1232   1      
1233   1          /* Save LVI/HVI configuration */
1234   1          cyPmBackup.lviaLvidHvi = (CY_PM_RESET_CR1_REG & CY_PM_RESET_CR1_HVI_LVI_EN_MASK);
1235   1      
1236   1          /* Disable LVI/HVI */
1237   1          CY_PM_RESET_CR1_REG &= ~CY_PM_RESET_CR1_HVI_LVI_EN_MASK;
1238   1      
1239   1      
1240   1          /* Make the same preparations for Hibernate and Sleep modes */
1241   1          CyPmHibSlpSaveSet();
1242   1      }
1243          
1244          
1245          /*******************************************************************************
1246          * Function Name: CyPmHibRestore
1247          ********************************************************************************
1248          *
1249          * Summary:
1250          *  Restore device for proper Hibernate mode exit:
1251          *  - Restore LVI/HVI configuration
1252          *  - CyPmHibSlpSaveRestore() function is called
1253          *  - Restores state of I2C backup regulator (PSoC5 ES1)
1254          *  - Restores ILO power down mode state and enable it (PSoC3 ES3)
1255          *  - Restores enable state of 1 kHz and 100 kHz ILO and disable them (PSoC3 ES3)
1256          *  - Restores sleep regulator settings (PSoC3 ES3)
1257          *
1258          * Parameters:
1259          *  None
1260          *
1261          * Return:
1262          *  None
1263          *
1264          *******************************************************************************/
1265          static void CyPmHibRestore(void) 
1266          {
1267   1      
1268   1          /* Restore LVI/HVI configuration */
1269   1          CY_PM_RESET_CR1_REG |= cyPmBackup.lviaLvidHvi;
1270   1      
1271   1          /* Restore the same configuration for Hibernate and Sleep modes */
1272   1          CyPmHibSlpRestore();
1273   1      
1274   1          #if(CY_PSOC5A)
              
                      /* Restore I2C backup regulator configuration */
                      if(CY_PM_ENABLED == cyPmBackup.i2cRegBackup)
                      {
                          /* Enable I2C backup regulator state */
                          CY_PM_PWRSYS_CR1_REG |= CY_PM_PWRSYS_CR1_I2CREG_BACKUP;
                      }
              
                  #endif /* (CY_PSOC5A) */
1284   1      
1285   1          /* Device is PSoC 3 and the revision is ES3 or later */
1286   1          #if(CY_PSOC3)
1287   1      
1288   1              /* Restore 1kHz ILO enable state */
1289   1              if(CY_PM_ENABLED == cyPmBackup.ilo1kEnable)
1290   1              {
1291   2                  /* Enable 1kHz ILO */
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 22  

1292   2                  CyILO_Start1K();
1293   2              }
1294   1      
1295   1              /* Restore 100kHz ILO enable state */
1296   1              if(CY_PM_ENABLED == cyPmBackup.ilo100kEnable)
1297   1              {
1298   2                  /* Enable 100kHz ILO */
1299   2                  CyILO_Start100K();
1300   2              }
1301   1      
1302   1              /* Restore ILO power mode */
1303   1              (void) CyILO_SetPowerMode(cyPmBackup.iloPowerMode);
1304   1      
1305   1      
1306   1              if(CY_PM_DISABLED == cyPmBackup.slpTrBypass)
1307   1              {
1308   2                  /* Enable the sleep regulator */
1309   2                  CY_PM_PWRSYS_SLP_TR_REG &= ~CY_PM_PWRSYS_SLP_TR_BYPASS;
1310   2              }
1311   1      
1312   1          #endif /* (CY_PSOC3) */
1313   1      }
1314          
1315          
1316          /*******************************************************************************
1317          * Function Name: CyPmCtwSetInterval
1318          ********************************************************************************
1319          *
1320          * Summary:
1321          *  Performs CTW configuration:
1322          *  - Disables CTW interrupt
1323          *  - Enables 1 kHz ILO
1324          *  - Sets new CTW interval
1325          *
1326          * Parameters:
1327          *  ctwInterval: the CTW interval to be set.
1328          *
1329          * Return:
1330          *  None
1331          *
1332          * Side Effects:
1333          *  Enables ILO 1 KHz clock and leaves it enabled.
1334          *
1335          *******************************************************************************/
1336          void CyPmCtwSetInterval(uint8 ctwInterval) 
1337          {
1338   1          /* Disable CTW interrupt enable */
1339   1          CY_PM_TW_CFG2_REG &= ~CY_PM_CTW_IE;
1340   1      
1341   1          /* Enable 1kHz ILO (required for CTW operation) */
1342   1          CyILO_Start1K();
1343   1      
1344   1          /* Interval could be set only while CTW is disabled */
1345   1          if(0u != (CY_PM_TW_CFG2_REG & CY_PM_CTW_EN))
1346   1          {
1347   2              /* Set CTW interval if needed */
1348   2              if(CY_PM_TW_CFG1_REG != ctwInterval)
1349   2              {
1350   3                  /* Disable the CTW, set new CTW interval and enable it again */
1351   3                  CY_PM_TW_CFG2_REG &= ~CY_PM_CTW_EN;
1352   3                  CY_PM_TW_CFG1_REG = ctwInterval;
1353   3                  CY_PM_TW_CFG2_REG |= CY_PM_CTW_EN;
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 23  

1354   3              }   /* Required interval is already set */
1355   2          }
1356   1          else
1357   1          {
1358   2              /* Set CTW interval if needed */
1359   2              if(CY_PM_TW_CFG1_REG != ctwInterval)
1360   2              {
1361   3                  /* Set the new CTW interval. Could be changed if CTW is disabled */
1362   3                  CY_PM_TW_CFG1_REG = ctwInterval;
1363   3              }   /* Required interval is already set */
1364   2      
1365   2              /* Enable the CTW */
1366   2              CY_PM_TW_CFG2_REG |= CY_PM_CTW_EN;
1367   2          }
1368   1      }
1369          
1370          
1371          /*******************************************************************************
1372          * Function Name: CyPmOppsSet
1373          ********************************************************************************
1374          *
1375          * Summary:
1376          *  Performs 1PPS configuration:
1377          *  - Starts 32 KHz XTAL
1378          *  - Disables 1PPS interupts
1379          *  - Enables 1PPS
1380          *
1381          * Parameters:
1382          *  None
1383          *
1384          * Return:
1385          *  None
1386          *
1387          *******************************************************************************/
1388          void CyPmOppsSet(void) 
1389          {
1390   1          /* Enable 32kHz XTAL if needed */
1391   1          if(0u == (CY_PM_SLOWCLK_X32_CR_REG & CY_PM_X32_CR_X32EN))
1392   1          {
1393   2              /* Enable 32kHz XTAL */
1394   2              CyXTAL_32KHZ_Start();
1395   2          }
1396   1      
1397   1          /* Disable 1PPS interrupt enable */
1398   1          CY_PM_TW_CFG2_REG &= ~CY_PM_1PPS_IE;
1399   1      
1400   1          /* Enable 1PPS operation */
1401   1          CY_PM_TW_CFG2_REG |= CY_PM_1PPS_EN;
1402   1      }
1403          
1404          
1405          /*******************************************************************************
1406          * Function Name: CyPmFtwSetInterval
1407          ********************************************************************************
1408          *
1409          * Summary:
1410          *  Performs FTW configuration:
1411          *  - Disables FTW interrupt
1412          *  - Enables 100 kHz ILO
1413          *  - Sets new FTW interval.
1414          *
1415          * Parameters:
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 24  

1416          *  ftwInterval - FTW counter interval.
1417          *
1418          * Return:
1419          *  None
1420          *
1421          * Side Effects:
1422          *  Enables ILO 100 KHz clock and leaves it enabled.
1423          *
1424          *******************************************************************************/
1425          void CyPmFtwSetInterval(uint8 ftwInterval) 
1426          {
1427   1          /* Disable FTW interrupt enable */
1428   1          CY_PM_TW_CFG2_REG &= ~CY_PM_FTW_IE;
1429   1      
1430   1          /* Enable 100kHz ILO */
1431   1          CyILO_Start100K();
1432   1      
1433   1          /* Iterval could be set only while FTW is disabled */
1434   1          if(0u != (CY_PM_TW_CFG2_REG & CY_PM_FTW_EN))
1435   1          {
1436   2              /* Disable FTW, set new FTW interval if needed and enable it again */
1437   2              if(CY_PM_TW_CFG0_REG != ftwInterval)
1438   2              {
1439   3                  /* Disable the CTW, set new CTW interval and enable it again */
1440   3                  CY_PM_TW_CFG2_REG &= ~CY_PM_FTW_EN;
1441   3                  CY_PM_TW_CFG0_REG = ftwInterval;
1442   3                  CY_PM_TW_CFG2_REG |= CY_PM_FTW_EN;
1443   3              }   /* Required interval is already set */
1444   2          }
1445   1          else
1446   1          {
1447   2              /* Set new FTW counter interval if needed. FTW is disabled. */
1448   2              if(CY_PM_TW_CFG0_REG != ftwInterval)
1449   2              {
1450   3                  /* Set the new CTW interval. Could be changed if CTW is disabled */
1451   3                  CY_PM_TW_CFG0_REG = ftwInterval;
1452   3              }   /* Required interval is already set */
1453   2      
1454   2              /* Enable the FTW */
1455   2              CY_PM_TW_CFG2_REG |= CY_PM_FTW_EN;
1456   2          }
1457   1      }
1458          
1459          
1460          #if(CY_PSOC5A)
              
                  /*******************************************************************************
                  * Function Name: CyPmSavePicuInterrupts
                  ********************************************************************************
                  *
                  * Summary:
                  *  Saves PICU interrupt type registers to the backup structure.
                  *
                  * Parameters:
                  *  None
                  *
                  * Return:
                  *  None
                  *
                  * Reentrant:
                  *  No
                  *
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 25  

                  *******************************************************************************/
                  static void CyPmSavePicuInterrupts(void) 
                  {
                      /* Save all the PICU interrupt type */
                      memcpy((void *) &cyPmBackup.picuIntType[0u],
                             (void *) CY_PM_PICU_0_6_INT_BASE,
                             CY_PM_PICU_0_6_INT_SIZE);
              
                      memcpy((void *) &cyPmBackup.picuIntType[CY_PM_PICU_0_6_INT_SIZE],
                             (void *) CY_PM_PICU_12_INT_BASE,
                             CY_PM_PICU_12_INT_SIZE);
              
                      memcpy((void *) &cyPmBackup.picuIntType[CY_PM_PICU_0_6_INT_SIZE + CY_PM_PICU_12_INT_SIZE],
                             (void *) CY_PM_PICU_15_INT_BASE,
                             CY_PM_PICU_15_INT_SIZE);
              
                  }
              
              
                  /*******************************************************************************
                  * Function Name: CyPmDisablePicuInterrupts
                  ********************************************************************************
                  *
                  * Summary:
                  *  Disableds PICU interrupts.
                  *
                  * Parameters:
                  *  None
                  *
                  * Return:
                  *  None
                  *
                  *******************************************************************************/
                  static void CyPmDisablePicuInterrupts(void) 
                  {
                      /* Disable all the PICU interrupts */
                      memset((void *) CY_PM_PICU_0_6_INT_BASE, 0, CY_PM_PICU_0_6_INT_SIZE);
                      memset((void *) CY_PM_PICU_12_INT_BASE,  0, CY_PM_PICU_12_INT_SIZE );
                      memset((void *) CY_PM_PICU_15_INT_BASE,  0, CY_PM_PICU_15_INT_SIZE );
                  }
              
              
                  /*******************************************************************************
                  * Function Name: CyPmRestorePicuInterrupts
                  ********************************************************************************
                  *
                  * Summary:
                  *  Restores PICU interrupt type registers from the backup structure.
                  *
                  * Parameters:
                  *  None
                  *
                  * Return:
                  *  None
                  *
                  *******************************************************************************/
                  static void CyPmRestorePicuInterrupts(void) 
                  {
                      /* Save all the PICU interrupt type */
                      memcpy((void *) CY_PM_PICU_0_6_INT_BASE,
                             (void *) &cyPmBackup.picuIntType[0u],
                             CY_PM_PICU_0_6_INT_SIZE);
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 26  

              
                      memcpy((void *) CY_PM_PICU_12_INT_BASE,
                             (void *) &cyPmBackup.picuIntType[CY_PM_PICU_0_6_INT_SIZE],
                             CY_PM_PICU_12_INT_SIZE);
              
                      memcpy((void *) CY_PM_PICU_15_INT_BASE,
                             (void *) &cyPmBackup.picuIntType[CY_PM_PICU_0_6_INT_SIZE + CY_PM_PICU_12_INT_SIZE],
                             CY_PM_PICU_15_INT_SIZE);
              
                  }
              
              #endif  /* (CY_PSOC5A) */
1552          
1553          
1554          /*******************************************************************************
1555          * Function Name: CyPmSlpSaveSet
1556          ********************************************************************************
1557          *
1558          * Summary:
1559          *  Prepare device for proper Sleep low power mode entry:
1560          *  - Prepare CTW for Sleep mode entry (PSoC5)
1561          *    * Save timewheels configuration
1562          *    * Disable FTW and 1PPS (enable and interrupt)
1563          *    * Reset CTW
1564          *    * Save and disable PICU interrupts (PSoC5)
1565          *    * Save and disable PRES-A and PRES-D (PSoC5)
1566          *  - Save and disable LVI/HVI configuration (PSoC5)
1567          *  - Save and set to max buzz interval (PSoC5)
1568          *  - If LVI/HVI is enabled than hardware buzz in required (PSoC3):
1569          *    * Prepare wake trim registers
1570          *    * Disable LDO-A in proper way
1571          *  - If LVI/HVI is disabled than hardware buzz in not required (PSoC3):
1572          *    * Disabled hardware buzz
1573          *  - CyPmHibSlpSaveSet() function is called
1574          *
1575          * Parameters:
1576          *  None
1577          *
1578          * Return:
1579          *  None
1580          *
1581          * Reentrant:
1582          *  No
1583          *
1584          *******************************************************************************/
1585          static void CyPmSlpSaveSet(void) 
1586          {
1587   1          #if(CY_PSOC5A)
              
                      /* Preserve the Timewheel Configuration Register 2 */
                      cyPmBackup.pmTwCfg2 = CY_PM_TW_CFG2_REG;
              
                      /*  Clear the enable and interrupt enables for the FTW and ONEPPS */
                      CY_PM_TW_CFG2_REG &= ~(CY_PM_FTW_IE | CY_PM_FTW_EN | CY_PM_1PPS_EN | CY_PM_1PPS_IE);
              
                      /* Reset free-running CTW counter to 0 and held it there */
                      CY_PM_WDT_CFG_REG |= CY_PM_WDT_CFG_CTW_RESET;
              
                      /* Exit CTW counter reset state */
                      CY_PM_WDT_CFG_REG &= ~CY_PM_WDT_CFG_CTW_RESET;
              
                      /* Save and disable PICU interrupts  */
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 27  

                      CyPmSavePicuInterrupts();
                      CyPmDisablePicuInterrupts();
              
                      /* Save and disable PRES-A and PRES-D */
                      cyPmBackup.pres1 = CY_PM_RESET_CR1_REG & CY_PM_RESET_CR1_DIS_PRES1;
                      cyPmBackup.pres2 = CY_PM_RESET_CR3_REG & CY_PM_RESET_CR3_DIS_PRES2;
                      CY_PM_RESET_CR1_REG &= ~CY_PM_RESET_CR1_DIS_PRES1;
                      CY_PM_RESET_CR3_REG &= ~CY_PM_RESET_CR3_DIS_PRES2;
              
                  #endif /* (CY_PSOC5A) */
1612   1      
1613   1      
1614   1          #if(CY_PSOC5A)
              
                      /***************************************************************************
                      * LVI/HVI must be disabled as it doesn't work during buzzing.
                      *
                      * Using hardware buzz in conjunction with other device wakeup sources
                      * can cause the device to lockup, halting further code execution. The
                      * hardware buzz provides power supply supervising capability in sleep.
                      * It is enabled by default and there is no way to disable it. So the buzz
                      * interval is set to maximum (512 ms). The CTW must be configured to wake up
                      * at a rate less than hardware buzz interval.
                      ***************************************************************************/
              
                      /* Save LVI/HVI configuration */
                      cyPmBackup.lviaLvidHvi = (CY_PM_RESET_CR1_REG & CY_PM_RESET_CR1_HVI_LVI_EN_MASK);
              
                      /* Disable LVI/HVI */
                      CY_PM_RESET_CR1_REG &= ~CY_PM_RESET_CR1_HVI_LVI_EN_MASK;
              
                      /* Save buzz trim value */
                      cyPmBackup.buzzSleepTrim = CY_PM_PWRSYS_BUZZ_TR_REG & ~CY_PM_PWRSYS_BUZZ_TR_MASK;
              
                      /* Set buzz interval to maximum */
                      CY_PM_PWRSYS_BUZZ_TR_REG = CY_PM_PWRSYS_BUZZ_TR_512_TICKS |
                                                (CY_PM_PWRSYS_BUZZ_TR_REG & CY_PM_PWRSYS_BUZZ_TR_MASK);
              
                  #endif  /* (CY_PSOC5A) */
1641   1      
1642   1      
1643   1          #if(CY_PSOC3)
1644   1      
1645   1              /***************************************************************************
1646   1              * If LVI/HVI is enabled than hardware buzz in required:
1647   1              *  - Prepare wake trim registers
1648   1              *  - Disable LDO-A in proper way
1649   1              *
1650   1              * If LVI/HVI is disabled than hardware buzz in not required:
1651   1              *  - Disabled hardware buzz
1652   1              ***************************************************************************/
1653   1      
1654   1              cyPmBackup.wakeTr2 = CY_PM_PWRSYS_WAKE_TR2_REG;
1655   1      
1656   1              /* Reconfigure power mode wakeup trim registers */
1657   1              if(0u != (CY_PM_RESET_CR1_REG & (CY_PM_RESET_CR1_HVIA_EN |
1658   1                        CY_PM_RESET_CR1_LVIA_EN | CY_PM_RESET_CR1_LVID_EN)))
1659   1              {
1660   2                  /* HVI/LVI is enabled - hardware buzz is required */
1661   2                  CY_PM_PWRSYS_WAKE_TR2_REG = 0x3Bu;
1662   2      
1663   2                  /* Prepares for disabling LDO-A by moving bandgap reference to VCCD */
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 28  

1664   2                  CY_PM_PWRSYS_CR1_REG = 0x01u;
1665   2      
1666   2                  /* Disables LDO-A */
1667   2                  CY_PM_PWRSYS_CR1_REG |= 0x02u;
1668   2              }
1669   1              else
1670   1              {
1671   2                  /* HVI/LVI is disabled - hardware buzz is not required */
1672   2                  CY_PM_PWRSYS_WAKE_TR2_REG = 0x3Au;
1673   2              }
1674   1      
1675   1          #endif  /* (CY_PSOC3) */
1676   1      
1677   1          /* Apply configuration that are same for Sleep and Hibernate */
1678   1          CyPmHibSlpSaveSet();
1679   1      }
1680          
1681          
1682          /*******************************************************************************
1683          * Function Name: CyPmSlpRestore
1684          ********************************************************************************
1685          *
1686          * Summary:
1687          *  Restore device for proper Sleep mode exit:
1688          *  - Restore timewheel configuration (PSoC5)
1689          *  - Restore PRES-A and PRES-D (PSoC5)
1690          *  - Restore PICU interrupts (PSoC5)
1691          *  - Restore LVI/HVI configuration (PSoC5)
1692          *  - Restore buzz sleep trim value (PSoC5)
1693          *  - Call to CyPmHibSlpSaveRestore()
1694          *
1695          * Parameters:
1696          *  None
1697          *
1698          * Return:
1699          *  None
1700          *
1701          *******************************************************************************/
1702          static void CyPmSlpRestore(void) 
1703          {
1704   1          #if(CY_PSOC5A)
              
                      /* Restore the Timewheel Configuration Register 2 */
                      CY_PM_TW_CFG2_REG = cyPmBackup.pmTwCfg2;
              
                      /* Restore PICU interrupts */
                      CyPmRestorePicuInterrupts();
              
                      /* Restore PRES-A and PRES-D (assumed they were disabled) */
                      CY_PM_RESET_CR1_REG |= cyPmBackup.pres1;
                      CY_PM_RESET_CR3_REG |= cyPmBackup.pres2;
              
                  #endif /* (CY_PSOC5A) */
1717   1      
1718   1      
1719   1          #if(CY_PSOC5A)
              
                      /* Restore LVI/HVI configuration */
                      CY_PM_RESET_CR1_REG |= cyPmBackup.lviaLvidHvi;
              
                      /* Restore buzz sleep trim value */
                      CY_PM_PWRSYS_BUZZ_TR_REG = cyPmBackup.buzzSleepTrim |
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 29  

                                                (CY_PM_PWRSYS_BUZZ_TR_REG & CY_PM_PWRSYS_BUZZ_TR_MASK);
              
                  #endif  /* (CY_PSOC5A) */
1729   1      
1730   1      
1731   1          #if(CY_PSOC3)
1732   1      
1733   1              CY_PM_PWRSYS_WAKE_TR2_REG = cyPmBackup.wakeTr2;
1734   1      
1735   1              /* Reconfigure power mode wakeup trim registers */
1736   1              if(0u != (CY_PM_RESET_CR1_REG & (CY_PM_RESET_CR1_HVIA_EN |
1737   1                        CY_PM_RESET_CR1_LVIA_EN | CY_PM_RESET_CR1_LVID_EN)))
1738   1              {
1739   2                  /* Enables LDO-A */
1740   2                  CY_PM_PWRSYS_CR1_REG &= ~0x02u;
1741   2      
1742   2                  /* Moves bandgap reference back to VCCA */
1743   2                  CY_PM_PWRSYS_CR1_REG &= ~0x01u;
1744   2              }
1745   1      
1746   1          #endif  /* (CY_PSOC3) */
1747   1      
1748   1      
1749   1          /* Restore configuration that are same for Sleep and Hibernate */
1750   1          CyPmHibSlpRestore();
1751   1      }
1752          
1753          
1754          /*******************************************************************************
1755          * Function Name: CyPmHibSlpSaveSet
1756          ********************************************************************************
1757          *
1758          * Summary:
1759          *  This API is used for preparing device for Sleep and Hibernate low power
1760          *  modes entry:
1761          *  - Saves COMP, VIDAC, DSM and SAR routing connections (PSoC5)
1762          *  - Saves SC/CT routing connections (PSoC and PSoC3)
1763          *  - Disables Serial Wire Viewer (SWV) (PSoC3)
1764          *  - Saves enable state of delay between the system bus and analog clocks
1765          *
1766          * Parameters:
1767          *  None
1768          *
1769          * Return:
1770          *  None
1771          *
1772          * Reentrant:
1773          *  No
1774          *
1775          *******************************************************************************/
1776          static void CyPmHibSlpSaveSet(void) 
1777          {
1778   1          #if(CY_PSOC5A)
              
                      /* Save CMP routing registers */
                      cyPmBackup.cmpData[0u]  = CY_GET_REG8(CYREG_CMP0_SW0);
                      cyPmBackup.cmpData[1u]  = CY_GET_REG8(CYREG_CMP0_SW2);
                      cyPmBackup.cmpData[2u]  = CY_GET_REG8(CYREG_CMP0_SW3);
                      cyPmBackup.cmpData[3u]  = CY_GET_REG8(CYREG_CMP0_SW4);
                      cyPmBackup.cmpData[4u]  = CY_GET_REG8(CYREG_CMP0_SW6);
              
                      cyPmBackup.cmpData[5u]  = CY_GET_REG8(CYREG_CMP1_SW0);
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 30  

                      cyPmBackup.cmpData[6u]  = CY_GET_REG8(CYREG_CMP1_SW2);
                      cyPmBackup.cmpData[7u]  = CY_GET_REG8(CYREG_CMP1_SW3);
                      cyPmBackup.cmpData[8u]  = CY_GET_REG8(CYREG_CMP1_SW4);
                      cyPmBackup.cmpData[9u]  = CY_GET_REG8(CYREG_CMP1_SW6);
              
                      cyPmBackup.cmpData[10u] = CY_GET_REG8(CYREG_CMP2_SW0);
                      cyPmBackup.cmpData[11u] = CY_GET_REG8(CYREG_CMP2_SW2);
                      cyPmBackup.cmpData[12u] = CY_GET_REG8(CYREG_CMP2_SW3);
                      cyPmBackup.cmpData[13u] = CY_GET_REG8(CYREG_CMP2_SW4);
                      cyPmBackup.cmpData[14u] = CY_GET_REG8(CYREG_CMP2_SW6);
              
                      cyPmBackup.cmpData[15u] = CY_GET_REG8(CYREG_CMP3_SW0);
                      cyPmBackup.cmpData[16u] = CY_GET_REG8(CYREG_CMP3_SW2);
                      cyPmBackup.cmpData[17u] = CY_GET_REG8(CYREG_CMP3_SW3);
                      cyPmBackup.cmpData[18u] = CY_GET_REG8(CYREG_CMP3_SW4);
                      cyPmBackup.cmpData[19u] = CY_GET_REG8(CYREG_CMP3_SW6);
              
              
                      /* Clear CMP routing registers */
                      CY_SET_REG8(CYREG_CMP0_SW0 , 0u);
                      CY_SET_REG8(CYREG_CMP0_SW2 , 0u);
                      CY_SET_REG8(CYREG_CMP0_SW3 , 0u);
                      CY_SET_REG8(CYREG_CMP0_SW4 , 0u);
                      CY_SET_REG8(CYREG_CMP0_SW6 , 0u);
              
                      CY_SET_REG8(CYREG_CMP1_SW0 , 0u);
                      CY_SET_REG8(CYREG_CMP1_SW2 , 0u);
                      CY_SET_REG8(CYREG_CMP1_SW3 , 0u);
                      CY_SET_REG8(CYREG_CMP1_SW4 , 0u);
                      CY_SET_REG8(CYREG_CMP1_SW6 , 0u);
              
                      CY_SET_REG8(CYREG_CMP2_SW0 , 0u);
                      CY_SET_REG8(CYREG_CMP2_SW2 , 0u);
                      CY_SET_REG8(CYREG_CMP2_SW3 , 0u);
                      CY_SET_REG8(CYREG_CMP2_SW4 , 0u);
                      CY_SET_REG8(CYREG_CMP2_SW6 , 0u);
              
                      CY_SET_REG8(CYREG_CMP3_SW0 , 0u);
                      CY_SET_REG8(CYREG_CMP3_SW2 , 0u);
                      CY_SET_REG8(CYREG_CMP3_SW3 , 0u);
                      CY_SET_REG8(CYREG_CMP3_SW4 , 0u);
                      CY_SET_REG8(CYREG_CMP3_SW6 , 0u);
              
              
                      /* Save DAC routing registers */
                      cyPmBackup.dacData[0u]  = CY_GET_REG8(CYREG_DAC0_SW0);
                      cyPmBackup.dacData[1u]  = CY_GET_REG8(CYREG_DAC0_SW2);
                      cyPmBackup.dacData[2u]  = CY_GET_REG8(CYREG_DAC0_SW3);
                      cyPmBackup.dacData[3u]  = CY_GET_REG8(CYREG_DAC0_SW4);
              
                      cyPmBackup.dacData[4u]  = CY_GET_REG8(CYREG_DAC1_SW0);
                      cyPmBackup.dacData[5u]  = CY_GET_REG8(CYREG_DAC1_SW2);
                      cyPmBackup.dacData[6u]  = CY_GET_REG8(CYREG_DAC1_SW3);
                      cyPmBackup.dacData[7u]  = CY_GET_REG8(CYREG_DAC1_SW4);
              
                      cyPmBackup.dacData[8u]  = CY_GET_REG8(CYREG_DAC2_SW0);
                      cyPmBackup.dacData[9u]  = CY_GET_REG8(CYREG_DAC2_SW2);
                      cyPmBackup.dacData[10u] = CY_GET_REG8(CYREG_DAC2_SW3);
                      cyPmBackup.dacData[11u] = CY_GET_REG8(CYREG_DAC2_SW4);
              
                      cyPmBackup.dacData[12u] = CY_GET_REG8(CYREG_DAC3_SW0);
                      cyPmBackup.dacData[13u] = CY_GET_REG8(CYREG_DAC3_SW2);
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 31  

                      cyPmBackup.dacData[14u] = CY_GET_REG8(CYREG_DAC3_SW3);
                      cyPmBackup.dacData[15u] = CY_GET_REG8(CYREG_DAC3_SW4);
              
                      /* Clear DAC routing registers */
                      CY_SET_REG8(CYREG_DAC0_SW0 , 0u);
                      CY_SET_REG8(CYREG_DAC0_SW2 , 0u);
                      CY_SET_REG8(CYREG_DAC0_SW3 , 0u);
                      CY_SET_REG8(CYREG_DAC0_SW4 , 0u);
              
                      CY_SET_REG8(CYREG_DAC1_SW0 , 0u);
                      CY_SET_REG8(CYREG_DAC1_SW2 , 0u);
                      CY_SET_REG8(CYREG_DAC1_SW3 , 0u);
                      CY_SET_REG8(CYREG_DAC1_SW4 , 0u);
              
                      CY_SET_REG8(CYREG_DAC2_SW0 , 0u);
                      CY_SET_REG8(CYREG_DAC2_SW2 , 0u);
                      CY_SET_REG8(CYREG_DAC2_SW3 , 0u);
                      CY_SET_REG8(CYREG_DAC2_SW4 , 0u);
              
                      CY_SET_REG8(CYREG_DAC3_SW0 , 0u);
                      CY_SET_REG8(CYREG_DAC3_SW2 , 0u);
                      CY_SET_REG8(CYREG_DAC3_SW3 , 0u);
                      CY_SET_REG8(CYREG_DAC3_SW4 , 0u);
              
              
                      /* Save DSM routing registers */
                      cyPmBackup.dsmData[0u]  = CY_GET_REG8(CYREG_DSM0_SW0);
                      cyPmBackup.dsmData[1u]  = CY_GET_REG8(CYREG_DSM0_SW2);
                      cyPmBackup.dsmData[2u]  = CY_GET_REG8(CYREG_DSM0_SW3);
                      cyPmBackup.dsmData[3u]  = CY_GET_REG8(CYREG_DSM0_SW4);
                      cyPmBackup.dsmData[4u]  = CY_GET_REG8(CYREG_DSM0_SW6);
              
                      /* Clear DSM routing registers */
                      CY_SET_REG8(CYREG_DSM0_SW0 , 0u);
                      CY_SET_REG8(CYREG_DSM0_SW2 , 0u);
                      CY_SET_REG8(CYREG_DSM0_SW3 , 0u);
                      CY_SET_REG8(CYREG_DSM0_SW4 , 0u);
                      CY_SET_REG8(CYREG_DSM0_SW6 , 0u);
              
              
                      /* Save SAR routing registers */
                      cyPmBackup.sarData[0u]  = CY_GET_REG8(CYREG_SAR0_SW0);
                      cyPmBackup.sarData[1u]  = CY_GET_REG8(CYREG_SAR0_SW2);
                      cyPmBackup.sarData[2u]  = CY_GET_REG8(CYREG_SAR0_SW3);
                      cyPmBackup.sarData[3u]  = CY_GET_REG8(CYREG_SAR0_SW4);
                      cyPmBackup.sarData[4u]  = CY_GET_REG8(CYREG_SAR0_SW6);
              
                      cyPmBackup.sarData[5u]  = CY_GET_REG8(CYREG_SAR1_SW0);
                      cyPmBackup.sarData[6u]  = CY_GET_REG8(CYREG_SAR1_SW2);
                      cyPmBackup.sarData[7u]  = CY_GET_REG8(CYREG_SAR1_SW3);
                      cyPmBackup.sarData[8u]  = CY_GET_REG8(CYREG_SAR1_SW4);
                      cyPmBackup.sarData[9u]  = CY_GET_REG8(CYREG_SAR1_SW6);
              
              
                      /* Clear SAR routing registers */
                      CY_SET_REG8(CYREG_SAR0_SW0 , 0u);
                      CY_SET_REG8(CYREG_SAR0_SW2 , 0u);
                      CY_SET_REG8(CYREG_SAR0_SW3 , 0u);
                      CY_SET_REG8(CYREG_SAR0_SW4 , 0u);
                      CY_SET_REG8(CYREG_SAR0_SW6 , 0u);
              
                      CY_SET_REG8(CYREG_SAR1_SW0 , 0u);
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 32  

                      CY_SET_REG8(CYREG_SAR1_SW2 , 0u);
                      CY_SET_REG8(CYREG_SAR1_SW3 , 0u);
                      CY_SET_REG8(CYREG_SAR1_SW4 , 0u);
                      CY_SET_REG8(CYREG_SAR1_SW6 , 0u);
              
                  #endif  /* (CY_PSOC5A) */
1918   1      
1919   1      
1920   1          #if(CY_PSOC3 || CY_PSOC5A)
1921   1      
1922   1              /* Save SC/CT routing registers */
1923   1              cyPmBackup.scctData[0u]   = CY_GET_REG8(CYREG_SC0_SW0 );
1924   1              cyPmBackup.scctData[1u]   = CY_GET_REG8(CYREG_SC0_SW2 );
1925   1              cyPmBackup.scctData[2u]   = CY_GET_REG8(CYREG_SC0_SW3 );
1926   1              cyPmBackup.scctData[3u]   = CY_GET_REG8(CYREG_SC0_SW4 );
1927   1              cyPmBackup.scctData[4u]   = CY_GET_REG8(CYREG_SC0_SW6 );
1928   1              cyPmBackup.scctData[5u]   = CY_GET_REG8(CYREG_SC0_SW8 );
1929   1              cyPmBackup.scctData[6u]   = CY_GET_REG8(CYREG_SC0_SW10);
1930   1      
1931   1              cyPmBackup.scctData[7u]   = CY_GET_REG8(CYREG_SC1_SW0 );
1932   1              cyPmBackup.scctData[8u]   = CY_GET_REG8(CYREG_SC1_SW2 );
1933   1              cyPmBackup.scctData[9u]   = CY_GET_REG8(CYREG_SC1_SW3 );
1934   1              cyPmBackup.scctData[10u]  = CY_GET_REG8(CYREG_SC1_SW4 );
1935   1              cyPmBackup.scctData[11u]  = CY_GET_REG8(CYREG_SC1_SW6 );
1936   1              cyPmBackup.scctData[12u]  = CY_GET_REG8(CYREG_SC1_SW8 );
1937   1              cyPmBackup.scctData[13u]  = CY_GET_REG8(CYREG_SC1_SW10);
1938   1      
1939   1              cyPmBackup.scctData[14u]  = CY_GET_REG8(CYREG_SC2_SW0 );
1940   1              cyPmBackup.scctData[15u]  = CY_GET_REG8(CYREG_SC2_SW2 );
1941   1              cyPmBackup.scctData[16u]  = CY_GET_REG8(CYREG_SC2_SW3 );
1942   1              cyPmBackup.scctData[17u]  = CY_GET_REG8(CYREG_SC2_SW4 );
1943   1              cyPmBackup.scctData[18u]  = CY_GET_REG8(CYREG_SC2_SW6 );
1944   1              cyPmBackup.scctData[19u]  = CY_GET_REG8(CYREG_SC2_SW8 );
1945   1              cyPmBackup.scctData[20u]  = CY_GET_REG8(CYREG_SC2_SW10);
1946   1      
1947   1              cyPmBackup.scctData[21u]  = CY_GET_REG8(CYREG_SC3_SW0 );
1948   1              cyPmBackup.scctData[22u]  = CY_GET_REG8(CYREG_SC3_SW2 );
1949   1              cyPmBackup.scctData[23u]  = CY_GET_REG8(CYREG_SC3_SW3 );
1950   1              cyPmBackup.scctData[24u]  = CY_GET_REG8(CYREG_SC3_SW4 );
1951   1              cyPmBackup.scctData[25u]  = CY_GET_REG8(CYREG_SC3_SW6 );
1952   1              cyPmBackup.scctData[26u]  = CY_GET_REG8(CYREG_SC3_SW8 );
1953   1              cyPmBackup.scctData[27u]  = CY_GET_REG8(CYREG_SC3_SW10);
1954   1      
1955   1              CY_SET_REG8(CYREG_SC0_SW0 , 0u);
1956   1              CY_SET_REG8(CYREG_SC0_SW2 , 0u);
1957   1              CY_SET_REG8(CYREG_SC0_SW3 , 0u);
1958   1              CY_SET_REG8(CYREG_SC0_SW4 , 0u);
1959   1              CY_SET_REG8(CYREG_SC0_SW6 , 0u);
1960   1              CY_SET_REG8(CYREG_SC0_SW8 , 0u);
1961   1              CY_SET_REG8(CYREG_SC0_SW10, 0u);
1962   1      
1963   1              CY_SET_REG8(CYREG_SC1_SW0 , 0u);
1964   1              CY_SET_REG8(CYREG_SC1_SW2 , 0u);
1965   1              CY_SET_REG8(CYREG_SC1_SW3 , 0u);
1966   1              CY_SET_REG8(CYREG_SC1_SW4 , 0u);
1967   1              CY_SET_REG8(CYREG_SC1_SW6 , 0u);
1968   1              CY_SET_REG8(CYREG_SC1_SW8 , 0u);
1969   1              CY_SET_REG8(CYREG_SC1_SW10, 0u);
1970   1      
1971   1              CY_SET_REG8(CYREG_SC2_SW0 , 0u);
1972   1              CY_SET_REG8(CYREG_SC2_SW2 , 0u);
1973   1              CY_SET_REG8(CYREG_SC2_SW3 , 0u);
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 33  

1974   1              CY_SET_REG8(CYREG_SC2_SW4 , 0u);
1975   1              CY_SET_REG8(CYREG_SC2_SW6 , 0u);
1976   1              CY_SET_REG8(CYREG_SC2_SW8 , 0u);
1977   1              CY_SET_REG8(CYREG_SC2_SW10, 0u);
1978   1      
1979   1              CY_SET_REG8(CYREG_SC3_SW0 , 0u);
1980   1              CY_SET_REG8(CYREG_SC3_SW2 , 0u);
1981   1              CY_SET_REG8(CYREG_SC3_SW3 , 0u);
1982   1              CY_SET_REG8(CYREG_SC3_SW4 , 0u);
1983   1              CY_SET_REG8(CYREG_SC3_SW6 , 0u);
1984   1              CY_SET_REG8(CYREG_SC3_SW8 , 0u);
1985   1              CY_SET_REG8(CYREG_SC3_SW10, 0u);
1986   1      
1987   1          #endif  /* (CY_PSOC3 || CY_PSOC5A) */
1988   1      
1989   1          /* Device is PSoC 3 and the revision is ES3 or later */
1990   1          #if(CY_PSOC3)
1991   1      
1992   1              /* Serial Wire Viewer (SWV) workaround */
1993   1      
1994   1              /* Disable SWV before entering low power mode */
1995   1              if(0u != (CY_PM_MLOGIC_DBG_REG & CY_PM_MLOGIC_DBG_SWV_CLK_EN))
1996   1              {
1997   2                  /* Save SWV clock enabled state */
1998   2                  cyPmBackup.swvClkEnabled = CY_PM_ENABLED;
1999   2      
2000   2                  /* Save current ports drive mode settings */
2001   2                  cyPmBackup.prt1Dm = CY_PM_PRT1_PC3_REG & ~CY_PM_PRT1_PC3_DM_MASK;
2002   2      
2003   2                  /* Set drive mode to strong output */
2004   2                  CY_PM_PRT1_PC3_REG = (CY_PM_PRT1_PC3_REG & CY_PM_PRT1_PC3_DM_MASK) |
2005   2                                      CY_PM_PRT1_PC3_DM_STRONG;
2006   2      
2007   2                  /* Disable SWV clocks */
2008   2                  CY_PM_MLOGIC_DBG_REG &= ~CY_PM_MLOGIC_DBG_SWV_CLK_EN;
2009   2              }
2010   1              else
2011   1              {
2012   2                  /* Save SWV clock disabled state */
2013   2                  cyPmBackup.swvClkEnabled = CY_PM_DISABLED;
2014   2              }
2015   1      
2016   1          #endif  /* (CY_PSOC3) */
2017   1      
2018   1      
2019   1          /***************************************************************************
2020   1          * Save enable state of delay between the system bus clock and each of the
2021   1          * 4 individual analog clocks. This bit non-retention and it's value should
2022   1          * be restored on wakeup.
2023   1          ***************************************************************************/
2024   1          if(0u != (CY_PM_CLKDIST_DELAY_REG & CY_PM_CLKDIST_DELAY_EN))
2025   1          {
2026   2              cyPmBackup.clkDistDelay = CY_PM_ENABLED;
2027   2          }
2028   1          else
2029   1          {
2030   2              cyPmBackup.clkDistDelay = CY_PM_DISABLED;
2031   2          }
2032   1      }
2033          
2034          
2035          /*******************************************************************************
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 34  

2036          * Function Name: CyPmHibSlpRestore
2037          ********************************************************************************
2038          *
2039          * Summary:
2040          *  This API is used for restoring device configurations after wakeup from Sleep
2041          *  and Hibernate low power modes:
2042          *  - Restores COMP, VIDAC, DSM and SAR routing connections (PSoC5)
2043          *  - Restores SC/CT routing connections (PSoC5 and PSoC3)
2044          *  - Restores enable state of Serial Wire Viewer (SWV) (PSoC3)
2045          *  - Restores initial buzz rate (PSoC5)
2046          *  - Restores enable state of delay between the system bus and analog clocks
2047          *
2048          * Parameters:
2049          *  None
2050          *
2051          * Return:
2052          *  None
2053          *
2054          *******************************************************************************/
2055          static void CyPmHibSlpRestore(void) 
2056          {
2057   1          /* Device is PSoC 5 and the revision is ES1 */
2058   1          #if(CY_PSOC5A)
              
                      /* Restore COMP routing registers */
                      CY_SET_REG8(CYREG_CMP0_SW0 , cyPmBackup.cmpData[0u] );
                      CY_SET_REG8(CYREG_CMP0_SW2 , cyPmBackup.cmpData[1u] );
                      CY_SET_REG8(CYREG_CMP0_SW3 , cyPmBackup.cmpData[2u] );
                      CY_SET_REG8(CYREG_CMP0_SW4 , cyPmBackup.cmpData[3u] );
                      CY_SET_REG8(CYREG_CMP0_SW6 , cyPmBackup.cmpData[4u] );
              
                      CY_SET_REG8(CYREG_CMP1_SW0 , cyPmBackup.cmpData[5u] );
                      CY_SET_REG8(CYREG_CMP1_SW2 , cyPmBackup.cmpData[6u] );
                      CY_SET_REG8(CYREG_CMP1_SW3 , cyPmBackup.cmpData[7u] );
                      CY_SET_REG8(CYREG_CMP1_SW4 , cyPmBackup.cmpData[8u] );
                      CY_SET_REG8(CYREG_CMP1_SW6 , cyPmBackup.cmpData[9u] );
              
                      CY_SET_REG8(CYREG_CMP2_SW0 , cyPmBackup.cmpData[10u]);
                      CY_SET_REG8(CYREG_CMP2_SW2 , cyPmBackup.cmpData[11u]);
                      CY_SET_REG8(CYREG_CMP2_SW3 , cyPmBackup.cmpData[12u]);
                      CY_SET_REG8(CYREG_CMP2_SW4 , cyPmBackup.cmpData[13u]);
                      CY_SET_REG8(CYREG_CMP2_SW6 , cyPmBackup.cmpData[14u]);
              
                      CY_SET_REG8(CYREG_CMP3_SW0 , cyPmBackup.cmpData[15u]);
                      CY_SET_REG8(CYREG_CMP3_SW2 , cyPmBackup.cmpData[16u]);
                      CY_SET_REG8(CYREG_CMP3_SW3 , cyPmBackup.cmpData[17u]);
                      CY_SET_REG8(CYREG_CMP3_SW4 , cyPmBackup.cmpData[18u]);
                      CY_SET_REG8(CYREG_CMP3_SW6 , cyPmBackup.cmpData[19u]);
              
                      /* Restore DAC routing registers */
                      CY_SET_REG8(CYREG_DAC0_SW0 , cyPmBackup.dacData[0u] );
                      CY_SET_REG8(CYREG_DAC0_SW2 , cyPmBackup.dacData[1u] );
                      CY_SET_REG8(CYREG_DAC0_SW3 , cyPmBackup.dacData[2u] );
                      CY_SET_REG8(CYREG_DAC0_SW4 , cyPmBackup.dacData[3u] );
              
                      CY_SET_REG8(CYREG_DAC1_SW0 , cyPmBackup.dacData[4u] );
                      CY_SET_REG8(CYREG_DAC1_SW2 , cyPmBackup.dacData[5u] );
                      CY_SET_REG8(CYREG_DAC1_SW3 , cyPmBackup.dacData[6u] );
                      CY_SET_REG8(CYREG_DAC1_SW4 , cyPmBackup.dacData[7u] );
              
                      CY_SET_REG8(CYREG_DAC2_SW0 , cyPmBackup.dacData[8u] );
                      CY_SET_REG8(CYREG_DAC2_SW2 , cyPmBackup.dacData[9u] );
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 35  

                      CY_SET_REG8(CYREG_DAC2_SW3 , cyPmBackup.dacData[10u]);
                      CY_SET_REG8(CYREG_DAC2_SW4 , cyPmBackup.dacData[11u]);
              
                      CY_SET_REG8(CYREG_DAC3_SW0 , cyPmBackup.dacData[12u]);
                      CY_SET_REG8(CYREG_DAC3_SW2 , cyPmBackup.dacData[13u]);
                      CY_SET_REG8(CYREG_DAC3_SW3 , cyPmBackup.dacData[14u]);
                      CY_SET_REG8(CYREG_DAC3_SW4 , cyPmBackup.dacData[15u]);
              
              
                      /* Restore DSM routing registers */
                      CY_SET_REG8(CYREG_DSM0_SW0 , cyPmBackup.dsmData[0u]);
                      CY_SET_REG8(CYREG_DSM0_SW2 , cyPmBackup.dsmData[1u]);
                      CY_SET_REG8(CYREG_DSM0_SW3 , cyPmBackup.dsmData[2u]);
                      CY_SET_REG8(CYREG_DSM0_SW4 , cyPmBackup.dsmData[3u]);
                      CY_SET_REG8(CYREG_DSM0_SW6 , cyPmBackup.dsmData[4u]);
              
              
                      /* Restore SAR routing registers */
                      CY_SET_REG8(CYREG_SAR0_SW0 , cyPmBackup.sarData[0u]);
                      CY_SET_REG8(CYREG_SAR0_SW2 , cyPmBackup.sarData[1u]);
                      CY_SET_REG8(CYREG_SAR0_SW3 , cyPmBackup.sarData[2u]);
                      CY_SET_REG8(CYREG_SAR0_SW4 , cyPmBackup.sarData[3u]);
                      CY_SET_REG8(CYREG_SAR0_SW6 , cyPmBackup.sarData[4u]);
              
                      CY_SET_REG8(CYREG_SAR1_SW0 , cyPmBackup.sarData[5u]);
                      CY_SET_REG8(CYREG_SAR1_SW2 , cyPmBackup.sarData[6u]);
                      CY_SET_REG8(CYREG_SAR1_SW3 , cyPmBackup.sarData[7u]);
                      CY_SET_REG8(CYREG_SAR1_SW4 , cyPmBackup.sarData[8u]);
                      CY_SET_REG8(CYREG_SAR1_SW6 , cyPmBackup.sarData[9u]);
              
                  #endif  /* (CY_PSOC5A) */
2129   1      
2130   1          /* Device is PSoC 3 and the revision is ES3 or later, or
2131   1          *  device is PSoC 5 and the revision is ES1 or earlier.
2132   1          */
2133   1          #if(CY_PSOC3 || CY_PSOC5A)
2134   1      
2135   1              /* Restore SC/CT routing registers */
2136   1              CY_SET_REG8(CYREG_SC0_SW0 , cyPmBackup.scctData[0u] );
2137   1              CY_SET_REG8(CYREG_SC0_SW2 , cyPmBackup.scctData[1u] );
2138   1              CY_SET_REG8(CYREG_SC0_SW3 , cyPmBackup.scctData[2u] );
2139   1              CY_SET_REG8(CYREG_SC0_SW4 , cyPmBackup.scctData[3u] );
2140   1              CY_SET_REG8(CYREG_SC0_SW6 , cyPmBackup.scctData[4u] );
2141   1              CY_SET_REG8(CYREG_SC0_SW8 , cyPmBackup.scctData[5u] );
2142   1              CY_SET_REG8(CYREG_SC0_SW10, cyPmBackup.scctData[6u] );
2143   1      
2144   1              CY_SET_REG8(CYREG_SC1_SW0 , cyPmBackup.scctData[7u] );
2145   1              CY_SET_REG8(CYREG_SC1_SW2 , cyPmBackup.scctData[8u] );
2146   1              CY_SET_REG8(CYREG_SC1_SW3 , cyPmBackup.scctData[9u] );
2147   1              CY_SET_REG8(CYREG_SC1_SW4 , cyPmBackup.scctData[10u]);
2148   1              CY_SET_REG8(CYREG_SC1_SW6 , cyPmBackup.scctData[11u]);
2149   1              CY_SET_REG8(CYREG_SC1_SW8 , cyPmBackup.scctData[12u]);
2150   1              CY_SET_REG8(CYREG_SC1_SW10, cyPmBackup.scctData[13u]);
2151   1      
2152   1              CY_SET_REG8(CYREG_SC2_SW0 , cyPmBackup.scctData[14u]);
2153   1              CY_SET_REG8(CYREG_SC2_SW2 , cyPmBackup.scctData[15u]);
2154   1              CY_SET_REG8(CYREG_SC2_SW3 , cyPmBackup.scctData[16u]);
2155   1              CY_SET_REG8(CYREG_SC2_SW4 , cyPmBackup.scctData[17u]);
2156   1              CY_SET_REG8(CYREG_SC2_SW6 , cyPmBackup.scctData[18u]);
2157   1              CY_SET_REG8(CYREG_SC2_SW8 , cyPmBackup.scctData[19u]);
2158   1              CY_SET_REG8(CYREG_SC2_SW10, cyPmBackup.scctData[20u]);
2159   1      
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 36  

2160   1              CY_SET_REG8(CYREG_SC3_SW0 , cyPmBackup.scctData[21u]);
2161   1              CY_SET_REG8(CYREG_SC3_SW2 , cyPmBackup.scctData[22u]);
2162   1              CY_SET_REG8(CYREG_SC3_SW3 , cyPmBackup.scctData[23u]);
2163   1              CY_SET_REG8(CYREG_SC3_SW4 , cyPmBackup.scctData[24u]);
2164   1              CY_SET_REG8(CYREG_SC3_SW6 , cyPmBackup.scctData[25u]);
2165   1              CY_SET_REG8(CYREG_SC3_SW8 , cyPmBackup.scctData[26u]);
2166   1              CY_SET_REG8(CYREG_SC3_SW10, cyPmBackup.scctData[27u]);
2167   1      
2168   1          #endif  /* (CY_PSOC3 || CY_PSOC5A) */
2169   1      
2170   1      
2171   1          #if(CY_PSOC3)
2172   1      
2173   1              /* Serial Wire Viewer (SWV) workaround */
2174   1              if(CY_PM_ENABLED == cyPmBackup.swvClkEnabled)
2175   1              {
2176   2                  /* Restore ports drive mode */
2177   2                  CY_PM_PRT1_PC3_REG = (CY_PM_PRT1_PC3_REG & CY_PM_PRT1_PC3_DM_MASK) |
2178   2                                          cyPmBackup.prt1Dm;
2179   2      
2180   2                  /* Enable SWV clocks */
2181   2                  CY_PM_MLOGIC_DBG_REG |= CY_PM_MLOGIC_DBG_SWV_CLK_EN;
2182   2              }
2183   1      
2184   1          #endif /* (CY_PSOC3) */
2185   1      
2186   1      
2187   1          #if(CY_PSOC5A)
              
                      /* Restore buzz sleep trim value */
                      CY_PM_PWRSYS_BUZZ_TR_REG = cyPmBackup.buzzSleepTrim | \
                                                (CY_PM_PWRSYS_BUZZ_TR_REG & CY_PM_PWRSYS_BUZZ_TR_MASK);
              
                  #endif  /* (CY_PSOC5A) */
2194   1      
2195   1      
2196   1          /* Restore enable state of delay between the system bus clock and ACLKs. */
2197   1          if(CY_PM_ENABLED == cyPmBackup.clkDistDelay)
2198   1          {
2199   2              /* Delay for both the bandgap and the delay line to settle out */
2200   2              CyDelayCycles(CY_PM_GET_CPU_FREQ_MHZ * (CY_PM_CLK_DELAY_BANDGAP_SETTLE_US + CY_PM_CLK_DELAY_BIAS_S
             -ETTLE_US));
2201   2              CY_PM_CLKDIST_DELAY_REG |= CY_PM_CLKDIST_DELAY_EN;
2202   2          }
2203   1      }
2204          
2205          
2206          /* [] END OF FILE */
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 37  

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION CyPmSaveClocks (BEGIN)
                                           ; SOURCE LINE # 87
                                           ; SOURCE LINE # 88
                                           ; SOURCE LINE # 90
0000 9043A1            MOV     DPTR,#043A1H
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 EF                MOV     A,R7
0006 540F              ANL     A,#0FH
0008 FF                MOV     R7,A
0009 900000      R     MOV     DPTR,#cyPmClockBackup
000C EF                MOV     A,R7
000D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 91
000E 9043A2            MOV     DPTR,#043A2H
0011 E0                MOVX    A,@DPTR
0012 FF                MOV     R7,A
0013 900000      R     MOV     DPTR,#cyPmClockBackup+01H
0016 EF                MOV     A,R7
0017 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 92
0018 9043A1            MOV     DPTR,#043A1H
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
001D EF                MOV     A,R7
001E 54F0              ANL     A,#0F0H
0020 FF                MOV     R7,A
0021 EF                MOV     A,R7
0022 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 93
0023 9043A2            MOV     DPTR,#043A2H
0026 E0                MOVX    A,@DPTR
0027 FF                MOV     R7,A
0028 EF                MOV     A,R7
0029 5400              ANL     A,#00H
002B FF                MOV     R7,A
002C EF                MOV     A,R7
002D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 96
002E 904800            MOV     DPTR,#04800H
0031 E0                MOVX    A,@DPTR
0032 FF                MOV     R7,A
0033 EF                MOV     A,R7
0034 54C0              ANL     A,#0C0H
0036 FF                MOV     R7,A
0037 900000      R     MOV     DPTR,#cyPmClockBackup+05H
003A EF                MOV     A,R7
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 97
003C 7F2D              MOV     R7,#02DH
003E 120000      E     LCALL   _CyFlash_SetWaitCycles
                                           ; SOURCE LINE # 100
0041 904200            MOV     DPTR,#04200H
0044 E0                MOVX    A,@DPTR
0045 FF                MOV     R7,A
0046 EF                MOV     A,R7
0047 5407              ANL     A,#07H
0049 FF                MOV     R7,A
004A 900000      R     MOV     DPTR,#cyPmClockBackup+03H
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 38  

004D EF                MOV     A,R7
004E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 101
004F 904200            MOV     DPTR,#04200H
0052 E0                MOVX    A,@DPTR
0053 FF                MOV     R7,A
0054 EF                MOV     A,R7
0055 5440              ANL     A,#040H
0057 FF                MOV     R7,A
0058 900000      R     MOV     DPTR,#cyPmClockBackup+04H
005B EF                MOV     A,R7
005C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 104
005D 904200            MOV     DPTR,#04200H
0060 E0                MOVX    A,@DPTR
0061 FF                MOV     R7,A
0062 EF                MOV     A,R7
0063 5410              ANL     A,#010H
0065 FF                MOV     R7,A
0066 7E00              MOV     R6,#00H
0068 EF                MOV     A,R7
0069 4E                ORL     A,R6
006A 6008              JZ      ?C0001
                                           ; SOURCE LINE # 105
                                           ; SOURCE LINE # 107
006C 900000      R     MOV     DPTR,#cyPmClockBackup+09H
006F 7401              MOV     A,#01H
0071 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 108
0072 8005              SJMP    ?C0002
0074         ?C0001:
                                           ; SOURCE LINE # 110
                                           ; SOURCE LINE # 112
0074 900000      R     MOV     DPTR,#cyPmClockBackup+09H
0077 E4                CLR     A
0078 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 113
0079         ?C0002:
                                           ; SOURCE LINE # 116
0079 7F02              MOV     R7,#02H
007B 120000      E     LCALL   _CyIMO_SetFreq
                                           ; SOURCE LINE # 119
007E 9043A0            MOV     DPTR,#043A0H
0081 E0                MOVX    A,@DPTR
0082 FF                MOV     R7,A
0083 EF                MOV     A,R7
0084 5410              ANL     A,#010H
0086 FF                MOV     R7,A
0087 7E00              MOV     R6,#00H
0089 EF                MOV     A,R7
008A 4E                ORL     A,R6
008B 6008              JZ      ?C0003
                                           ; SOURCE LINE # 120
                                           ; SOURCE LINE # 122
008D 900000      R     MOV     DPTR,#cyPmClockBackup+06H
0090 7401              MOV     A,#01H
0092 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 123
0093 800A              SJMP    ?C0004
0095         ?C0003:
                                           ; SOURCE LINE # 125
                                           ; SOURCE LINE # 127
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 39  

0095 900000      R     MOV     DPTR,#cyPmClockBackup+06H
0098 E4                CLR     A
0099 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 130
009A 7F00              MOV     R7,#00H
009C 120000      E     LCALL   _CyIMO_Start
                                           ; SOURCE LINE # 131
009F         ?C0004:
                                           ; SOURCE LINE # 134
009F 904200            MOV     DPTR,#04200H
00A2 E0                MOVX    A,@DPTR
00A3 FF                MOV     R7,A
00A4 EF                MOV     A,R7
00A5 5420              ANL     A,#020H
00A7 FF                MOV     R7,A
00A8 7E00              MOV     R6,#00H
00AA EF                MOV     A,R7
00AB 4E                ORL     A,R6
00AC 6021              JZ      ?C0005
                                           ; SOURCE LINE # 135
                                           ; SOURCE LINE # 138
00AE 904000            MOV     DPTR,#04000H
00B1 E0                MOVX    A,@DPTR
00B2 FF                MOV     R7,A
00B3 EF                MOV     A,R7
00B4 5440              ANL     A,#040H
00B6 FF                MOV     R7,A
00B7 7E00              MOV     R6,#00H
00B9 EF                MOV     A,R7
00BA 4E                ORL     A,R6
00BB 7004              JNZ     ?C0006
00BD 7F02              MOV     R7,#02H
00BF 8002              SJMP    ?C0007
00C1         ?C0006:
00C1 7F01              MOV     R7,#01H
00C3         ?C0007:
00C3 900000      R     MOV     DPTR,#cyPmClockBackup+07H
00C6 EF                MOV     A,R7
00C7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 141
00C8 7F00              MOV     R7,#00H
00CA 120000      E     LCALL   _CyIMO_SetSource
                                           ; SOURCE LINE # 142
00CD 8005              SJMP    ?C0008
00CF         ?C0005:
                                           ; SOURCE LINE # 144
                                           ; SOURCE LINE # 146
00CF 900000      R     MOV     DPTR,#cyPmClockBackup+07H
00D2 E4                CLR     A
00D3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 147
00D4         ?C0008:
                                           ; SOURCE LINE # 150
00D4 904000            MOV     DPTR,#04000H
00D7 E0                MOVX    A,@DPTR
00D8 FF                MOV     R7,A
00D9 EF                MOV     A,R7
00DA 5430              ANL     A,#030H
00DC FF                MOV     R7,A
00DD 900000      R     MOV     DPTR,#cyPmClockBackup+08H
00E0 EF                MOV     A,R7
00E1 F0                MOVX    @DPTR,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 40  

                                           ; SOURCE LINE # 153
00E2 900000      R     MOV     DPTR,#cyPmClockBackup+08H
00E5 E0                MOVX    A,@DPTR
00E6 FF                MOV     R7,A
00E7 EF                MOV     A,R7
00E8 600B              JZ      ?C0009
                                           ; SOURCE LINE # 154
                                           ; SOURCE LINE # 156
00EA 904000            MOV     DPTR,#04000H
00ED E0                MOVX    A,@DPTR
00EE FF                MOV     R7,A
00EF EF                MOV     A,R7
00F0 54CF              ANL     A,#0CFH
00F2 FF                MOV     R7,A
00F3 EF                MOV     A,R7
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 158
00F5         ?C0009:
                                           ; SOURCE LINE # 161
00F5 904200            MOV     DPTR,#04200H
00F8 E0                MOVX    A,@DPTR
00F9 FF                MOV     R7,A
00FA EF                MOV     A,R7
00FB 5410              ANL     A,#010H
00FD FF                MOV     R7,A
00FE 7E00              MOV     R6,#00H
0100 EF                MOV     A,R7
0101 4E                ORL     A,R6
0102 6003              JZ      ?C0010
                                           ; SOURCE LINE # 162
                                           ; SOURCE LINE # 163
0104 120000      E     LCALL   CyIMO_DisableDoubler
                                           ; SOURCE LINE # 164
0107         ?C0010:
                                           ; SOURCE LINE # 167
0107 904004            MOV     DPTR,#04004H
010A E0                MOVX    A,@DPTR
010B FF                MOV     R7,A
010C 900000      R     MOV     DPTR,#cyPmClockBackup+0AH
010F EF                MOV     A,R7
0110 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 168
0111 900000      R     MOV     DPTR,#cyPmClockBackup+0AH
0114 E0                MOVX    A,@DPTR
0115 FF                MOV     R7,A
0116 EF                MOV     A,R7
0117 6005              JZ      ?C0011
                                           ; SOURCE LINE # 169
                                           ; SOURCE LINE # 170
0119 7F00              MOV     R7,#00H
011B 120000      E     LCALL   _CyMasterClk_SetDivider
                                           ; SOURCE LINE # 171
011E         ?C0011:
                                           ; SOURCE LINE # 174
011E 904005            MOV     DPTR,#04005H
0121 E0                MOVX    A,@DPTR
0122 FF                MOV     R7,A
0123 EF                MOV     A,R7
0124 5403              ANL     A,#03H
0126 FF                MOV     R7,A
0127 900000      R     MOV     DPTR,#cyPmClockBackup+02H
012A EF                MOV     A,R7
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 41  

012B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 177
012C 900000      R     MOV     DPTR,#cyPmClockBackup+02H
012F E0                MOVX    A,@DPTR
0130 FF                MOV     R7,A
0131 EF                MOV     A,R7
0132 6005              JZ      ?C0012
                                           ; SOURCE LINE # 178
                                           ; SOURCE LINE # 179
0134 7F00              MOV     R7,#00H
0136 120000      E     LCALL   _CyMasterClk_SetSource
                                           ; SOURCE LINE # 180
0139         ?C0012:
                                           ; SOURCE LINE # 183
0139 904007            MOV     DPTR,#04007H
013C E0                MOVX    A,@DPTR
013D FF                MOV     R7,A
013E 7E00              MOV     R6,#00H
0140 EF                MOV     A,R7
0141 7F00              MOV     R7,#00H
0143 FE                MOV     R6,A
0144 904006            MOV     DPTR,#04006H
0147 E0                MOVX    A,@DPTR
0148 FD                MOV     R5,A
0149 7C00              MOV     R4,#00H
014B EE                MOV     A,R6
014C 4C                ORL     A,R4
014D FE                MOV     R6,A
014E EF                MOV     A,R7
014F 4D                ORL     A,R5
0150 FF                MOV     R7,A
0151 900000      R     MOV     DPTR,#cyPmClockBackup+0BH
0154 EE                MOV     A,R6
0155 F0                MOVX    @DPTR,A
0156 A3                INC     DPTR
0157 EF                MOV     A,R7
0158 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 184
0159 900000      R     MOV     DPTR,#cyPmClockBackup+0BH
015C E0                MOVX    A,@DPTR
015D FE                MOV     R6,A
015E A3                INC     DPTR
015F E0                MOVX    A,@DPTR
0160 FF                MOV     R7,A
0161 EF                MOV     A,R7
0162 4E                ORL     A,R6
0163 6007              JZ      ?C0013
                                           ; SOURCE LINE # 185
                                           ; SOURCE LINE # 186
0165 7F00              MOV     R7,#00H
0167 7E00              MOV     R6,#00H
0169 120000      E     LCALL   _CyBusClk_SetDivider
                                           ; SOURCE LINE # 187
016C         ?C0013:
                                           ; SOURCE LINE # 190
016C 904005            MOV     DPTR,#04005H
016F E0                MOVX    A,@DPTR
0170 FF                MOV     R7,A
0171 EF                MOV     A,R7
0172 54F0              ANL     A,#0F0H
0174 FF                MOV     R7,A
0175 7E00              MOV     R6,#00H
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 42  

0177 EE                MOV     A,R6
0178 C4                SWAP    A
0179 F8                MOV     R0,A
017A 54F0              ANL     A,#0F0H
017C C8                XCH     A,R0
017D 68                XRL     A,R0
017E FE                MOV     R6,A
017F EF                MOV     A,R7
0180 C4                SWAP    A
0181 540F              ANL     A,#0FH
0183 48                ORL     A,R0
0184 FF                MOV     R7,A
0185 EF                MOV     A,R7
0186 2401              ADD     A,#01H
0188 FD                MOV     R5,A
0189 EE                MOV     A,R6
018A 3400              ADDC    A,#00H
018C FC                MOV     R4,A
018D 904200            MOV     DPTR,#04200H
0190 E0                MOVX    A,@DPTR
0191 FF                MOV     R7,A
0192 EF                MOV     A,R7
0193 5407              ANL     A,#07H
0195 FF                MOV     R7,A
0196 EF                MOV     A,R7
0197 900000      R     MOV     DPTR,#cyPmImoFreqReg2Mhz
019A 93                MOVC    A,@A+DPTR
019B FF                MOV     R7,A
019C 7E00              MOV     R6,#00H
019E 120000      E     LCALL   ?C?UIDIV
01A1 120000      E     LCALL   _CyFlash_SetWaitCycles
                                           ; SOURCE LINE # 193
01A4 904220            MOV     DPTR,#04220H
01A7 E0                MOVX    A,@DPTR
01A8 FF                MOV     R7,A
01A9 EF                MOV     A,R7
01AA 5401              ANL     A,#01H
01AC FF                MOV     R7,A
01AD 7E00              MOV     R6,#00H
01AF EF                MOV     A,R7
01B0 4E                ORL     A,R6
01B1 600B              JZ      ?C0014
                                           ; SOURCE LINE # 194
                                           ; SOURCE LINE # 196
01B3 900000      R     MOV     DPTR,#cyPmClockBackup+0DH
01B6 7401              MOV     A,#01H
01B8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 197
01B9 120000      E     LCALL   CyPLL_OUT_Stop
                                           ; SOURCE LINE # 198
01BC 8005              SJMP    ?C0015
01BE         ?C0014:
                                           ; SOURCE LINE # 200
                                           ; SOURCE LINE # 202
01BE 900000      R     MOV     DPTR,#cyPmClockBackup+0DH
01C1 E4                CLR     A
01C2 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 203
01C3         ?C0015:
                                           ; SOURCE LINE # 206
01C3 904210            MOV     DPTR,#04210H
01C6 E0                MOVX    A,@DPTR
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 43  

01C7 FF                MOV     R7,A
01C8 EF                MOV     A,R7
01C9 5401              ANL     A,#01H
01CB FF                MOV     R7,A
01CC 7E00              MOV     R6,#00H
01CE EF                MOV     A,R7
01CF 4E                ORL     A,R6
01D0 600A              JZ      ?C0016
                                           ; SOURCE LINE # 207
                                           ; SOURCE LINE # 209
01D2 900000      R     MOV     DPTR,#cyPmClockBackup+0EH
01D5 7401              MOV     A,#01H
01D7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 210
01D8 120000      E     LCALL   CyXTAL_Stop
                                           ; SOURCE LINE # 211
01DB 22                RET     
01DC         ?C0016:
                                           ; SOURCE LINE # 213
                                           ; SOURCE LINE # 215
01DC 900000      R     MOV     DPTR,#cyPmClockBackup+0EH
01DF E4                CLR     A
01E0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 216
01E1         ?C0017:
                                           ; SOURCE LINE # 217
01E1         ?C0018:
01E1 22                RET     
             ; FUNCTION CyPmSaveClocks (END)

             ; FUNCTION CyPmRestoreClocks (BEGIN)
                                           ; SOURCE LINE # 245
                                           ; SOURCE LINE # 246
                                           ; SOURCE LINE # 249
0000 900000      R     MOV     DPTR,#status
0003 7410              MOV     A,#010H
0005 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 260
0006 900000      R     MOV     DPTR,#cyPmClockBackup+0EH
0009 E0                MOVX    A,@DPTR
000A FF                MOV     R7,A
000B EF                MOV     A,R7
000C 6401              XRL     A,#01H
000E 6003              JZ      $ + 5H
0010 020000      R     LJMP    ?C0019
                                           ; SOURCE LINE # 261
                                           ; SOURCE LINE # 270
0013 7F00              MOV     R7,#00H
0015 120000      E     LCALL   _CyXTAL_Start
                                           ; SOURCE LINE # 280
0018 904210            MOV     DPTR,#04210H
001B E0                MOVX    A,@DPTR
001C FF                MOV     R7,A
                                           ; SOURCE LINE # 283
001D 900000      R     MOV     DPTR,#i
0020 E4                CLR     A
0021 F0                MOVX    @DPTR,A
0022 A3                INC     DPTR
0023 7405              MOV     A,#05H
0025 F0                MOVX    @DPTR,A
0026         ?C0020:
0026 900000      R     MOV     DPTR,#i
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 44  

0029 E0                MOVX    A,@DPTR
002A FE                MOV     R6,A
002B A3                INC     DPTR
002C E0                MOVX    A,@DPTR
002D FF                MOV     R7,A
002E D3                SETB    C
002F EF                MOV     A,R7
0030 9400              SUBB    A,#00H
0032 EE                MOV     A,R6
0033 9400              SUBB    A,#00H
0035 4065              JC      ?C0021
                                           ; SOURCE LINE # 284
                                           ; SOURCE LINE # 286
0037 904005            MOV     DPTR,#04005H
003A E0                MOVX    A,@DPTR
003B FF                MOV     R7,A
003C EF                MOV     A,R7
003D 54F0              ANL     A,#0F0H
003F FF                MOV     R7,A
0040 7E00              MOV     R6,#00H
0042 EE                MOV     A,R6
0043 C4                SWAP    A
0044 F8                MOV     R0,A
0045 54F0              ANL     A,#0F0H
0047 C8                XCH     A,R0
0048 68                XRL     A,R0
0049 FE                MOV     R6,A
004A EF                MOV     A,R7
004B C4                SWAP    A
004C 540F              ANL     A,#0FH
004E 48                ORL     A,R0
004F FF                MOV     R7,A
0050 EF                MOV     A,R7
0051 2401              ADD     A,#01H
0053 FD                MOV     R5,A
0054 EE                MOV     A,R6
0055 3400              ADDC    A,#00H
0057 FC                MOV     R4,A
0058 904200            MOV     DPTR,#04200H
005B E0                MOVX    A,@DPTR
005C FF                MOV     R7,A
005D EF                MOV     A,R7
005E 5407              ANL     A,#07H
0060 FF                MOV     R7,A
0061 EF                MOV     A,R7
0062 900000      R     MOV     DPTR,#cyPmImoFreqReg2Mhz
0065 93                MOVC    A,@A+DPTR
0066 FF                MOV     R7,A
0067 7E00              MOV     R6,#00H
0069 120000      E     LCALL   ?C?UIDIV
006C 7C00              MOV     R4,#00H
006E 7DC8              MOV     R5,#0C8H
0070 120000      E     LCALL   ?C?IMUL
0073 E4                CLR     A
0074 FC                MOV     R4,A
0075 FD                MOV     R5,A
0076 120000      E     LCALL   _CyDelayCycles
                                           ; SOURCE LINE # 289
0079 904210            MOV     DPTR,#04210H
007C E0                MOVX    A,@DPTR
007D FF                MOV     R7,A
007E EF                MOV     A,R7
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 45  

007F 5480              ANL     A,#080H
0081 FF                MOV     R7,A
0082 7E00              MOV     R6,#00H
0084 EF                MOV     A,R7
0085 4E                ORL     A,R6
0086 7007              JNZ     ?C0022
                                           ; SOURCE LINE # 290
                                           ; SOURCE LINE # 291
0088 900000      R     MOV     DPTR,#status
008B E4                CLR     A
008C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 292
008D 800D              SJMP    ?C0021
                                           ; SOURCE LINE # 293
008F         ?C0023:
                                           ; SOURCE LINE # 294
008F         ?C0022:
008F 900000      R     MOV     DPTR,#i
0092 74FF              MOV     A,#0FFH
0094 75F0FF            MOV     B,#0FFH
0097 120000      E     LCALL   ?C?IILDX
009A 808A              SJMP    ?C0020
009C         ?C0021:
                                           ; SOURCE LINE # 296
                                           ; SOURCE LINE # 297
                                           ; SOURCE LINE # 306
009C         ?C0024:
                                           ; SOURCE LINE # 310
009C         ?C0019:
                                           ; SOURCE LINE # 314
009C 7F2D              MOV     R7,#02DH
009E 120000      E     LCALL   _CyFlash_SetWaitCycles
                                           ; SOURCE LINE # 317
00A1 900000      R     MOV     DPTR,#cyPmClockBackup+02H
00A4 E0                MOVX    A,@DPTR
00A5 FF                MOV     R7,A
00A6 EF                MOV     A,R7
00A7 6402              XRL     A,#02H
00A9 6009              JZ      ?C0026
00AB 900000      R     MOV     DPTR,#cyPmClockBackup+02H
00AE E0                MOVX    A,@DPTR
00AF FF                MOV     R7,A
00B0 EF                MOV     A,R7
00B1 B4031E            CJNE    A,#03H,?C0025
00B4         ?C0026:
                                           ; SOURCE LINE # 319
                                           ; SOURCE LINE # 321
00B4 900000      R     MOV     DPTR,#cyPmClockBackup+0AH
00B7 E0                MOVX    A,@DPTR
00B8 FF                MOV     R7,A
00B9 904004            MOV     DPTR,#04004H
00BC E0                MOVX    A,@DPTR
00BD FE                MOV     R6,A
00BE EE                MOV     A,R6
00BF 6F                XRL     A,R7
00C0 6008              JZ      ?C0027
                                           ; SOURCE LINE # 322
                                           ; SOURCE LINE # 324
00C2 900000      R     MOV     DPTR,#cyPmClockBackup+0AH
00C5 E0                MOVX    A,@DPTR
00C6 FF                MOV     R7,A
00C7 120000      E     LCALL   _CyMasterClk_SetDivider
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 46  

                                           ; SOURCE LINE # 325
00CA         ?C0027:
                                           ; SOURCE LINE # 328
00CA 900000      R     MOV     DPTR,#cyPmClockBackup+02H
00CD E0                MOVX    A,@DPTR
00CE FF                MOV     R7,A
00CF 120000      E     LCALL   _CyMasterClk_SetSource
                                           ; SOURCE LINE # 329
00D2         ?C0025:
                                           ; SOURCE LINE # 332
00D2 900000      R     MOV     DPTR,#cyPmClockBackup+04H
00D5 E0                MOVX    A,@DPTR
00D6 FF                MOV     R7,A
00D7 EF                MOV     A,R7
00D8 5440              ANL     A,#040H
00DA FF                MOV     R7,A
00DB 7E00              MOV     R6,#00H
00DD EF                MOV     A,R7
00DE 4E                ORL     A,R6
00DF 6016              JZ      ?C0028
00E1 900000      R     MOV     DPTR,#cyPmClockBackup+03H
00E4 E0                MOVX    A,@DPTR
00E5 FF                MOV     R7,A
00E6 EF                MOV     A,R7
00E7 900000      R     MOV     DPTR,#cyPmImoFreqMhz2Reg
00EA 93                MOVC    A,@A+DPTR
00EB FF                MOV     R7,A
00EC EF                MOV     A,R7
00ED B40307            CJNE    A,#03H,?C0028
                                           ; SOURCE LINE # 334
                                           ; SOURCE LINE # 336
00F0 7F08              MOV     R7,#08H
00F2 120000      E     LCALL   _CyIMO_SetFreq
                                           ; SOURCE LINE # 337
00F5 8035              SJMP    ?C0029
00F7         ?C0028:
                                           ; SOURCE LINE # 339
                                           ; SOURCE LINE # 341
00F7 900000      R     MOV     DPTR,#cyPmClockBackup+03H
00FA E0                MOVX    A,@DPTR
00FB FF                MOV     R7,A
00FC EF                MOV     A,R7
00FD 900000      R     MOV     DPTR,#cyPmImoFreqMhz2Reg
0100 93                MOVC    A,@A+DPTR
0101 FF                MOV     R7,A
0102 120000      E     LCALL   _CyIMO_SetFreq
                                           ; SOURCE LINE # 343
0105 900000      R     MOV     DPTR,#cyPmClockBackup+04H
0108 E0                MOVX    A,@DPTR
0109 FF                MOV     R7,A
010A EF                MOV     A,R7
010B 5440              ANL     A,#040H
010D FF                MOV     R7,A
010E 7E00              MOV     R6,#00H
0110 EF                MOV     A,R7
0111 4E                ORL     A,R6
0112 600D              JZ      ?C0030
                                           ; SOURCE LINE # 344
                                           ; SOURCE LINE # 345
0114 904200            MOV     DPTR,#04200H
0117 E0                MOVX    A,@DPTR
0118 FF                MOV     R7,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 47  

0119 EF                MOV     A,R7
011A 4440              ORL     A,#040H
011C FF                MOV     R7,A
011D EF                MOV     A,R7
011E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 346
011F 800B              SJMP    ?C0029
0121         ?C0030:
                                           ; SOURCE LINE # 348
                                           ; SOURCE LINE # 349
0121 904200            MOV     DPTR,#04200H
0124 E0                MOVX    A,@DPTR
0125 FF                MOV     R7,A
0126 EF                MOV     A,R7
0127 54BF              ANL     A,#0BFH
0129 FF                MOV     R7,A
012A EF                MOV     A,R7
012B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 350
012C         ?C0031:
                                           ; SOURCE LINE # 351
012C         ?C0029:
                                           ; SOURCE LINE # 355
012C 900000      R     MOV     DPTR,#cyPmClockBackup+06H
012F E0                MOVX    A,@DPTR
0130 FF                MOV     R7,A
0131 EF                MOV     A,R7
0132 B40114            CJNE    A,#01H,?C0032
0135 9043A0            MOV     DPTR,#043A0H
0138 E0                MOVX    A,@DPTR
0139 FF                MOV     R7,A
013A EF                MOV     A,R7
013B 5410              ANL     A,#010H
013D FF                MOV     R7,A
013E 7E00              MOV     R6,#00H
0140 EF                MOV     A,R7
0141 4E                ORL     A,R6
0142 7005              JNZ     ?C0032
                                           ; SOURCE LINE # 356
                                           ; SOURCE LINE # 358
0144 7F00              MOV     R7,#00H
0146 120000      E     LCALL   _CyIMO_Start
                                           ; SOURCE LINE # 359
0149         ?C0032:
                                           ; SOURCE LINE # 363
0149 900000      R     MOV     DPTR,#cyPmClockBackup+06H
014C E0                MOVX    A,@DPTR
014D FF                MOV     R7,A
014E EF                MOV     A,R7
014F 7012              JNZ     ?C0033
0151 9043A0            MOV     DPTR,#043A0H
0154 E0                MOVX    A,@DPTR
0155 FF                MOV     R7,A
0156 EF                MOV     A,R7
0157 5410              ANL     A,#010H
0159 FF                MOV     R7,A
015A 7E00              MOV     R6,#00H
015C EF                MOV     A,R7
015D 4E                ORL     A,R6
015E 6003              JZ      ?C0033
                                           ; SOURCE LINE # 364
                                           ; SOURCE LINE # 365
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 48  

0160 120000      E     LCALL   CyIMO_Stop
                                           ; SOURCE LINE # 366
0163         ?C0033:
                                           ; SOURCE LINE # 369
0163 900000      R     MOV     DPTR,#cyPmClockBackup+07H
0166 E0                MOVX    A,@DPTR
0167 FF                MOV     R7,A
0168 120000      E     LCALL   _CyIMO_SetSource
                                           ; SOURCE LINE # 372
016B 900000      R     MOV     DPTR,#cyPmClockBackup+09H
016E E0                MOVX    A,@DPTR
016F FF                MOV     R7,A
0170 EF                MOV     A,R7
0171 B40103            CJNE    A,#01H,?C0034
                                           ; SOURCE LINE # 373
                                           ; SOURCE LINE # 374
0174 120000      E     LCALL   CyIMO_EnableDoubler
                                           ; SOURCE LINE # 375
0177         ?C0034:
                                           ; SOURCE LINE # 378
0177 904000            MOV     DPTR,#04000H
017A E0                MOVX    A,@DPTR
017B FF                MOV     R7,A
017C EF                MOV     A,R7
017D 5430              ANL     A,#030H
017F FF                MOV     R7,A
0180 7E00              MOV     R6,#00H
0182 900000      R     MOV     DPTR,#cyPmClockBackup+08H
0185 E0                MOVX    A,@DPTR
0186 FD                MOV     R5,A
0187 7C00              MOV     R4,#00H
0189 ED                MOV     A,R5
018A 6F                XRL     A,R7
018B 7002              JNZ     ?C0104
018D EC                MOV     A,R4
018E 6E                XRL     A,R6
018F         ?C0104:
018F 6016              JZ      ?C0035
                                           ; SOURCE LINE # 379
                                           ; SOURCE LINE # 380
0191 904000            MOV     DPTR,#04000H
0194 E0                MOVX    A,@DPTR
0195 FF                MOV     R7,A
0196 EF                MOV     A,R7
0197 54CF              ANL     A,#0CFH
0199 FF                MOV     R7,A
019A 900000      R     MOV     DPTR,#cyPmClockBackup+08H
019D E0                MOVX    A,@DPTR
019E FE                MOV     R6,A
019F EF                MOV     A,R7
01A0 4E                ORL     A,R6
01A1 FF                MOV     R7,A
01A2 904000            MOV     DPTR,#04000H
01A5 EF                MOV     A,R7
01A6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 382
01A7         ?C0035:
                                           ; SOURCE LINE # 385
01A7 900000      R     MOV     DPTR,#cyPmClockBackup+0DH
01AA E0                MOVX    A,@DPTR
01AB FF                MOV     R7,A
01AC EF                MOV     A,R7
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 49  

01AD 6401              XRL     A,#01H
01AF 7047              JNZ     ?C0036
                                           ; SOURCE LINE # 386
                                           ; SOURCE LINE # 395
01B1 7F00              MOV     R7,#00H
01B3 120000      E     LCALL   _CyPLL_OUT_Start
                                           ; SOURCE LINE # 398
01B6 904005            MOV     DPTR,#04005H
01B9 E0                MOVX    A,@DPTR
01BA FF                MOV     R7,A
01BB EF                MOV     A,R7
01BC 54F0              ANL     A,#0F0H
01BE FF                MOV     R7,A
01BF 7E00              MOV     R6,#00H
01C1 EE                MOV     A,R6
01C2 C4                SWAP    A
01C3 F8                MOV     R0,A
01C4 54F0              ANL     A,#0F0H
01C6 C8                XCH     A,R0
01C7 68                XRL     A,R0
01C8 FE                MOV     R6,A
01C9 EF                MOV     A,R7
01CA C4                SWAP    A
01CB 540F              ANL     A,#0FH
01CD 48                ORL     A,R0
01CE FF                MOV     R7,A
01CF EF                MOV     A,R7
01D0 2401              ADD     A,#01H
01D2 FD                MOV     R5,A
01D3 EE                MOV     A,R6
01D4 3400              ADDC    A,#00H
01D6 FC                MOV     R4,A
01D7 904200            MOV     DPTR,#04200H
01DA E0                MOVX    A,@DPTR
01DB FF                MOV     R7,A
01DC EF                MOV     A,R7
01DD 5407              ANL     A,#07H
01DF FF                MOV     R7,A
01E0 EF                MOV     A,R7
01E1 900000      R     MOV     DPTR,#cyPmImoFreqReg2Mhz
01E4 93                MOVC    A,@A+DPTR
01E5 FF                MOV     R7,A
01E6 7E00              MOV     R6,#00H
01E8 120000      E     LCALL   ?C?UIDIV
01EB 7C00              MOV     R4,#00H
01ED 7DFA              MOV     R5,#0FAH
01EF 120000      E     LCALL   ?C?IMUL
01F2 E4                CLR     A
01F3 FC                MOV     R4,A
01F4 FD                MOV     R5,A
01F5 120000      E     LCALL   _CyDelayCycles
                                           ; SOURCE LINE # 399
01F8         ?C0036:
                                           ; SOURCE LINE # 403
01F8 900000      R     MOV     DPTR,#cyPmClockBackup+02H
01FB E0                MOVX    A,@DPTR
01FC FF                MOV     R7,A
01FD EF                MOV     A,R7
01FE 6009              JZ      ?C0038
0200 900000      R     MOV     DPTR,#cyPmClockBackup+02H
0203 E0                MOVX    A,@DPTR
0204 FF                MOV     R7,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 50  

0205 EF                MOV     A,R7
0206 B4011E            CJNE    A,#01H,?C0037
0209         ?C0038:
                                           ; SOURCE LINE # 405
                                           ; SOURCE LINE # 407
0209 900000      R     MOV     DPTR,#cyPmClockBackup+0AH
020C E0                MOVX    A,@DPTR
020D FF                MOV     R7,A
020E 904004            MOV     DPTR,#04004H
0211 E0                MOVX    A,@DPTR
0212 FE                MOV     R6,A
0213 EE                MOV     A,R6
0214 6F                XRL     A,R7
0215 6008              JZ      ?C0039
                                           ; SOURCE LINE # 408
                                           ; SOURCE LINE # 409
0217 900000      R     MOV     DPTR,#cyPmClockBackup+0AH
021A E0                MOVX    A,@DPTR
021B FF                MOV     R7,A
021C 120000      E     LCALL   _CyMasterClk_SetDivider
                                           ; SOURCE LINE # 410
021F         ?C0039:
                                           ; SOURCE LINE # 413
021F 900000      R     MOV     DPTR,#cyPmClockBackup+02H
0222 E0                MOVX    A,@DPTR
0223 FF                MOV     R7,A
0224 120000      E     LCALL   _CyMasterClk_SetSource
                                           ; SOURCE LINE # 414
0227         ?C0037:
                                           ; SOURCE LINE # 417
0227 904007            MOV     DPTR,#04007H
022A E0                MOVX    A,@DPTR
022B FF                MOV     R7,A
022C 7E00              MOV     R6,#00H
022E EF                MOV     A,R7
022F 7F00              MOV     R7,#00H
0231 FE                MOV     R6,A
0232 904006            MOV     DPTR,#04006H
0235 E0                MOVX    A,@DPTR
0236 FD                MOV     R5,A
0237 7C00              MOV     R4,#00H
0239 EE                MOV     A,R6
023A 4C                ORL     A,R4
023B FE                MOV     R6,A
023C EF                MOV     A,R7
023D 4D                ORL     A,R5
023E FF                MOV     R7,A
023F 900000      R     MOV     DPTR,#cyPmClockBackup+0BH
0242 E0                MOVX    A,@DPTR
0243 FC                MOV     R4,A
0244 A3                INC     DPTR
0245 E0                MOVX    A,@DPTR
0246 FD                MOV     R5,A
0247 EF                MOV     A,R7
0248 6D                XRL     A,R5
0249 7002              JNZ     ?C0105
024B EE                MOV     A,R6
024C 6C                XRL     A,R4
024D         ?C0105:
024D 600B              JZ      ?C0040
                                           ; SOURCE LINE # 418
                                           ; SOURCE LINE # 419
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 51  

024F 900000      R     MOV     DPTR,#cyPmClockBackup+0BH
0252 E0                MOVX    A,@DPTR
0253 FE                MOV     R6,A
0254 A3                INC     DPTR
0255 E0                MOVX    A,@DPTR
0256 FF                MOV     R7,A
0257 120000      E     LCALL   _CyBusClk_SetDivider
                                           ; SOURCE LINE # 420
025A         ?C0040:
                                           ; SOURCE LINE # 423
025A 904800            MOV     DPTR,#04800H
025D E0                MOVX    A,@DPTR
025E FF                MOV     R7,A
025F EF                MOV     A,R7
0260 543F              ANL     A,#03FH
0262 FF                MOV     R7,A
0263 900000      R     MOV     DPTR,#cyPmClockBackup+05H
0266 E0                MOVX    A,@DPTR
0267 FE                MOV     R6,A
0268 EF                MOV     A,R7
0269 4E                ORL     A,R6
026A FF                MOV     R7,A
026B 904800            MOV     DPTR,#04800H
026E EF                MOV     A,R7
026F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 427
0270 900000      R     MOV     DPTR,#cyPmClockBackup
0273 E0                MOVX    A,@DPTR
0274 FF                MOV     R7,A
0275 9043A1            MOV     DPTR,#043A1H
0278 EF                MOV     A,R7
0279 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 428
027A 900000      R     MOV     DPTR,#cyPmClockBackup+01H
027D E0                MOVX    A,@DPTR
027E FF                MOV     R7,A
027F 9043A2            MOV     DPTR,#043A2H
0282 EF                MOV     A,R7
0283 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 429
0284         ?C0041:
0284 22                RET     
             ; FUNCTION CyPmRestoreClocks (END)

             ; FUNCTION _CyPmAltAct (BEGIN)
                                           ; SOURCE LINE # 550
0000 900000      R     MOV     DPTR,#wakeupTime
0003 EE                MOV     A,R6
0004 F0                MOVX    @DPTR,A
0005 A3                INC     DPTR
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
0008 900000      R     MOV     DPTR,#wakeupSource
000B EC                MOV     A,R4
000C F0                MOVX    @DPTR,A
000D A3                INC     DPTR
000E ED                MOV     A,R5
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 551
                                           ; SOURCE LINE # 568
0010 900000      R     MOV     DPTR,#wakeupTime
0013 E0                MOVX    A,@DPTR
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 52  

0014 FE                MOV     R6,A
0015 A3                INC     DPTR
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
0018 C3                CLR     C
0019 EF                MOV     A,R7
001A 940F              SUBB    A,#0FH
001C EE                MOV     A,R6
001D 9400              SUBB    A,#00H
001F 4038              JC      ?C0042
0021 900000      R     MOV     DPTR,#wakeupTime
0024 E0                MOVX    A,@DPTR
0025 FE                MOV     R6,A
0026 A3                INC     DPTR
0027 E0                MOVX    A,@DPTR
0028 FF                MOV     R7,A
0029 D3                SETB    C
002A EF                MOV     A,R7
002B 940E              SUBB    A,#0EH
002D EE                MOV     A,R6
002E 9401              SUBB    A,#01H
0030 5027              JNC     ?C0042
                                           ; SOURCE LINE # 569
                                           ; SOURCE LINE # 570
0032 900000      R     MOV     DPTR,#wakeupTime
0035 E0                MOVX    A,@DPTR
0036 FE                MOV     R6,A
0037 A3                INC     DPTR
0038 E0                MOVX    A,@DPTR
0039 FF                MOV     R7,A
003A EF                MOV     A,R7
003B 24F2              ADD     A,#0F2H
003D FF                MOV     R7,A
003E EF                MOV     A,R7
003F 54FF              ANL     A,#0FFH
0041 FF                MOV     R7,A
0042 120000      R     LCALL   _CyPmFtwSetInterval
                                           ; SOURCE LINE # 573
0045 900000      R     MOV     DPTR,#wakeupSource
0048 E0                MOVX    A,@DPTR
0049 FE                MOV     R6,A
004A A3                INC     DPTR
004B E0                MOVX    A,@DPTR
004C FF                MOV     R7,A
004D EE                MOV     A,R6
004E 4404              ORL     A,#04H
0050 FE                MOV     R6,A
0051 900000      R     MOV     DPTR,#wakeupSource
0054 EE                MOV     A,R6
0055 F0                MOVX    @DPTR,A
0056 A3                INC     DPTR
0057 EF                MOV     A,R7
0058 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 574
0059         ?C0042:
                                           ; SOURCE LINE # 577
0059 900000      R     MOV     DPTR,#wakeupTime
005C E0                MOVX    A,@DPTR
005D FE                MOV     R6,A
005E A3                INC     DPTR
005F E0                MOVX    A,@DPTR
0060 FF                MOV     R7,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 53  

0061 C3                CLR     C
0062 EF                MOV     A,R7
0063 9402              SUBB    A,#02H
0065 EE                MOV     A,R6
0066 9400              SUBB    A,#00H
0068 4037              JC      ?C0043
006A 900000      R     MOV     DPTR,#wakeupTime
006D E0                MOVX    A,@DPTR
006E FE                MOV     R6,A
006F A3                INC     DPTR
0070 E0                MOVX    A,@DPTR
0071 FF                MOV     R7,A
0072 D3                SETB    C
0073 EF                MOV     A,R7
0074 940D              SUBB    A,#0DH
0076 EE                MOV     A,R6
0077 9400              SUBB    A,#00H
0079 5026              JNC     ?C0043
                                           ; SOURCE LINE # 578
                                           ; SOURCE LINE # 580
007B 900000      R     MOV     DPTR,#wakeupTime
007E E0                MOVX    A,@DPTR
007F FE                MOV     R6,A
0080 A3                INC     DPTR
0081 E0                MOVX    A,@DPTR
0082 FF                MOV     R7,A
0083 EF                MOV     A,R7
0084 14                DEC     A
0085 FF                MOV     R7,A
0086 EF                MOV     A,R7
0087 540F              ANL     A,#0FH
0089 FF                MOV     R7,A
008A 120000      R     LCALL   _CyPmCtwSetInterval
                                           ; SOURCE LINE # 583
008D 900000      R     MOV     DPTR,#wakeupSource
0090 E0                MOVX    A,@DPTR
0091 FE                MOV     R6,A
0092 A3                INC     DPTR
0093 E0                MOVX    A,@DPTR
0094 FF                MOV     R7,A
0095 EE                MOV     A,R6
0096 4408              ORL     A,#08H
0098 FE                MOV     R6,A
0099 900000      R     MOV     DPTR,#wakeupSource
009C EE                MOV     A,R6
009D F0                MOVX    @DPTR,A
009E A3                INC     DPTR
009F EF                MOV     A,R7
00A0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 584
00A1         ?C0043:
                                           ; SOURCE LINE # 587
00A1 900000      R     MOV     DPTR,#wakeupTime
00A4 E0                MOVX    A,@DPTR
00A5 FE                MOV     R6,A
00A6 A3                INC     DPTR
00A7 E0                MOVX    A,@DPTR
00A8 FF                MOV     R7,A
00A9 EF                MOV     A,R7
00AA 6401              XRL     A,#01H
00AC 4E                ORL     A,R6
00AD 7017              JNZ     ?C0044
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 54  

                                           ; SOURCE LINE # 588
                                           ; SOURCE LINE # 590
00AF 120000      R     LCALL   CyPmOppsSet
                                           ; SOURCE LINE # 593
00B2 900000      R     MOV     DPTR,#wakeupSource
00B5 E0                MOVX    A,@DPTR
00B6 FE                MOV     R6,A
00B7 A3                INC     DPTR
00B8 E0                MOVX    A,@DPTR
00B9 FF                MOV     R7,A
00BA EE                MOV     A,R6
00BB 4408              ORL     A,#08H
00BD FE                MOV     R6,A
00BE 900000      R     MOV     DPTR,#wakeupSource
00C1 EE                MOV     A,R6
00C2 F0                MOVX    @DPTR,A
00C3 A3                INC     DPTR
00C4 EF                MOV     A,R7
00C5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 594
00C6         ?C0044:
                                           ; SOURCE LINE # 603
00C6 904398            MOV     DPTR,#04398H
00C9 E0                MOVX    A,@DPTR
00CA FF                MOV     R7,A
00CB 900000      R     MOV     DPTR,#cyPmBackup+08H
00CE EF                MOV     A,R7
00CF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 604
00D0 900000      R     MOV     DPTR,#wakeupSource
00D3 E0                MOVX    A,@DPTR
00D4 FE                MOV     R6,A
00D5 A3                INC     DPTR
00D6 E0                MOVX    A,@DPTR
00D7 FF                MOV     R7,A
00D8 EE                MOV     A,R6
00D9 C4                SWAP    A
00DA F8                MOV     R0,A
00DB 54F0              ANL     A,#0F0H
00DD C8                XCH     A,R0
00DE 68                XRL     A,R0
00DF FE                MOV     R6,A
00E0 EF                MOV     A,R7
00E1 C4                SWAP    A
00E2 540F              ANL     A,#0FH
00E4 48                ORL     A,R0
00E5 FF                MOV     R7,A
00E6 904398            MOV     DPTR,#04398H
00E9 EF                MOV     A,R7
00EA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 607
00EB 904399            MOV     DPTR,#04399H
00EE E0                MOVX    A,@DPTR
00EF FF                MOV     R7,A
00F0 900000      R     MOV     DPTR,#cyPmBackup+09H
00F3 EF                MOV     A,R7
00F4 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 608
00F5 900000      R     MOV     DPTR,#wakeupSource
00F8 E0                MOVX    A,@DPTR
00F9 FE                MOV     R6,A
00FA A3                INC     DPTR
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 55  

00FB E0                MOVX    A,@DPTR
00FC FF                MOV     R7,A
00FD EF                MOV     A,R7
00FE 540F              ANL     A,#0FH
0100 FF                MOV     R7,A
0101 904399            MOV     DPTR,#04399H
0104 EF                MOV     A,R7
0105 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 611
0106 90439A            MOV     DPTR,#0439AH
0109 E0                MOVX    A,@DPTR
010A FF                MOV     R7,A
010B 900000      R     MOV     DPTR,#cyPmBackup+0AH
010E EF                MOV     A,R7
010F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 612
0110 900000      R     MOV     DPTR,#wakeupSource
0113 E0                MOVX    A,@DPTR
0114 FE                MOV     R6,A
0115 A3                INC     DPTR
0116 E0                MOVX    A,@DPTR
0117 FF                MOV     R7,A
0118 EE                MOV     A,R6
0119 C4                SWAP    A
011A 540F              ANL     A,#0FH
011C FF                MOV     R7,A
011D 7E00              MOV     R6,#00H
011F EF                MOV     A,R7
0120 5401              ANL     A,#01H
0122 FF                MOV     R7,A
0123 90439A            MOV     DPTR,#0439AH
0126 EF                MOV     A,R7
0127 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 617
0128 904393            MOV     DPTR,#04393H
012B E0                MOVX    A,@DPTR
012C FF                MOV     R7,A
012D EF                MOV     A,R7
012E 54F8              ANL     A,#0F8H
0130 FF                MOV     R7,A
0131 EF                MOV     A,R7
0132 4401              ORL     A,#01H
0134 FF                MOV     R7,A
0135 904393            MOV     DPTR,#04393H
0138 EF                MOV     A,R7
0139 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 620
013A 904393            MOV     DPTR,#04393H
013D E0                MOVX    A,@DPTR
013E FF                MOV     R7,A
                                           ; SOURCE LINE # 623
013F 00                NOP     
                                           ; SOURCE LINE # 624
0140 00                NOP     
                                           ; SOURCE LINE # 635
0141 900000      R     MOV     DPTR,#cyPmBackup+08H
0144 E0                MOVX    A,@DPTR
0145 FF                MOV     R7,A
0146 904398            MOV     DPTR,#04398H
0149 EF                MOV     A,R7
014A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 636
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 56  

014B 900000      R     MOV     DPTR,#cyPmBackup+09H
014E E0                MOVX    A,@DPTR
014F FF                MOV     R7,A
0150 904399            MOV     DPTR,#04399H
0153 EF                MOV     A,R7
0154 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 637
0155 900000      R     MOV     DPTR,#cyPmBackup+0AH
0158 E0                MOVX    A,@DPTR
0159 FF                MOV     R7,A
015A 90439A            MOV     DPTR,#0439AH
015D EF                MOV     A,R7
015E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 640
015F         ?C0045:
015F 22                RET     
             ; FUNCTION _CyPmAltAct (END)

             ; FUNCTION _CyPmSleep (BEGIN)
                                           ; SOURCE LINE # 766
0000 900000      R     MOV     DPTR,#wakeupTime
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
0005 900000      R     MOV     DPTR,#wakeupSource
0008 EC                MOV     A,R4
0009 F0                MOVX    @DPTR,A
000A A3                INC     DPTR
000B ED                MOV     A,R5
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 767
                                           ; SOURCE LINE # 771
000D 120000      E     LCALL   CyEnterCriticalSection
0010 900000      R     MOV     DPTR,#interruptState
0013 EF                MOV     A,R7
0014 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 777
0015 904689            MOV     DPTR,#04689H
0018 E0                MOVX    A,@DPTR
0019 FF                MOV     R7,A
001A EF                MOV     A,R7
001B 5401              ANL     A,#01H
001D FF                MOV     R7,A
001E 7E00              MOV     R6,#00H
0020 EF                MOV     A,R7
0021 4E                ORL     A,R6
0022 7003              JNZ     ?C0047
0024 D3                SETB    C
0025 8001              SJMP    ?C0048
0027         ?C0047:
0027 C3                CLR     C
0028         ?C0048:
0028 4024              JC      ?C0046
002A 904689            MOV     DPTR,#04689H
002D E0                MOVX    A,@DPTR
002E FF                MOV     R7,A
002F EF                MOV     A,R7
0030 5401              ANL     A,#01H
0032 FF                MOV     R7,A
0033 7E00              MOV     R6,#00H
0035 EF                MOV     A,R7
0036 4E                ORL     A,R6
0037 700A              JNZ     ?C0049
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 57  

0039 7F01              MOV     R7,#01H
003B 7E00              MOV     R6,#00H
003D 7D00              MOV     R5,#00H
003F 7C00              MOV     R4,#00H
0041 8008              SJMP    ?C0050
0043         ?C0049:
0043 7F00              MOV     R7,#00H
0045 7E00              MOV     R6,#00H
0047 7D00              MOV     R5,#00H
0049 7C00              MOV     R4,#00H
004B         ?C0050:
004B 120000      E     LCALL   _?CyHalt
004E         ?C0046:
                                           ; SOURCE LINE # 785
004E 904393            MOV     DPTR,#04393H
0051 E0                MOVX    A,@DPTR
0052 FF                MOV     R7,A
0053 EF                MOV     A,R7
0054 5408              ANL     A,#08H
0056 FF                MOV     R7,A
0057 7E00              MOV     R6,#00H
0059 EF                MOV     A,R7
005A 4E                ORL     A,R6
005B 6003              JZ      $ + 5H
005D 020000      R     LJMP    ?C0053
                                           ; SOURCE LINE # 786
                                           ; SOURCE LINE # 788
0060 904683            MOV     DPTR,#04683H
0063 E0                MOVX    A,@DPTR
0064 FF                MOV     R7,A
0065 EF                MOV     A,R7
0066 541F              ANL     A,#01FH
0068 FF                MOV     R7,A
0069 EF                MOV     A,R7
006A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 789
006B 8001              SJMP    ?C0052
006D         ?C0051:
                                           ; SOURCE LINE # 791
006D 22                RET     
                                           ; SOURCE LINE # 794
006E         ?C0052:
                                           ; SOURCE LINE # 814
006E 120000      R     LCALL   CyPmSlpSaveSet
                                           ; SOURCE LINE # 820
0071 900000      R     MOV     DPTR,#wakeupTime
0074 E0                MOVX    A,@DPTR
0075 FF                MOV     R7,A
0076 EF                MOV     A,R7
0077 C3                CLR     C
0078 9402              SUBB    A,#02H
007A 402E              JC      ?C0054
007C 900000      R     MOV     DPTR,#wakeupTime
007F E0                MOVX    A,@DPTR
0080 FF                MOV     R7,A
0081 EF                MOV     A,R7
0082 D3                SETB    C
0083 940D              SUBB    A,#0DH
0085 5023              JNC     ?C0054
                                           ; SOURCE LINE # 821
                                           ; SOURCE LINE # 823
0087 900000      R     MOV     DPTR,#wakeupTime
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 58  

008A E0                MOVX    A,@DPTR
008B FF                MOV     R7,A
008C EF                MOV     A,R7
008D 14                DEC     A
008E FF                MOV     R7,A
008F EF                MOV     A,R7
0090 540F              ANL     A,#0FH
0092 FF                MOV     R7,A
0093 120000      R     LCALL   _CyPmCtwSetInterval
                                           ; SOURCE LINE # 826
0096 900000      R     MOV     DPTR,#wakeupSource
0099 E0                MOVX    A,@DPTR
009A FE                MOV     R6,A
009B A3                INC     DPTR
009C E0                MOVX    A,@DPTR
009D FF                MOV     R7,A
009E EE                MOV     A,R6
009F 4408              ORL     A,#08H
00A1 FE                MOV     R6,A
00A2 900000      R     MOV     DPTR,#wakeupSource
00A5 EE                MOV     A,R6
00A6 F0                MOVX    @DPTR,A
00A7 A3                INC     DPTR
00A8 EF                MOV     A,R7
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 827
00AA         ?C0054:
                                           ; SOURCE LINE # 830
00AA 900000      R     MOV     DPTR,#wakeupTime
00AD E0                MOVX    A,@DPTR
00AE FF                MOV     R7,A
00AF EF                MOV     A,R7
00B0 B40117            CJNE    A,#01H,?C0055
                                           ; SOURCE LINE # 831
                                           ; SOURCE LINE # 833
00B3 120000      R     LCALL   CyPmOppsSet
                                           ; SOURCE LINE # 836
00B6 900000      R     MOV     DPTR,#wakeupSource
00B9 E0                MOVX    A,@DPTR
00BA FE                MOV     R6,A
00BB A3                INC     DPTR
00BC E0                MOVX    A,@DPTR
00BD FF                MOV     R7,A
00BE EE                MOV     A,R6
00BF 4408              ORL     A,#08H
00C1 FE                MOV     R6,A
00C2 900000      R     MOV     DPTR,#wakeupSource
00C5 EE                MOV     A,R6
00C6 F0                MOVX    @DPTR,A
00C7 A3                INC     DPTR
00C8 EF                MOV     A,R7
00C9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 837
00CA         ?C0055:
                                           ; SOURCE LINE # 847
00CA 904398            MOV     DPTR,#04398H
00CD E0                MOVX    A,@DPTR
00CE FF                MOV     R7,A
00CF 900000      R     MOV     DPTR,#cyPmBackup+08H
00D2 EF                MOV     A,R7
00D3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 848
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 59  

00D4 900000      R     MOV     DPTR,#wakeupSource
00D7 E0                MOVX    A,@DPTR
00D8 FE                MOV     R6,A
00D9 A3                INC     DPTR
00DA E0                MOVX    A,@DPTR
00DB FF                MOV     R7,A
00DC EE                MOV     A,R6
00DD C4                SWAP    A
00DE F8                MOV     R0,A
00DF 54F0              ANL     A,#0F0H
00E1 C8                XCH     A,R0
00E2 68                XRL     A,R0
00E3 FE                MOV     R6,A
00E4 EF                MOV     A,R7
00E5 C4                SWAP    A
00E6 540F              ANL     A,#0FH
00E8 48                ORL     A,R0
00E9 FF                MOV     R7,A
00EA 904398            MOV     DPTR,#04398H
00ED EF                MOV     A,R7
00EE F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 851
00EF 904399            MOV     DPTR,#04399H
00F2 E0                MOVX    A,@DPTR
00F3 FF                MOV     R7,A
00F4 900000      R     MOV     DPTR,#cyPmBackup+09H
00F7 EF                MOV     A,R7
00F8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 852
00F9 900000      R     MOV     DPTR,#wakeupSource
00FC E0                MOVX    A,@DPTR
00FD FE                MOV     R6,A
00FE A3                INC     DPTR
00FF E0                MOVX    A,@DPTR
0100 FF                MOV     R7,A
0101 EF                MOV     A,R7
0102 540F              ANL     A,#0FH
0104 FF                MOV     R7,A
0105 904399            MOV     DPTR,#04399H
0108 EF                MOV     A,R7
0109 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 855
010A 90439A            MOV     DPTR,#0439AH
010D E0                MOVX    A,@DPTR
010E FF                MOV     R7,A
010F 900000      R     MOV     DPTR,#cyPmBackup+0AH
0112 EF                MOV     A,R7
0113 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 856
0114 900000      R     MOV     DPTR,#wakeupSource
0117 E0                MOVX    A,@DPTR
0118 FE                MOV     R6,A
0119 A3                INC     DPTR
011A E0                MOVX    A,@DPTR
011B FF                MOV     R7,A
011C EE                MOV     A,R6
011D C4                SWAP    A
011E 540F              ANL     A,#0FH
0120 FF                MOV     R7,A
0121 7E00              MOV     R6,#00H
0123 EF                MOV     A,R7
0124 5401              ANL     A,#01H
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 60  

0126 FF                MOV     R7,A
0127 90439A            MOV     DPTR,#0439AH
012A EF                MOV     A,R7
012B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 862
012C 904200            MOV     DPTR,#04200H
012F E0                MOVX    A,@DPTR
0130 FF                MOV     R7,A
0131 EF                MOV     A,R7
0132 5407              ANL     A,#07H
0134 FF                MOV     R7,A
0135 7E00              MOV     R6,#00H
0137 EF                MOV     A,R7
0138 4E                ORL     A,R6
0139 7008              JNZ     ?C0056
                                           ; SOURCE LINE # 863
                                           ; SOURCE LINE # 865
013B 900000      R     MOV     DPTR,#cyPmBackup+028H
013E 7401              MOV     A,#01H
0140 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 866
0141 801E              SJMP    ?C0057
0143         ?C0056:
                                           ; SOURCE LINE # 868
                                           ; SOURCE LINE # 870
0143 900000      R     MOV     DPTR,#cyPmBackup+028H
0146 E4                CLR     A
0147 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 873
0148 904200            MOV     DPTR,#04200H
014B E0                MOVX    A,@DPTR
014C FF                MOV     R7,A
014D EF                MOV     A,R7
014E 5407              ANL     A,#07H
0150 FF                MOV     R7,A
0151 900000      R     MOV     DPTR,#cyPmBackup+027H
0154 EF                MOV     A,R7
0155 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 876
0156 904200            MOV     DPTR,#04200H
0159 E0                MOVX    A,@DPTR
015A FF                MOV     R7,A
015B EF                MOV     A,R7
015C 54F8              ANL     A,#0F8H
015E FF                MOV     R7,A
015F EF                MOV     A,R7
0160 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 877
0161         ?C0057:
                                           ; SOURCE LINE # 880
0161 904393            MOV     DPTR,#04393H
0164 E0                MOVX    A,@DPTR
0165 FF                MOV     R7,A
0166 EF                MOV     A,R7
0167 54F8              ANL     A,#0F8H
0169 FF                MOV     R7,A
016A EF                MOV     A,R7
016B 4403              ORL     A,#03H
016D FF                MOV     R7,A
016E 904393            MOV     DPTR,#04393H
0171 EF                MOV     A,R7
0172 F0                MOVX    @DPTR,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 61  

                                           ; SOURCE LINE # 883
0173 904393            MOV     DPTR,#04393H
0176 E0                MOVX    A,@DPTR
0177 FF                MOV     R7,A
                                           ; SOURCE LINE # 886
0178 00                NOP     
                                           ; SOURCE LINE # 887
0179 00                NOP     
                                           ; SOURCE LINE # 895
017A 900000      R     MOV     DPTR,#cyPmBackup+028H
017D E0                MOVX    A,@DPTR
017E FF                MOV     R7,A
017F EF                MOV     A,R7
0180 6401              XRL     A,#01H
0182 6016              JZ      ?C0058
                                           ; SOURCE LINE # 896
                                           ; SOURCE LINE # 897
0184 904200            MOV     DPTR,#04200H
0187 E0                MOVX    A,@DPTR
0188 FF                MOV     R7,A
0189 EF                MOV     A,R7
018A 54F8              ANL     A,#0F8H
018C FF                MOV     R7,A
018D 900000      R     MOV     DPTR,#cyPmBackup+027H
0190 E0                MOVX    A,@DPTR
0191 FE                MOV     R6,A
0192 EF                MOV     A,R7
0193 4E                ORL     A,R6
0194 FF                MOV     R7,A
0195 904200            MOV     DPTR,#04200H
0198 EF                MOV     A,R7
0199 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 899
019A         ?C0058:
                                           ; SOURCE LINE # 903
019A 120000      R     LCALL   CyPmSlpRestore
                                           ; SOURCE LINE # 910
019D 900000      R     MOV     DPTR,#cyPmBackup+08H
01A0 E0                MOVX    A,@DPTR
01A1 FF                MOV     R7,A
01A2 904398            MOV     DPTR,#04398H
01A5 EF                MOV     A,R7
01A6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 911
01A7 900000      R     MOV     DPTR,#cyPmBackup+09H
01AA E0                MOVX    A,@DPTR
01AB FF                MOV     R7,A
01AC 904399            MOV     DPTR,#04399H
01AF EF                MOV     A,R7
01B0 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 912
01B1 900000      R     MOV     DPTR,#cyPmBackup+0AH
01B4 E0                MOVX    A,@DPTR
01B5 FF                MOV     R7,A
01B6 90439A            MOV     DPTR,#0439AH
01B9 EF                MOV     A,R7
01BA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 917
01BB 900000      R     MOV     DPTR,#interruptState
01BE E0                MOVX    A,@DPTR
01BF FF                MOV     R7,A
01C0 120000      E     LCALL   _CyExitCriticalSection
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 62  

                                           ; SOURCE LINE # 918
01C3         ?C0053:
01C3 22                RET     
             ; FUNCTION _CyPmSleep (END)

             ; FUNCTION CyPmHibernate (BEGIN)
                                           ; SOURCE LINE # 970
                                           ; SOURCE LINE # 971
                                           ; SOURCE LINE # 975
0000 120000      E     LCALL   CyEnterCriticalSection
0003 900000      R     MOV     DPTR,#interruptState
0006 EF                MOV     A,R7
0007 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 986
0008 904393            MOV     DPTR,#04393H
000B E0                MOVX    A,@DPTR
000C FF                MOV     R7,A
000D EF                MOV     A,R7
000E 5408              ANL     A,#08H
0010 FF                MOV     R7,A
0011 7E00              MOV     R6,#00H
0013 EF                MOV     A,R7
0014 4E                ORL     A,R6
0015 6003              JZ      $ + 5H
0017 020000      R     LJMP    ?C0061
                                           ; SOURCE LINE # 987
                                           ; SOURCE LINE # 989
001A 904683            MOV     DPTR,#04683H
001D E0                MOVX    A,@DPTR
001E FF                MOV     R7,A
001F EF                MOV     A,R7
0020 541F              ANL     A,#01FH
0022 FF                MOV     R7,A
0023 EF                MOV     A,R7
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 990
0025 8001              SJMP    ?C0060
0027         ?C0059:
                                           ; SOURCE LINE # 992
0027 22                RET     
                                           ; SOURCE LINE # 995
0028         ?C0060:
                                           ; SOURCE LINE # 1000
0028 120000      R     LCALL   CyPmHibSaveSet
                                           ; SOURCE LINE # 1006
002B 904398            MOV     DPTR,#04398H
002E E0                MOVX    A,@DPTR
002F FF                MOV     R7,A
0030 900000      R     MOV     DPTR,#cyPmBackup+08H
0033 EF                MOV     A,R7
0034 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1007
0035 904398            MOV     DPTR,#04398H
0038 7404              MOV     A,#04H
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1009
003B 904399            MOV     DPTR,#04399H
003E E0                MOVX    A,@DPTR
003F FF                MOV     R7,A
0040 900000      R     MOV     DPTR,#cyPmBackup+09H
0043 EF                MOV     A,R7
0044 F0                MOVX    @DPTR,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 63  

                                           ; SOURCE LINE # 1010
0045 904399            MOV     DPTR,#04399H
0048 E4                CLR     A
0049 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1012
004A 90439A            MOV     DPTR,#0439AH
004D E0                MOVX    A,@DPTR
004E FF                MOV     R7,A
004F 900000      R     MOV     DPTR,#cyPmBackup+0AH
0052 EF                MOV     A,R7
0053 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1013
0054 90439A            MOV     DPTR,#0439AH
0057 E4                CLR     A
0058 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1019
0059 904200            MOV     DPTR,#04200H
005C E0                MOVX    A,@DPTR
005D FF                MOV     R7,A
005E EF                MOV     A,R7
005F 5407              ANL     A,#07H
0061 FF                MOV     R7,A
0062 7E00              MOV     R6,#00H
0064 EF                MOV     A,R7
0065 4E                ORL     A,R6
0066 7008              JNZ     ?C0062
                                           ; SOURCE LINE # 1020
                                           ; SOURCE LINE # 1022
0068 900000      R     MOV     DPTR,#cyPmBackup+028H
006B 7401              MOV     A,#01H
006D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1023
006E 801E              SJMP    ?C0063
0070         ?C0062:
                                           ; SOURCE LINE # 1025
                                           ; SOURCE LINE # 1027
0070 900000      R     MOV     DPTR,#cyPmBackup+028H
0073 E4                CLR     A
0074 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1030
0075 904200            MOV     DPTR,#04200H
0078 E0                MOVX    A,@DPTR
0079 FF                MOV     R7,A
007A EF                MOV     A,R7
007B 5407              ANL     A,#07H
007D FF                MOV     R7,A
007E 900000      R     MOV     DPTR,#cyPmBackup+027H
0081 EF                MOV     A,R7
0082 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1033
0083 904200            MOV     DPTR,#04200H
0086 E0                MOVX    A,@DPTR
0087 FF                MOV     R7,A
0088 EF                MOV     A,R7
0089 54F8              ANL     A,#0F8H
008B FF                MOV     R7,A
008C EF                MOV     A,R7
008D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1034
008E         ?C0063:
                                           ; SOURCE LINE # 1038
008E 904393            MOV     DPTR,#04393H
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 64  

0091 E0                MOVX    A,@DPTR
0092 FF                MOV     R7,A
0093 EF                MOV     A,R7
0094 54F8              ANL     A,#0F8H
0096 FF                MOV     R7,A
0097 EF                MOV     A,R7
0098 4404              ORL     A,#04H
009A FF                MOV     R7,A
009B 904393            MOV     DPTR,#04393H
009E EF                MOV     A,R7
009F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1041
00A0 904393            MOV     DPTR,#04393H
00A3 E0                MOVX    A,@DPTR
00A4 FF                MOV     R7,A
                                           ; SOURCE LINE # 1044
00A5 00                NOP     
                                           ; SOURCE LINE # 1045
00A6 00                NOP     
                                           ; SOURCE LINE # 1054
00A7 900000      R     MOV     DPTR,#cyPmBackup+028H
00AA E0                MOVX    A,@DPTR
00AB FF                MOV     R7,A
00AC EF                MOV     A,R7
00AD 6401              XRL     A,#01H
00AF 6016              JZ      ?C0064
                                           ; SOURCE LINE # 1055
                                           ; SOURCE LINE # 1056
00B1 904200            MOV     DPTR,#04200H
00B4 E0                MOVX    A,@DPTR
00B5 FF                MOV     R7,A
00B6 EF                MOV     A,R7
00B7 54F8              ANL     A,#0F8H
00B9 FF                MOV     R7,A
00BA 900000      R     MOV     DPTR,#cyPmBackup+027H
00BD E0                MOVX    A,@DPTR
00BE FE                MOV     R6,A
00BF EF                MOV     A,R7
00C0 4E                ORL     A,R6
00C1 FF                MOV     R7,A
00C2 904200            MOV     DPTR,#04200H
00C5 EF                MOV     A,R7
00C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1058
00C7         ?C0064:
                                           ; SOURCE LINE # 1062
00C7 120000      R     LCALL   CyPmHibRestore
                                           ; SOURCE LINE # 1068
00CA 900000      R     MOV     DPTR,#cyPmBackup+08H
00CD E0                MOVX    A,@DPTR
00CE FF                MOV     R7,A
00CF 904398            MOV     DPTR,#04398H
00D2 EF                MOV     A,R7
00D3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1069
00D4 900000      R     MOV     DPTR,#cyPmBackup+09H
00D7 E0                MOVX    A,@DPTR
00D8 FF                MOV     R7,A
00D9 904399            MOV     DPTR,#04399H
00DC EF                MOV     A,R7
00DD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1070
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 65  

00DE 900000      R     MOV     DPTR,#cyPmBackup+0AH
00E1 E0                MOVX    A,@DPTR
00E2 FF                MOV     R7,A
00E3 90439A            MOV     DPTR,#0439AH
00E6 EF                MOV     A,R7
00E7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1075
00E8 900000      R     MOV     DPTR,#interruptState
00EB E0                MOVX    A,@DPTR
00EC FF                MOV     R7,A
00ED 120000      E     LCALL   _CyExitCriticalSection
                                           ; SOURCE LINE # 1076
00F0         ?C0061:
00F0 22                RET     
             ; FUNCTION CyPmHibernate (END)

             ; FUNCTION _CyPmReadStatus (BEGIN)
                                           ; SOURCE LINE # 1108
0000 900000      R     MOV     DPTR,#mask
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1109
                                           ; SOURCE LINE # 1115
0005 120000      E     LCALL   CyEnterCriticalSection
0008 900000      R     MOV     DPTR,#interruptState
000B EF                MOV     A,R7
000C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1118
000D 900000      R     MOV     DPTR,#interruptStatus
0010 E0                MOVX    A,@DPTR
0011 FF                MOV     R7,A
0012 904390            MOV     DPTR,#04390H
0015 E0                MOVX    A,@DPTR
0016 FE                MOV     R6,A
0017 EF                MOV     A,R7
0018 4E                ORL     A,R6
0019 FF                MOV     R7,A
001A 900000      R     MOV     DPTR,#interruptStatus
001D EF                MOV     A,R7
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1119
001F 900000      R     MOV     DPTR,#interruptStatus
0022 E0                MOVX    A,@DPTR
0023 FF                MOV     R7,A
0024 900000      R     MOV     DPTR,#tmpStatus
0027 EF                MOV     A,R7
0028 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1120
0029 900000      R     MOV     DPTR,#interruptStatus
002C E0                MOVX    A,@DPTR
002D FF                MOV     R7,A
002E 900000      R     MOV     DPTR,#mask
0031 E0                MOVX    A,@DPTR
0032 FE                MOV     R6,A
0033 EE                MOV     A,R6
0034 F4                CPL     A
0035 FE                MOV     R6,A
0036 EF                MOV     A,R7
0037 5E                ANL     A,R6
0038 FF                MOV     R7,A
0039 900000      R     MOV     DPTR,#interruptStatus
003C EF                MOV     A,R7
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 66  

003D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1123
003E 900000      R     MOV     DPTR,#interruptState
0041 E0                MOVX    A,@DPTR
0042 FF                MOV     R7,A
0043 120000      E     LCALL   _CyExitCriticalSection
                                           ; SOURCE LINE # 1125
0046 900000      R     MOV     DPTR,#tmpStatus
0049 E0                MOVX    A,@DPTR
004A FF                MOV     R7,A
                                           ; SOURCE LINE # 1126
004B         ?C0065:
004B 22                RET     
             ; FUNCTION _CyPmReadStatus (END)

             ; FUNCTION CyPmHibSaveSet (BEGIN)
                                           ; SOURCE LINE # 1151
                                           ; SOURCE LINE # 1152
                                           ; SOURCE LINE # 1154
0000 904331            MOV     DPTR,#04331H
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 EF                MOV     A,R7
0006 5404              ANL     A,#04H
0008 FF                MOV     R7,A
0009 7E00              MOV     R6,#00H
000B EF                MOV     A,R7
000C 4E                ORL     A,R6
000D 600B              JZ      ?C0067
                                           ; SOURCE LINE # 1155
                                           ; SOURCE LINE # 1174
000F 904331            MOV     DPTR,#04331H
0012 E0                MOVX    A,@DPTR
0013 FF                MOV     R7,A
0014 EF                MOV     A,R7
0015 54FB              ANL     A,#0FBH
0017 FF                MOV     R7,A
0018 EF                MOV     A,R7
0019 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1175
001A         ?C0066:
                                           ; SOURCE LINE # 1177
                                           ; SOURCE LINE # 1184
001A         ?C0067:
                                           ; SOURCE LINE # 1190
001A 7F01              MOV     R7,#01H
001C 120000      E     LCALL   _CyILO_SetPowerMode
001F 900000      R     MOV     DPTR,#cyPmBackup
0022 EF                MOV     A,R7
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1193
0024 904300            MOV     DPTR,#04300H
0027 E0                MOVX    A,@DPTR
0028 FF                MOV     R7,A
0029 EF                MOV     A,R7
002A 5402              ANL     A,#02H
002C FF                MOV     R7,A
002D 7E00              MOV     R6,#00H
002F EF                MOV     A,R7
0030 4E                ORL     A,R6
0031 7004              JNZ     ?C0068
0033 7F00              MOV     R7,#00H
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 67  

0035 8002              SJMP    ?C0069
0037         ?C0068:
0037 7F01              MOV     R7,#01H
0039         ?C0069:
0039 900000      R     MOV     DPTR,#cyPmBackup+01H
003C EF                MOV     A,R7
003D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1197
003E 904300            MOV     DPTR,#04300H
0041 E0                MOVX    A,@DPTR
0042 FF                MOV     R7,A
0043 EF                MOV     A,R7
0044 5404              ANL     A,#04H
0046 FF                MOV     R7,A
0047 7E00              MOV     R6,#00H
0049 EF                MOV     A,R7
004A 4E                ORL     A,R6
004B 7004              JNZ     ?C0070
004D 7F00              MOV     R7,#00H
004F 8002              SJMP    ?C0071
0051         ?C0070:
0051 7F01              MOV     R7,#01H
0053         ?C0071:
0053 900000      R     MOV     DPTR,#cyPmBackup+02H
0056 EF                MOV     A,R7
0057 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1201
0058 904683            MOV     DPTR,#04683H
005B E0                MOVX    A,@DPTR
005C FF                MOV     R7,A
005D EF                MOV     A,R7
005E 5410              ANL     A,#010H
0060 FF                MOV     R7,A
0061 7E00              MOV     R6,#00H
0063 EF                MOV     A,R7
0064 4E                ORL     A,R6
0065 7012              JNZ     ?C0072
                                           ; SOURCE LINE # 1202
                                           ; SOURCE LINE # 1204
0067 900000      R     MOV     DPTR,#cyPmBackup+05H
006A E4                CLR     A
006B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1207
006C 904683            MOV     DPTR,#04683H
006F E0                MOVX    A,@DPTR
0070 FF                MOV     R7,A
0071 EF                MOV     A,R7
0072 4410              ORL     A,#010H
0074 FF                MOV     R7,A
0075 EF                MOV     A,R7
0076 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1208
0077 8006              SJMP    ?C0073
0079         ?C0072:
                                           ; SOURCE LINE # 1210
                                           ; SOURCE LINE # 1212
0079 900000      R     MOV     DPTR,#cyPmBackup+05H
007C 7401              MOV     A,#01H
007E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1213
007F         ?C0073:
                                           ; SOURCE LINE # 1234
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 68  

007F 9046F5            MOV     DPTR,#046F5H
0082 E0                MOVX    A,@DPTR
0083 FF                MOV     R7,A
0084 EF                MOV     A,R7
0085 5407              ANL     A,#07H
0087 FF                MOV     R7,A
0088 900000      R     MOV     DPTR,#cyPmBackup+03H
008B EF                MOV     A,R7
008C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1237
008D 9046F5            MOV     DPTR,#046F5H
0090 E0                MOVX    A,@DPTR
0091 FF                MOV     R7,A
0092 EF                MOV     A,R7
0093 54F8              ANL     A,#0F8H
0095 FF                MOV     R7,A
0096 EF                MOV     A,R7
0097 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1241
0098 120000      R     LCALL   CyPmHibSlpSaveSet
                                           ; SOURCE LINE # 1242
009B         ?C0074:
009B 22                RET     
             ; FUNCTION CyPmHibSaveSet (END)

             ; FUNCTION CyPmHibRestore (BEGIN)
                                           ; SOURCE LINE # 1265
                                           ; SOURCE LINE # 1266
                                           ; SOURCE LINE # 1269
0000 9046F5            MOV     DPTR,#046F5H
0003 C083              PUSH    DPH
0005 C082              PUSH    DPL
0007 E0                MOVX    A,@DPTR
0008 FF                MOV     R7,A
0009 900000      R     MOV     DPTR,#cyPmBackup+03H
000C E0                MOVX    A,@DPTR
000D FE                MOV     R6,A
000E EF                MOV     A,R7
000F 4E                ORL     A,R6
0010 FF                MOV     R7,A
0011 D082              POP     DPL
0013 D083              POP     DPH
0015 EF                MOV     A,R7
0016 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1272
0017 120000      R     LCALL   CyPmHibSlpRestore
                                           ; SOURCE LINE # 1289
001A 900000      R     MOV     DPTR,#cyPmBackup+01H
001D E0                MOVX    A,@DPTR
001E FF                MOV     R7,A
001F EF                MOV     A,R7
0020 B40103            CJNE    A,#01H,?C0075
                                           ; SOURCE LINE # 1290
                                           ; SOURCE LINE # 1292
0023 120000      E     LCALL   CyILO_Start1K
                                           ; SOURCE LINE # 1293
0026         ?C0075:
                                           ; SOURCE LINE # 1296
0026 900000      R     MOV     DPTR,#cyPmBackup+02H
0029 E0                MOVX    A,@DPTR
002A FF                MOV     R7,A
002B EF                MOV     A,R7
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 69  

002C B40103            CJNE    A,#01H,?C0076
                                           ; SOURCE LINE # 1297
                                           ; SOURCE LINE # 1299
002F 120000      E     LCALL   CyILO_Start100K
                                           ; SOURCE LINE # 1300
0032         ?C0076:
                                           ; SOURCE LINE # 1303
0032 900000      R     MOV     DPTR,#cyPmBackup
0035 E0                MOVX    A,@DPTR
0036 FF                MOV     R7,A
0037 120000      E     LCALL   _CyILO_SetPowerMode
                                           ; SOURCE LINE # 1306
003A 900000      R     MOV     DPTR,#cyPmBackup+05H
003D E0                MOVX    A,@DPTR
003E FF                MOV     R7,A
003F EF                MOV     A,R7
0040 700B              JNZ     ?C0078
                                           ; SOURCE LINE # 1307
                                           ; SOURCE LINE # 1309
0042 904683            MOV     DPTR,#04683H
0045 E0                MOVX    A,@DPTR
0046 FF                MOV     R7,A
0047 EF                MOV     A,R7
0048 54EF              ANL     A,#0EFH
004A FF                MOV     R7,A
004B EF                MOV     A,R7
004C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1310
004D         ?C0077:
                                           ; SOURCE LINE # 1313
004D         ?C0078:
004D 22                RET     
             ; FUNCTION CyPmHibRestore (END)

             ; FUNCTION _CyPmCtwSetInterval (BEGIN)
                                           ; SOURCE LINE # 1336
0000 900000      R     MOV     DPTR,#ctwInterval
0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1337
                                           ; SOURCE LINE # 1339
0005 904382            MOV     DPTR,#04382H
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 54F7              ANL     A,#0F7H
000D FF                MOV     R7,A
000E EF                MOV     A,R7
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1342
0010 120000      E     LCALL   CyILO_Start1K
                                           ; SOURCE LINE # 1345
0013 904382            MOV     DPTR,#04382H
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
0018 EF                MOV     A,R7
0019 5404              ANL     A,#04H
001B FF                MOV     R7,A
001C 7E00              MOV     R6,#00H
001E EF                MOV     A,R7
001F 4E                ORL     A,R6
0020 602F              JZ      ?C0079
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 70  

                                           ; SOURCE LINE # 1346
                                           ; SOURCE LINE # 1348
0022 900000      R     MOV     DPTR,#ctwInterval
0025 E0                MOVX    A,@DPTR
0026 FF                MOV     R7,A
0027 904381            MOV     DPTR,#04381H
002A E0                MOVX    A,@DPTR
002B FE                MOV     R6,A
002C EE                MOV     A,R6
002D 6F                XRL     A,R7
002E 6044              JZ      ?C0083
                                           ; SOURCE LINE # 1349
                                           ; SOURCE LINE # 1351
0030 904382            MOV     DPTR,#04382H
0033 E0                MOVX    A,@DPTR
0034 FF                MOV     R7,A
0035 EF                MOV     A,R7
0036 54FB              ANL     A,#0FBH
0038 FF                MOV     R7,A
0039 EF                MOV     A,R7
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1352
003B 900000      R     MOV     DPTR,#ctwInterval
003E E0                MOVX    A,@DPTR
003F FF                MOV     R7,A
0040 904381            MOV     DPTR,#04381H
0043 EF                MOV     A,R7
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1353
0045 904382            MOV     DPTR,#04382H
0048 E0                MOVX    A,@DPTR
0049 FF                MOV     R7,A
004A EF                MOV     A,R7
004B 4404              ORL     A,#04H
004D FF                MOV     R7,A
004E EF                MOV     A,R7
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1354
0050         ?C0080:
                                           ; SOURCE LINE # 1355
0050 22                RET     
0051         ?C0079:
                                           ; SOURCE LINE # 1357
                                           ; SOURCE LINE # 1359
0051 900000      R     MOV     DPTR,#ctwInterval
0054 E0                MOVX    A,@DPTR
0055 FF                MOV     R7,A
0056 904381            MOV     DPTR,#04381H
0059 E0                MOVX    A,@DPTR
005A FE                MOV     R6,A
005B EE                MOV     A,R6
005C 6F                XRL     A,R7
005D 600A              JZ      ?C0082
                                           ; SOURCE LINE # 1360
                                           ; SOURCE LINE # 1362
005F 900000      R     MOV     DPTR,#ctwInterval
0062 E0                MOVX    A,@DPTR
0063 FF                MOV     R7,A
0064 904381            MOV     DPTR,#04381H
0067 EF                MOV     A,R7
0068 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1363
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 71  

0069         ?C0082:
                                           ; SOURCE LINE # 1366
0069 904382            MOV     DPTR,#04382H
006C E0                MOVX    A,@DPTR
006D FF                MOV     R7,A
006E EF                MOV     A,R7
006F 4404              ORL     A,#04H
0071 FF                MOV     R7,A
0072 EF                MOV     A,R7
0073 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1367
0074         ?C0081:
                                           ; SOURCE LINE # 1368
0074         ?C0083:
0074 22                RET     
             ; FUNCTION _CyPmCtwSetInterval (END)

             ; FUNCTION CyPmOppsSet (BEGIN)
                                           ; SOURCE LINE # 1388
                                           ; SOURCE LINE # 1389
                                           ; SOURCE LINE # 1391
0000 904308            MOV     DPTR,#04308H
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 EF                MOV     A,R7
0006 5401              ANL     A,#01H
0008 FF                MOV     R7,A
0009 7E00              MOV     R6,#00H
000B EF                MOV     A,R7
000C 4E                ORL     A,R6
000D 7003              JNZ     ?C0084
                                           ; SOURCE LINE # 1392
                                           ; SOURCE LINE # 1394
000F 120000      E     LCALL   CyXTAL_32KHZ_Start
                                           ; SOURCE LINE # 1395
0012         ?C0084:
                                           ; SOURCE LINE # 1398
0012 904382            MOV     DPTR,#04382H
0015 E0                MOVX    A,@DPTR
0016 FF                MOV     R7,A
0017 EF                MOV     A,R7
0018 54DF              ANL     A,#0DFH
001A FF                MOV     R7,A
001B EF                MOV     A,R7
001C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1401
001D 904382            MOV     DPTR,#04382H
0020 E0                MOVX    A,@DPTR
0021 FF                MOV     R7,A
0022 EF                MOV     A,R7
0023 4410              ORL     A,#010H
0025 FF                MOV     R7,A
0026 EF                MOV     A,R7
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1402
0028         ?C0085:
0028 22                RET     
             ; FUNCTION CyPmOppsSet (END)

             ; FUNCTION _CyPmFtwSetInterval (BEGIN)
                                           ; SOURCE LINE # 1425
0000 900000      R     MOV     DPTR,#ftwInterval
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 72  

0003 EF                MOV     A,R7
0004 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1426
                                           ; SOURCE LINE # 1428
0005 904382            MOV     DPTR,#04382H
0008 E0                MOVX    A,@DPTR
0009 FF                MOV     R7,A
000A EF                MOV     A,R7
000B 54FD              ANL     A,#0FDH
000D FF                MOV     R7,A
000E EF                MOV     A,R7
000F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1431
0010 120000      E     LCALL   CyILO_Start100K
                                           ; SOURCE LINE # 1434
0013 904382            MOV     DPTR,#04382H
0016 E0                MOVX    A,@DPTR
0017 FF                MOV     R7,A
0018 EF                MOV     A,R7
0019 5401              ANL     A,#01H
001B FF                MOV     R7,A
001C 7E00              MOV     R6,#00H
001E EF                MOV     A,R7
001F 4E                ORL     A,R6
0020 602F              JZ      ?C0086
                                           ; SOURCE LINE # 1435
                                           ; SOURCE LINE # 1437
0022 900000      R     MOV     DPTR,#ftwInterval
0025 E0                MOVX    A,@DPTR
0026 FF                MOV     R7,A
0027 904380            MOV     DPTR,#04380H
002A E0                MOVX    A,@DPTR
002B FE                MOV     R6,A
002C EE                MOV     A,R6
002D 6F                XRL     A,R7
002E 6044              JZ      ?C0090
                                           ; SOURCE LINE # 1438
                                           ; SOURCE LINE # 1440
0030 904382            MOV     DPTR,#04382H
0033 E0                MOVX    A,@DPTR
0034 FF                MOV     R7,A
0035 EF                MOV     A,R7
0036 54FE              ANL     A,#0FEH
0038 FF                MOV     R7,A
0039 EF                MOV     A,R7
003A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1441
003B 900000      R     MOV     DPTR,#ftwInterval
003E E0                MOVX    A,@DPTR
003F FF                MOV     R7,A
0040 904380            MOV     DPTR,#04380H
0043 EF                MOV     A,R7
0044 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1442
0045 904382            MOV     DPTR,#04382H
0048 E0                MOVX    A,@DPTR
0049 FF                MOV     R7,A
004A EF                MOV     A,R7
004B 4401              ORL     A,#01H
004D FF                MOV     R7,A
004E EF                MOV     A,R7
004F F0                MOVX    @DPTR,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 73  

                                           ; SOURCE LINE # 1443
0050         ?C0087:
                                           ; SOURCE LINE # 1444
0050 22                RET     
0051         ?C0086:
                                           ; SOURCE LINE # 1446
                                           ; SOURCE LINE # 1448
0051 900000      R     MOV     DPTR,#ftwInterval
0054 E0                MOVX    A,@DPTR
0055 FF                MOV     R7,A
0056 904380            MOV     DPTR,#04380H
0059 E0                MOVX    A,@DPTR
005A FE                MOV     R6,A
005B EE                MOV     A,R6
005C 6F                XRL     A,R7
005D 600A              JZ      ?C0089
                                           ; SOURCE LINE # 1449
                                           ; SOURCE LINE # 1451
005F 900000      R     MOV     DPTR,#ftwInterval
0062 E0                MOVX    A,@DPTR
0063 FF                MOV     R7,A
0064 904380            MOV     DPTR,#04380H
0067 EF                MOV     A,R7
0068 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1452
0069         ?C0089:
                                           ; SOURCE LINE # 1455
0069 904382            MOV     DPTR,#04382H
006C E0                MOVX    A,@DPTR
006D FF                MOV     R7,A
006E EF                MOV     A,R7
006F 4401              ORL     A,#01H
0071 FF                MOV     R7,A
0072 EF                MOV     A,R7
0073 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1456
0074         ?C0088:
                                           ; SOURCE LINE # 1457
0074         ?C0090:
0074 22                RET     
             ; FUNCTION _CyPmFtwSetInterval (END)

             ; FUNCTION CyPmSlpSaveSet (BEGIN)
                                           ; SOURCE LINE # 1585
                                           ; SOURCE LINE # 1586
                                           ; SOURCE LINE # 1654
0000 904689            MOV     DPTR,#04689H
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 900000      R     MOV     DPTR,#cyPmBackup+04H
0008 EF                MOV     A,R7
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1657
000A 9046F5            MOV     DPTR,#046F5H
000D E0                MOVX    A,@DPTR
000E FF                MOV     R7,A
000F EF                MOV     A,R7
0010 5407              ANL     A,#07H
0012 FF                MOV     R7,A
0013 7E00              MOV     R6,#00H
0015 EF                MOV     A,R7
0016 4E                ORL     A,R6
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 74  

0017 6019              JZ      ?C0091
                                           ; SOURCE LINE # 1659
                                           ; SOURCE LINE # 1661
0019 904689            MOV     DPTR,#04689H
001C 743B              MOV     A,#03BH
001E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1664
001F 904331            MOV     DPTR,#04331H
0022 7401              MOV     A,#01H
0024 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1667
0025 904331            MOV     DPTR,#04331H
0028 E0                MOVX    A,@DPTR
0029 FF                MOV     R7,A
002A EF                MOV     A,R7
002B 4402              ORL     A,#02H
002D FF                MOV     R7,A
002E EF                MOV     A,R7
002F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1668
0030 8006              SJMP    ?C0092
0032         ?C0091:
                                           ; SOURCE LINE # 1670
                                           ; SOURCE LINE # 1672
0032 904689            MOV     DPTR,#04689H
0035 743A              MOV     A,#03AH
0037 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1673
0038         ?C0092:
                                           ; SOURCE LINE # 1678
0038 120000      R     LCALL   CyPmHibSlpSaveSet
                                           ; SOURCE LINE # 1679
003B         ?C0093:
003B 22                RET     
             ; FUNCTION CyPmSlpSaveSet (END)

             ; FUNCTION CyPmSlpRestore (BEGIN)
                                           ; SOURCE LINE # 1702
                                           ; SOURCE LINE # 1703
                                           ; SOURCE LINE # 1733
0000 900000      R     MOV     DPTR,#cyPmBackup+04H
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 904689            MOV     DPTR,#04689H
0008 EF                MOV     A,R7
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1736
000A 9046F5            MOV     DPTR,#046F5H
000D E0                MOVX    A,@DPTR
000E FF                MOV     R7,A
000F EF                MOV     A,R7
0010 5407              ANL     A,#07H
0012 FF                MOV     R7,A
0013 7E00              MOV     R6,#00H
0015 EF                MOV     A,R7
0016 4E                ORL     A,R6
0017 6016              JZ      ?C0094
                                           ; SOURCE LINE # 1738
                                           ; SOURCE LINE # 1740
0019 904331            MOV     DPTR,#04331H
001C E0                MOVX    A,@DPTR
001D FF                MOV     R7,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 75  

001E EF                MOV     A,R7
001F 54FD              ANL     A,#0FDH
0021 FF                MOV     R7,A
0022 EF                MOV     A,R7
0023 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1743
0024 904331            MOV     DPTR,#04331H
0027 E0                MOVX    A,@DPTR
0028 FF                MOV     R7,A
0029 EF                MOV     A,R7
002A 54FE              ANL     A,#0FEH
002C FF                MOV     R7,A
002D EF                MOV     A,R7
002E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1744
002F         ?C0094:
                                           ; SOURCE LINE # 1750
002F 120000      R     LCALL   CyPmHibSlpRestore
                                           ; SOURCE LINE # 1751
0032         ?C0095:
0032 22                RET     
             ; FUNCTION CyPmSlpRestore (END)

             ; FUNCTION CyPmHibSlpSaveSet (BEGIN)
                                           ; SOURCE LINE # 1776
                                           ; SOURCE LINE # 1777
                                           ; SOURCE LINE # 1923
0000 905A00            MOV     DPTR,#05A00H
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 900000      R     MOV     DPTR,#cyPmBackup+0BH
0008 EF                MOV     A,R7
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1924
000A 905A02            MOV     DPTR,#05A02H
000D E0                MOVX    A,@DPTR
000E FF                MOV     R7,A
000F 900000      R     MOV     DPTR,#cyPmBackup+0CH
0012 EF                MOV     A,R7
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1925
0014 905A03            MOV     DPTR,#05A03H
0017 E0                MOVX    A,@DPTR
0018 FF                MOV     R7,A
0019 900000      R     MOV     DPTR,#cyPmBackup+0DH
001C EF                MOV     A,R7
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1926
001E 905A04            MOV     DPTR,#05A04H
0021 E0                MOVX    A,@DPTR
0022 FF                MOV     R7,A
0023 900000      R     MOV     DPTR,#cyPmBackup+0EH
0026 EF                MOV     A,R7
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1927
0028 905A06            MOV     DPTR,#05A06H
002B E0                MOVX    A,@DPTR
002C FF                MOV     R7,A
002D 900000      R     MOV     DPTR,#cyPmBackup+0FH
0030 EF                MOV     A,R7
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1928
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 76  

0032 905A08            MOV     DPTR,#05A08H
0035 E0                MOVX    A,@DPTR
0036 FF                MOV     R7,A
0037 900000      R     MOV     DPTR,#cyPmBackup+010H
003A EF                MOV     A,R7
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1929
003C 905A0A            MOV     DPTR,#05A0AH
003F E0                MOVX    A,@DPTR
0040 FF                MOV     R7,A
0041 900000      R     MOV     DPTR,#cyPmBackup+011H
0044 EF                MOV     A,R7
0045 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1931
0046 905A10            MOV     DPTR,#05A10H
0049 E0                MOVX    A,@DPTR
004A FF                MOV     R7,A
004B 900000      R     MOV     DPTR,#cyPmBackup+012H
004E EF                MOV     A,R7
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1932
0050 905A12            MOV     DPTR,#05A12H
0053 E0                MOVX    A,@DPTR
0054 FF                MOV     R7,A
0055 900000      R     MOV     DPTR,#cyPmBackup+013H
0058 EF                MOV     A,R7
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1933
005A 905A13            MOV     DPTR,#05A13H
005D E0                MOVX    A,@DPTR
005E FF                MOV     R7,A
005F 900000      R     MOV     DPTR,#cyPmBackup+014H
0062 EF                MOV     A,R7
0063 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1934
0064 905A14            MOV     DPTR,#05A14H
0067 E0                MOVX    A,@DPTR
0068 FF                MOV     R7,A
0069 900000      R     MOV     DPTR,#cyPmBackup+015H
006C EF                MOV     A,R7
006D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1935
006E 905A16            MOV     DPTR,#05A16H
0071 E0                MOVX    A,@DPTR
0072 FF                MOV     R7,A
0073 900000      R     MOV     DPTR,#cyPmBackup+016H
0076 EF                MOV     A,R7
0077 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1936
0078 905A18            MOV     DPTR,#05A18H
007B E0                MOVX    A,@DPTR
007C FF                MOV     R7,A
007D 900000      R     MOV     DPTR,#cyPmBackup+017H
0080 EF                MOV     A,R7
0081 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1937
0082 905A1A            MOV     DPTR,#05A1AH
0085 E0                MOVX    A,@DPTR
0086 FF                MOV     R7,A
0087 900000      R     MOV     DPTR,#cyPmBackup+018H
008A EF                MOV     A,R7
008B F0                MOVX    @DPTR,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 77  

                                           ; SOURCE LINE # 1939
008C 905A20            MOV     DPTR,#05A20H
008F E0                MOVX    A,@DPTR
0090 FF                MOV     R7,A
0091 900000      R     MOV     DPTR,#cyPmBackup+019H
0094 EF                MOV     A,R7
0095 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1940
0096 905A22            MOV     DPTR,#05A22H
0099 E0                MOVX    A,@DPTR
009A FF                MOV     R7,A
009B 900000      R     MOV     DPTR,#cyPmBackup+01AH
009E EF                MOV     A,R7
009F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1941
00A0 905A23            MOV     DPTR,#05A23H
00A3 E0                MOVX    A,@DPTR
00A4 FF                MOV     R7,A
00A5 900000      R     MOV     DPTR,#cyPmBackup+01BH
00A8 EF                MOV     A,R7
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1942
00AA 905A24            MOV     DPTR,#05A24H
00AD E0                MOVX    A,@DPTR
00AE FF                MOV     R7,A
00AF 900000      R     MOV     DPTR,#cyPmBackup+01CH
00B2 EF                MOV     A,R7
00B3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1943
00B4 905A26            MOV     DPTR,#05A26H
00B7 E0                MOVX    A,@DPTR
00B8 FF                MOV     R7,A
00B9 900000      R     MOV     DPTR,#cyPmBackup+01DH
00BC EF                MOV     A,R7
00BD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1944
00BE 905A28            MOV     DPTR,#05A28H
00C1 E0                MOVX    A,@DPTR
00C2 FF                MOV     R7,A
00C3 900000      R     MOV     DPTR,#cyPmBackup+01EH
00C6 EF                MOV     A,R7
00C7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1945
00C8 905A2A            MOV     DPTR,#05A2AH
00CB E0                MOVX    A,@DPTR
00CC FF                MOV     R7,A
00CD 900000      R     MOV     DPTR,#cyPmBackup+01FH
00D0 EF                MOV     A,R7
00D1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1947
00D2 905A30            MOV     DPTR,#05A30H
00D5 E0                MOVX    A,@DPTR
00D6 FF                MOV     R7,A
00D7 900000      R     MOV     DPTR,#cyPmBackup+020H
00DA EF                MOV     A,R7
00DB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1948
00DC 905A32            MOV     DPTR,#05A32H
00DF E0                MOVX    A,@DPTR
00E0 FF                MOV     R7,A
00E1 900000      R     MOV     DPTR,#cyPmBackup+021H
00E4 EF                MOV     A,R7
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 78  

00E5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1949
00E6 905A33            MOV     DPTR,#05A33H
00E9 E0                MOVX    A,@DPTR
00EA FF                MOV     R7,A
00EB 900000      R     MOV     DPTR,#cyPmBackup+022H
00EE EF                MOV     A,R7
00EF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1950
00F0 905A34            MOV     DPTR,#05A34H
00F3 E0                MOVX    A,@DPTR
00F4 FF                MOV     R7,A
00F5 900000      R     MOV     DPTR,#cyPmBackup+023H
00F8 EF                MOV     A,R7
00F9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1951
00FA 905A36            MOV     DPTR,#05A36H
00FD E0                MOVX    A,@DPTR
00FE FF                MOV     R7,A
00FF 900000      R     MOV     DPTR,#cyPmBackup+024H
0102 EF                MOV     A,R7
0103 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1952
0104 905A38            MOV     DPTR,#05A38H
0107 E0                MOVX    A,@DPTR
0108 FF                MOV     R7,A
0109 900000      R     MOV     DPTR,#cyPmBackup+025H
010C EF                MOV     A,R7
010D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1953
010E 905A3A            MOV     DPTR,#05A3AH
0111 E0                MOVX    A,@DPTR
0112 FF                MOV     R7,A
0113 900000      R     MOV     DPTR,#cyPmBackup+026H
0116 EF                MOV     A,R7
0117 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1955
0118 905A00            MOV     DPTR,#05A00H
011B E4                CLR     A
011C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1956
011D 905A02            MOV     DPTR,#05A02H
0120 E4                CLR     A
0121 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1957
0122 905A03            MOV     DPTR,#05A03H
0125 E4                CLR     A
0126 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1958
0127 905A04            MOV     DPTR,#05A04H
012A E4                CLR     A
012B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1959
012C 905A06            MOV     DPTR,#05A06H
012F E4                CLR     A
0130 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1960
0131 905A08            MOV     DPTR,#05A08H
0134 E4                CLR     A
0135 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1961
0136 905A0A            MOV     DPTR,#05A0AH
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 79  

0139 E4                CLR     A
013A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1963
013B 905A10            MOV     DPTR,#05A10H
013E E4                CLR     A
013F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1964
0140 905A12            MOV     DPTR,#05A12H
0143 E4                CLR     A
0144 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1965
0145 905A13            MOV     DPTR,#05A13H
0148 E4                CLR     A
0149 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1966
014A 905A14            MOV     DPTR,#05A14H
014D E4                CLR     A
014E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1967
014F 905A16            MOV     DPTR,#05A16H
0152 E4                CLR     A
0153 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1968
0154 905A18            MOV     DPTR,#05A18H
0157 E4                CLR     A
0158 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1969
0159 905A1A            MOV     DPTR,#05A1AH
015C E4                CLR     A
015D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1971
015E 905A20            MOV     DPTR,#05A20H
0161 E4                CLR     A
0162 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1972
0163 905A22            MOV     DPTR,#05A22H
0166 E4                CLR     A
0167 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1973
0168 905A23            MOV     DPTR,#05A23H
016B E4                CLR     A
016C F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1974
016D 905A24            MOV     DPTR,#05A24H
0170 E4                CLR     A
0171 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1975
0172 905A26            MOV     DPTR,#05A26H
0175 E4                CLR     A
0176 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1976
0177 905A28            MOV     DPTR,#05A28H
017A E4                CLR     A
017B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1977
017C 905A2A            MOV     DPTR,#05A2AH
017F E4                CLR     A
0180 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1979
0181 905A30            MOV     DPTR,#05A30H
0184 E4                CLR     A
0185 F0                MOVX    @DPTR,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 80  

                                           ; SOURCE LINE # 1980
0186 905A32            MOV     DPTR,#05A32H
0189 E4                CLR     A
018A F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1981
018B 905A33            MOV     DPTR,#05A33H
018E E4                CLR     A
018F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1982
0190 905A34            MOV     DPTR,#05A34H
0193 E4                CLR     A
0194 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1983
0195 905A36            MOV     DPTR,#05A36H
0198 E4                CLR     A
0199 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1984
019A 905A38            MOV     DPTR,#05A38H
019D E4                CLR     A
019E F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1985
019F 905A3A            MOV     DPTR,#05A3AH
01A2 E4                CLR     A
01A3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 1995
01A4 9046E8            MOV     DPTR,#046E8H
01A7 E0                MOVX    A,@DPTR
01A8 FF                MOV     R7,A
01A9 EF                MOV     A,R7
01AA 5404              ANL     A,#04H
01AC FF                MOV     R7,A
01AD 7E00              MOV     R6,#00H
01AF EF                MOV     A,R7
01B0 4E                ORL     A,R6
01B1 6033              JZ      ?C0096
                                           ; SOURCE LINE # 1996
                                           ; SOURCE LINE # 1998
01B3 900000      R     MOV     DPTR,#cyPmBackup+06H
01B6 7401              MOV     A,#01H
01B8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2001
01B9 90500B            MOV     DPTR,#0500BH
01BC E0                MOVX    A,@DPTR
01BD FF                MOV     R7,A
01BE EF                MOV     A,R7
01BF 540E              ANL     A,#0EH
01C1 FF                MOV     R7,A
01C2 900000      R     MOV     DPTR,#cyPmBackup+07H
01C5 EF                MOV     A,R7
01C6 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2004
01C7 90500B            MOV     DPTR,#0500BH
01CA E0                MOVX    A,@DPTR
01CB FF                MOV     R7,A
01CC EF                MOV     A,R7
01CD 54F1              ANL     A,#0F1H
01CF FF                MOV     R7,A
01D0 EF                MOV     A,R7
01D1 440C              ORL     A,#0CH
01D3 FF                MOV     R7,A
01D4 90500B            MOV     DPTR,#0500BH
01D7 EF                MOV     A,R7
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 81  

01D8 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2008
01D9 9046E8            MOV     DPTR,#046E8H
01DC E0                MOVX    A,@DPTR
01DD FF                MOV     R7,A
01DE EF                MOV     A,R7
01DF 54FB              ANL     A,#0FBH
01E1 FF                MOV     R7,A
01E2 EF                MOV     A,R7
01E3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2009
01E4 8005              SJMP    ?C0097
01E6         ?C0096:
                                           ; SOURCE LINE # 2011
                                           ; SOURCE LINE # 2013
01E6 900000      R     MOV     DPTR,#cyPmBackup+06H
01E9 E4                CLR     A
01EA F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2014
01EB         ?C0097:
                                           ; SOURCE LINE # 2024
01EB 90400B            MOV     DPTR,#0400BH
01EE E0                MOVX    A,@DPTR
01EF FF                MOV     R7,A
01F0 EF                MOV     A,R7
01F1 5404              ANL     A,#04H
01F3 FF                MOV     R7,A
01F4 7E00              MOV     R6,#00H
01F6 EF                MOV     A,R7
01F7 4E                ORL     A,R6
01F8 6007              JZ      ?C0098
                                           ; SOURCE LINE # 2025
                                           ; SOURCE LINE # 2026
01FA 900000      R     MOV     DPTR,#cyPmBackup+029H
01FD 7401              MOV     A,#01H
01FF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2027
0200 22                RET     
0201         ?C0098:
                                           ; SOURCE LINE # 2029
                                           ; SOURCE LINE # 2030
0201 900000      R     MOV     DPTR,#cyPmBackup+029H
0204 E4                CLR     A
0205 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2031
0206         ?C0099:
                                           ; SOURCE LINE # 2032
0206         ?C0100:
0206 22                RET     
             ; FUNCTION CyPmHibSlpSaveSet (END)

             ; FUNCTION CyPmHibSlpRestore (BEGIN)
                                           ; SOURCE LINE # 2055
                                           ; SOURCE LINE # 2056
                                           ; SOURCE LINE # 2136
0000 900000      R     MOV     DPTR,#cyPmBackup+0BH
0003 E0                MOVX    A,@DPTR
0004 FF                MOV     R7,A
0005 905A00            MOV     DPTR,#05A00H
0008 EF                MOV     A,R7
0009 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2137
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 82  

000A 900000      R     MOV     DPTR,#cyPmBackup+0CH
000D E0                MOVX    A,@DPTR
000E FF                MOV     R7,A
000F 905A02            MOV     DPTR,#05A02H
0012 EF                MOV     A,R7
0013 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2138
0014 900000      R     MOV     DPTR,#cyPmBackup+0DH
0017 E0                MOVX    A,@DPTR
0018 FF                MOV     R7,A
0019 905A03            MOV     DPTR,#05A03H
001C EF                MOV     A,R7
001D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2139
001E 900000      R     MOV     DPTR,#cyPmBackup+0EH
0021 E0                MOVX    A,@DPTR
0022 FF                MOV     R7,A
0023 905A04            MOV     DPTR,#05A04H
0026 EF                MOV     A,R7
0027 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2140
0028 900000      R     MOV     DPTR,#cyPmBackup+0FH
002B E0                MOVX    A,@DPTR
002C FF                MOV     R7,A
002D 905A06            MOV     DPTR,#05A06H
0030 EF                MOV     A,R7
0031 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2141
0032 900000      R     MOV     DPTR,#cyPmBackup+010H
0035 E0                MOVX    A,@DPTR
0036 FF                MOV     R7,A
0037 905A08            MOV     DPTR,#05A08H
003A EF                MOV     A,R7
003B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2142
003C 900000      R     MOV     DPTR,#cyPmBackup+011H
003F E0                MOVX    A,@DPTR
0040 FF                MOV     R7,A
0041 905A0A            MOV     DPTR,#05A0AH
0044 EF                MOV     A,R7
0045 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2144
0046 900000      R     MOV     DPTR,#cyPmBackup+012H
0049 E0                MOVX    A,@DPTR
004A FF                MOV     R7,A
004B 905A10            MOV     DPTR,#05A10H
004E EF                MOV     A,R7
004F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2145
0050 900000      R     MOV     DPTR,#cyPmBackup+013H
0053 E0                MOVX    A,@DPTR
0054 FF                MOV     R7,A
0055 905A12            MOV     DPTR,#05A12H
0058 EF                MOV     A,R7
0059 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2146
005A 900000      R     MOV     DPTR,#cyPmBackup+014H
005D E0                MOVX    A,@DPTR
005E FF                MOV     R7,A
005F 905A13            MOV     DPTR,#05A13H
0062 EF                MOV     A,R7
0063 F0                MOVX    @DPTR,A
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 83  

                                           ; SOURCE LINE # 2147
0064 900000      R     MOV     DPTR,#cyPmBackup+015H
0067 E0                MOVX    A,@DPTR
0068 FF                MOV     R7,A
0069 905A14            MOV     DPTR,#05A14H
006C EF                MOV     A,R7
006D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2148
006E 900000      R     MOV     DPTR,#cyPmBackup+016H
0071 E0                MOVX    A,@DPTR
0072 FF                MOV     R7,A
0073 905A16            MOV     DPTR,#05A16H
0076 EF                MOV     A,R7
0077 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2149
0078 900000      R     MOV     DPTR,#cyPmBackup+017H
007B E0                MOVX    A,@DPTR
007C FF                MOV     R7,A
007D 905A18            MOV     DPTR,#05A18H
0080 EF                MOV     A,R7
0081 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2150
0082 900000      R     MOV     DPTR,#cyPmBackup+018H
0085 E0                MOVX    A,@DPTR
0086 FF                MOV     R7,A
0087 905A1A            MOV     DPTR,#05A1AH
008A EF                MOV     A,R7
008B F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2152
008C 900000      R     MOV     DPTR,#cyPmBackup+019H
008F E0                MOVX    A,@DPTR
0090 FF                MOV     R7,A
0091 905A20            MOV     DPTR,#05A20H
0094 EF                MOV     A,R7
0095 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2153
0096 900000      R     MOV     DPTR,#cyPmBackup+01AH
0099 E0                MOVX    A,@DPTR
009A FF                MOV     R7,A
009B 905A22            MOV     DPTR,#05A22H
009E EF                MOV     A,R7
009F F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2154
00A0 900000      R     MOV     DPTR,#cyPmBackup+01BH
00A3 E0                MOVX    A,@DPTR
00A4 FF                MOV     R7,A
00A5 905A23            MOV     DPTR,#05A23H
00A8 EF                MOV     A,R7
00A9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2155
00AA 900000      R     MOV     DPTR,#cyPmBackup+01CH
00AD E0                MOVX    A,@DPTR
00AE FF                MOV     R7,A
00AF 905A24            MOV     DPTR,#05A24H
00B2 EF                MOV     A,R7
00B3 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2156
00B4 900000      R     MOV     DPTR,#cyPmBackup+01DH
00B7 E0                MOVX    A,@DPTR
00B8 FF                MOV     R7,A
00B9 905A26            MOV     DPTR,#05A26H
00BC EF                MOV     A,R7
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 84  

00BD F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2157
00BE 900000      R     MOV     DPTR,#cyPmBackup+01EH
00C1 E0                MOVX    A,@DPTR
00C2 FF                MOV     R7,A
00C3 905A28            MOV     DPTR,#05A28H
00C6 EF                MOV     A,R7
00C7 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2158
00C8 900000      R     MOV     DPTR,#cyPmBackup+01FH
00CB E0                MOVX    A,@DPTR
00CC FF                MOV     R7,A
00CD 905A2A            MOV     DPTR,#05A2AH
00D0 EF                MOV     A,R7
00D1 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2160
00D2 900000      R     MOV     DPTR,#cyPmBackup+020H
00D5 E0                MOVX    A,@DPTR
00D6 FF                MOV     R7,A
00D7 905A30            MOV     DPTR,#05A30H
00DA EF                MOV     A,R7
00DB F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2161
00DC 900000      R     MOV     DPTR,#cyPmBackup+021H
00DF E0                MOVX    A,@DPTR
00E0 FF                MOV     R7,A
00E1 905A32            MOV     DPTR,#05A32H
00E4 EF                MOV     A,R7
00E5 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2162
00E6 900000      R     MOV     DPTR,#cyPmBackup+022H
00E9 E0                MOVX    A,@DPTR
00EA FF                MOV     R7,A
00EB 905A33            MOV     DPTR,#05A33H
00EE EF                MOV     A,R7
00EF F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2163
00F0 900000      R     MOV     DPTR,#cyPmBackup+023H
00F3 E0                MOVX    A,@DPTR
00F4 FF                MOV     R7,A
00F5 905A34            MOV     DPTR,#05A34H
00F8 EF                MOV     A,R7
00F9 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2164
00FA 900000      R     MOV     DPTR,#cyPmBackup+024H
00FD E0                MOVX    A,@DPTR
00FE FF                MOV     R7,A
00FF 905A36            MOV     DPTR,#05A36H
0102 EF                MOV     A,R7
0103 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2165
0104 900000      R     MOV     DPTR,#cyPmBackup+025H
0107 E0                MOVX    A,@DPTR
0108 FF                MOV     R7,A
0109 905A38            MOV     DPTR,#05A38H
010C EF                MOV     A,R7
010D F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2166
010E 900000      R     MOV     DPTR,#cyPmBackup+026H
0111 E0                MOVX    A,@DPTR
0112 FF                MOV     R7,A
0113 905A3A            MOV     DPTR,#05A3AH
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 85  

0116 EF                MOV     A,R7
0117 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2174
0118 900000      R     MOV     DPTR,#cyPmBackup+06H
011B E0                MOVX    A,@DPTR
011C FF                MOV     R7,A
011D EF                MOV     A,R7
011E B40121            CJNE    A,#01H,?C0101
                                           ; SOURCE LINE # 2175
                                           ; SOURCE LINE # 2177
0121 90500B            MOV     DPTR,#0500BH
0124 E0                MOVX    A,@DPTR
0125 FF                MOV     R7,A
0126 EF                MOV     A,R7
0127 54F1              ANL     A,#0F1H
0129 FF                MOV     R7,A
012A 900000      R     MOV     DPTR,#cyPmBackup+07H
012D E0                MOVX    A,@DPTR
012E FE                MOV     R6,A
012F EF                MOV     A,R7
0130 4E                ORL     A,R6
0131 FF                MOV     R7,A
0132 90500B            MOV     DPTR,#0500BH
0135 EF                MOV     A,R7
0136 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2181
0137 9046E8            MOV     DPTR,#046E8H
013A E0                MOVX    A,@DPTR
013B FF                MOV     R7,A
013C EF                MOV     A,R7
013D 4404              ORL     A,#04H
013F FF                MOV     R7,A
0140 EF                MOV     A,R7
0141 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2182
0142         ?C0101:
                                           ; SOURCE LINE # 2197
0142 900000      R     MOV     DPTR,#cyPmBackup+029H
0145 E0                MOVX    A,@DPTR
0146 FF                MOV     R7,A
0147 EF                MOV     A,R7
0148 6401              XRL     A,#01H
014A 704D              JNZ     ?C0103
                                           ; SOURCE LINE # 2198
                                           ; SOURCE LINE # 2200
014C 904005            MOV     DPTR,#04005H
014F E0                MOVX    A,@DPTR
0150 FF                MOV     R7,A
0151 EF                MOV     A,R7
0152 54F0              ANL     A,#0F0H
0154 FF                MOV     R7,A
0155 7E00              MOV     R6,#00H
0157 EE                MOV     A,R6
0158 C4                SWAP    A
0159 F8                MOV     R0,A
015A 54F0              ANL     A,#0F0H
015C C8                XCH     A,R0
015D 68                XRL     A,R0
015E FE                MOV     R6,A
015F EF                MOV     A,R7
0160 C4                SWAP    A
0161 540F              ANL     A,#0FH
C51 COMPILER V9.03   CYPM                                                                  07/02/2012 19:47:02 PAGE 86  

0163 48                ORL     A,R0
0164 FF                MOV     R7,A
0165 EF                MOV     A,R7
0166 2401              ADD     A,#01H
0168 FD                MOV     R5,A
0169 EE                MOV     A,R6
016A 3400              ADDC    A,#00H
016C FC                MOV     R4,A
016D 904200            MOV     DPTR,#04200H
0170 E0                MOVX    A,@DPTR
0171 FF                MOV     R7,A
0172 EF                MOV     A,R7
0173 5407              ANL     A,#07H
0175 FF                MOV     R7,A
0176 EF                MOV     A,R7
0177 900000      R     MOV     DPTR,#cyPmImoFreqReg2Mhz
017A 93                MOVC    A,@A+DPTR
017B FF                MOV     R7,A
017C 7E00              MOV     R6,#00H
017E 120000      E     LCALL   ?C?UIDIV
0181 7C00              MOV     R4,#00H
0183 7D4B              MOV     R5,#04BH
0185 120000      E     LCALL   ?C?IMUL
0188 E4                CLR     A
0189 FC                MOV     R4,A
018A FD                MOV     R5,A
018B 120000      E     LCALL   _CyDelayCycles
                                           ; SOURCE LINE # 2201
018E 90400B            MOV     DPTR,#0400BH
0191 E0                MOVX    A,@DPTR
0192 FF                MOV     R7,A
0193 EF                MOV     A,R7
0194 4404              ORL     A,#04H
0196 FF                MOV     R7,A
0197 EF                MOV     A,R7
0198 F0                MOVX    @DPTR,A
                                           ; SOURCE LINE # 2202
0199         ?C0102:
                                           ; SOURCE LINE # 2203
0199         ?C0103:
0199 22                RET     
             ; FUNCTION CyPmHibSlpRestore (END)



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   3797    ----
   CONSTANT SIZE    =     14    ----
   XDATA SIZE       =     75    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
